<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Microeconometrics with R - 4&nbsp; Interpretation of the Coefficients</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../beyond_OLS.html" rel="next">
<link href="../chapters/multiple_regression.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Interpretation of the Coefficients</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Microeconometrics with R</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../OLS.html" class="sidebar-item-text sidebar-link">Ordinary least squares estimator</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/simple_regression.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Simple linear regression model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/simple_regression_properties.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Statistical properties of the simple linear estimator</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/multiple_regression.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Multiple regression model</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/coefficients.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Interpretation of the Coefficients</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../beyond_OLS.html" class="sidebar-item-text sidebar-link">Beyond the OLS estimator</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/maximum_likelihood.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Maximum likelihood estimator</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/non_spherical.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Non-spherical disturbances</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/endogeneity.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Endogeneity</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/treateff.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Treatment effect</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/spatial.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Spatial econometrics</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../special_responses.html" class="sidebar-item-text sidebar-link">Special responses</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/binomial.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Binomial models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/tobit.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Censored and truncated models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/count.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Count data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/duration.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Duration models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/rum.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Discrete choice models</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#sec-numerical_covariate" id="toc-sec-numerical_covariate" class="nav-link active" data-scroll-target="#sec-numerical_covariate"><span class="toc-section-number">4.1</span>  Numerical covariate</a>
  <ul class="collapse">
<li><a href="#response-and-covariate-in-level" id="toc-response-and-covariate-in-level" class="nav-link" data-scroll-target="#response-and-covariate-in-level">Response and covariate in level</a></li>
  <li><a href="#covariate-in-logarithm" id="toc-covariate-in-logarithm" class="nav-link" data-scroll-target="#covariate-in-logarithm">Covariate in logarithm</a></li>
  <li><a href="#response-in-logarithm" id="toc-response-in-logarithm" class="nav-link" data-scroll-target="#response-in-logarithm">Response in logarithm</a></li>
  <li><a href="#response-and-covariate-in-log" id="toc-response-and-covariate-in-log" class="nav-link" data-scroll-target="#response-and-covariate-in-log">Response and covariate in log</a></li>
  <li><a href="#sec-integer_covariate" id="toc-sec-integer_covariate" class="nav-link" data-scroll-target="#sec-integer_covariate">Integer covariate</a></li>
  </ul>
</li>
  <li>
<a href="#sec-categorical_covariates" id="toc-sec-categorical_covariates" class="nav-link" data-scroll-target="#sec-categorical_covariates"><span class="toc-section-number">4.2</span>  Categorical covariate</a>
  <ul class="collapse">
<li><a href="#dichotomic-variable" id="toc-dichotomic-variable" class="nav-link" data-scroll-target="#dichotomic-variable">Dichotomic variable</a></li>
  <li><a href="#polytomic-covariate" id="toc-polytomic-covariate" class="nav-link" data-scroll-target="#polytomic-covariate">Polytomic covariate</a></li>
  </ul>
</li>
  <li>
<a href="#sec-several_covariates" id="toc-sec-several_covariates" class="nav-link" data-scroll-target="#sec-several_covariates"><span class="toc-section-number">4.3</span>  Several covariates</a>
  <ul class="collapse">
<li><a href="#separate-effects" id="toc-separate-effects" class="nav-link" data-scroll-target="#separate-effects">Separate effects</a></li>
  <li><a href="#multiplicative-effects" id="toc-multiplicative-effects" class="nav-link" data-scroll-target="#multiplicative-effects">Multiplicative effects</a></li>
  <li><a href="#polynomials" id="toc-polynomials" class="nav-link" data-scroll-target="#polynomials">Polynomials</a></li>
  </ul>
</li>
  <li>
<a href="#sec-marginal_effects" id="toc-sec-marginal_effects" class="nav-link" data-scroll-target="#sec-marginal_effects"><span class="toc-section-number">4.4</span>  Marginal effects</a>
  <ul class="collapse">
<li><a href="#computation-of-the-marginal-effects-with-one-covariate" id="toc-computation-of-the-marginal-effects-with-one-covariate" class="nav-link" data-scroll-target="#computation-of-the-marginal-effects-with-one-covariate">Computation of the marginal effects with one covariate</a></li>
  <li><a href="#general-computation-of-marginal-effects" id="toc-general-computation-of-marginal-effects" class="nav-link" data-scroll-target="#general-computation-of-marginal-effects">General computation of marginal effects</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-interpretation_chapter" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Interpretation of the Coefficients</span></span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><p>In the simplest model, a regression with a real numerical response and a real numerical covariate: <span class="math inline">\(y_n = \alpha + \beta x_n + \epsilon_n\)</span>; the interpretation of <span class="math inline">\(\beta\)</span> is simply the constant marginal effect of <span class="math inline">\(x_n\)</span> on <span class="math inline">\(y_n\)</span> or, mathematically, the derivative of <span class="math inline">\(y\)</span> with respect to <span class="math inline">\(x\)</span>. However, linear models are much richer than this simple one, as some covariates may be:</p>
<ul>
<li>integer and not real (e.g., the number of children),</li>
<li>dummy variables (e.g., 0 for a male and 1 for a female),</li>
<li>categorical variables (e.g., marital status, with modalities married, single, divorced, widower),</li>
<li>introduced in the regression after a transformation, for example, by taking the logarithm or the square root (this can be also true for the response),</li>
<li>introduced as a polynomial, for example, not only <span class="math inline">\(x\)</span> is introduced, but also its square,</li>
<li>jointly introduced with an interaction, i.e., not only <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span> are introduced, but also their product.</li>
</ul>
<p>In all these cases, <span class="math inline">\(\beta\)</span> is no longer the derivative of <span class="math inline">\(y\)</span> with respect to <span class="math inline">\(x\)</span> and special care is required in the interpretation of the estimated coefficients. Throughout this chapter, we’ll use the data set of <span class="citation" data-cites="COST:MITT:MCCL:09">Costanigro, Mittelhammer, and McCluskey (<a href="#ref-COST:MITT:MCCL:09" role="doc-biblioref">2009</a>)</span> (called <code>wine</code>) who estimate a hedonic price function for wines. </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">wine</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9,600 × 11
  price cases score   age region    variety vintage reserve vineyard
  &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;fct&gt;     &lt;fct&gt;   &lt;fct&gt;   &lt;fct&gt;   &lt;fct&gt;   
1  27.1   300    86     3 sonoma    pinot   95      no      no      
2  32.1   500    90     3 mendocino cabern… 97      yes     no      
3  25.5  1635    84     2 mendocino pinot   other   no      no      
# ℹ 9,597 more rows
# ℹ 2 more variables: estate &lt;fct&gt;, class &lt;fct&gt;</code></pre>
</div>
</div>
<p>The data set contains 9600 wines, for which one observes:</p>
<ul>
<li>
<code>price</code>: the price in US$ of 2000 per bottle,</li>
<li>
<code>cases</code>: the production in number of cases, a case containing 12 bottles of 75 cl,</li>
<li>
<code>region</code>: the region where the wine comes from,</li>
<li>
<code>vineyard</code>: equal to <code>"yes"</code> if vineyard information is provided and <code>"no"</code> otherwise,</li>
<li>
<code>age</code>: the age of the wine in years, which is an integer, from 1 to 6,</li>
<li>
<code>score</code>: the score given by the Wine Spectator magazine, between 0 and 100.</li>
</ul>
<p>We divide the score by 100 so that the maximum attainable score is 1:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">wine</span> <span class="op">&lt;-</span> <span class="va">wine</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>score <span class="op">=</span> <span class="va">score</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="#sec-numerical_covariate"><span>Section&nbsp;4.1</span></a> deals with numerical covariates and <a href="#sec-categorical_covariates"><span>Section&nbsp;4.2</span></a> with categorical covariates. <a href="#sec-several_covariates"><span>Section&nbsp;4.3</span></a> introduces interactions between several covariates. Finally, <a href="#sec-marginal_effects"><span>Section&nbsp;4.4</span></a> presents useful tools to compute marginal effects.</p>
<section id="sec-numerical_covariate" class="level2" data-number="4.1"><h2 data-number="4.1" class="anchored" data-anchor-id="sec-numerical_covariate">
<span class="header-section-number">4.1</span> Numerical covariate</h2>
<p>We first consider the production as the unique covariate. High quality wines are often produced in small areas, with a low yield; we therefore expect a negative relationship between price and production. We consider two measures of production and price:</p>
<ul>
<li>production is measured in cases (<span class="math inline">\(x\)</span>) and in m<sup>3</sup> (<span class="math inline">\(w\)</span>). A case contains 12 bottles of 75 cl, or 9 liters, which is also <span class="math inline">\(9/1000\)</span> m<sup>3</sup>. Therefore, the number of cases must be multiplied by <span class="math inline">\(0.009\)</span> in order to get the production in m<sup>3</sup> (<span class="math inline">\(w = 0.009x\)</span>),</li>
<li>price (<span class="math inline">\(y\)</span>) is measured in US$ of 2000 per bottle. The price index in the United States was equal to 172 in 2000 and to 258 in 2020. Therefore, to get the price in US$ of 2020 (<span class="math inline">\(q\)</span>), we have to multiply the price in US$ of 2000 by <span class="math inline">\(258/172 = 1.5\)</span> (<span class="math inline">\(q = 1.5 y\)</span>).</li>
</ul>
<p>We perform these transformations, and we select only the relevant variables: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">wine2</span> <span class="op">&lt;-</span> <span class="va">wine</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span>x <span class="op">=</span> <span class="va">cases</span>, y <span class="op">=</span> <span class="va">price</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>w <span class="op">=</span> <span class="va">x</span> <span class="op">*</span> <span class="fl">0.009</span>,  q <span class="op">=</span> <span class="va">y</span> <span class="op">*</span> <span class="fl">1.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="response-and-covariate-in-level" class="level3"><h3 class="anchored" data-anchor-id="response-and-covariate-in-level">Response and covariate in level</h3>
<p>We start by a set of simple linear regressions of <span class="math inline">\(y\)</span> / <span class="math inline">\(q\)</span> on <span class="math inline">\(x\)</span> / <span class="math inline">\(w\)</span>: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">nn_yx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, <span class="va">wine2</span><span class="op">)</span></span>
<span><span class="va">nn_yw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">w</span>, <span class="va">wine2</span><span class="op">)</span></span>
<span><span class="va">nn_qx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">q</span> <span class="op">~</span> <span class="va">x</span>, <span class="va">wine2</span><span class="op">)</span></span>
<span><span class="va">nn_qw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">q</span> <span class="op">~</span> <span class="va">w</span>, <span class="va">wine2</span><span class="op">)</span></span>
<span><span class="va">nn_yx</span> <span class="op">%&gt;%</span> <span class="va">coef</span></span>
<span><span class="co">## (Intercept)           x </span></span>
<span><span class="co">##  31.7118276  -0.0003312</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The initial model, with <span class="math inline">\(y\)</span> and <span class="math inline">\(x\)</span> is: <span class="math inline">\(y_n = \alpha + \beta_x x_n + \epsilon_n\)</span>. <span class="math inline">\(y\)</span> being measured in US$ of 2000, so are <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\beta x_n\)</span> and <span class="math inline">\(\epsilon_n\)</span>. The intercept indicates the expected value of a bottle of wine when the production is 0, which of course makes no sense. However, we can consider the intercept as the expected value of a bottle for a wine with a very low production. We get here: 31.7. <span class="math inline">\(\beta_x x\)</span> is measured in US$ of 2000 and <span class="math inline">\(x\)</span> in cases, <span class="math inline">\(\beta_x\)</span> is measured in US$ of 2000 per case. Therefore, when the production increases by one case, the price of a bottle decreases by -3.3^{-4} US$ of 2000, i.e., 0.03 cent. The residuals and the fitted values are also measured in US$ of 2000. To see the response, the fitted values and the residuals, we can create a tibble, using the <code>resid</code> and the <code>fitted</code> functions: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">tibble</span><span class="op">(</span>y <span class="op">=</span> <span class="va">wine2</span><span class="op">$</span><span class="va">y</span>, heps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">nn_yx</span><span class="op">)</span>, hy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html">fitted</a></span><span class="op">(</span><span class="va">nn_yx</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>or more simply using the <code><a href="https://generics.r-lib.org/reference/augment.html">broom::augment</a></code> function, which adds to the model frame of a fitted object different columns, including the residuals (<code>.resid</code>) and the fitted values (<code>.fitted</code>): </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/">broom</a></span><span class="op">)</span></span>
<span><span class="va">nn_yx</span> <span class="op">%&gt;%</span> <span class="va">augment</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9,600 × 8
      y     x .fitted .resid     .hat .sigma      .cooksd .std.resid
  &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;        &lt;dbl&gt;      &lt;dbl&gt;
1  27.1   300    31.6 -4.49  0.000120   19.5 0.00000319      -0.231 
2  32.1   500    31.5  0.554 0.000118   19.5 0.0000000479     0.0285
3  25.5  1635    31.2 -5.67  0.000112   19.5 0.00000475      -0.291 
4  27.0   800    31.4 -4.41  0.000116   19.5 0.00000299      -0.226 
5  26.4  1150    31.3 -4.93  0.000114   19.5 0.00000368      -0.253 
# ℹ 9,595 more rows</code></pre>
</div>
</div>
<p>For example, for the first wine in the sample, the observed price is $27.1 and is the sum of:</p>
<ul>
<li>the prediction of the model, i.e., the estimation of the expected value of a bottle for this level of production: 31.6,</li>
<li>the residual, i.e., the difference between the actual and the predicted price, which is negative for the first bottle (<span class="math inline">\(-4.49\)</span>).</li>
</ul>
<p>We now measure the price in US$ of 2020. This means that the unit of measurement of the response, as well as that of <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\beta_x x_n\)</span> and <span class="math inline">\(\epsilon_n\)</span> is changed. More precisely, all these values are multiplied by 1.5. <span class="math inline">\(\beta_x x_n\)</span> is multiplied by 1.5, but as <span class="math inline">\(x_n\)</span> is unchanged, <span class="math inline">\(\beta_x\)</span> is multiplied by 1.5. </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">nn_qx</span><span class="op">)</span></span>
<span><span class="co">## (Intercept)           x </span></span>
<span><span class="co">##  47.5677414  -0.0004969</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">nn_qx</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">nn_yx</span><span class="op">)</span></span>
<span><span class="co">## (Intercept)           x </span></span>
<span><span class="co">##         1.5         1.5</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">nn_qx</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">##       1       2 </span></span>
<span><span class="co">## -6.7387  0.8307</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">nn_qx</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">nn_yx</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">##   1   2 </span></span>
<span><span class="co">## 1.5 1.5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For example, the price of the first bottle is lower than the estimated expected value for this given level of production by an amount of <span class="math inline">\(-6.74\)</span> US$ of 2020, which is 1.5 times the residual of the initial regression (<span class="math inline">\(-4.49\)</span>).</p>
<p>Consider now that the production is measured in m<sup>3</sup> and the price in US$ of 2000. The reference model can in this case be rewritten as:</p>
<p><span class="math display">\[
y_n = \alpha + \beta_x (w_n / 0.009) + \epsilon_n = \alpha + (\beta_x / 0.009) w_n + \epsilon_n =
\alpha + \beta_w w_n + \epsilon_n
\]</span> Compared to the reference model, the three elements of the model are still measured in US$ of 2000, and it is particularly the case for <span class="math inline">\(\beta_w w_n\)</span>. As the production is now measured in m<sup>3</sup>, it has been multiplied by 0.009, and therefore, the slope is divided by the same amount. The intercept, the predictions and the residuals still have the same unit of measurement (US$ of 2000) and therefore the same values. </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">nn_yw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">w</span>, <span class="va">wine2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">nn_yw</span><span class="op">)</span></span>
<span><span class="co">## (Intercept)           w </span></span>
<span><span class="co">##    31.71183    -0.03681</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">nn_yx</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">nn_yw</span><span class="op">)</span></span>
<span><span class="co">## (Intercept)           x </span></span>
<span><span class="co">##       1.000       0.009</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The price of a bottle of very rare wine is still 31.7 US$ of 2000, and the slope now indicates that when the production increases by 1 m<sup>3</sup>, the price of a bottle decreases by <span class="math inline">\(-0.037\)</span>, which is approximately 4 cents.</p>
</section><section id="covariate-in-logarithm" class="level3"><h3 class="anchored" data-anchor-id="covariate-in-logarithm">Covariate in logarithm</h3>
<p>We now consider that the covariate is the logarithm of the production: <span class="math inline">\(y_n = \alpha + \beta_x \ln x_n + \epsilon_n\)</span>. The response is still measured in US$ of 2000, and therefore so are <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\beta_x \ln x_n\)</span>, <span class="math inline">\(\epsilon_n\)</span>, <span class="math inline">\(\hat{y}_n\)</span> and <span class="math inline">\(\hat{\epsilon}_n\)</span>. </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">nl_yx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="va">wine2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">nl_yx</span><span class="op">)</span></span>
<span><span class="co">## (Intercept)      log(x) </span></span>
<span><span class="co">##      57.008      -3.708</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The intercept is now the expected value of the price of a bottle for <span class="math inline">\(x=1\)</span> (and not 0 as previously) and is therefore not particularly meaningful. <span class="math inline">\(\beta_x\)</span> is now the derivative of <span class="math inline">\(y\)</span> with <span class="math inline">\(\ln x\)</span>, which is <span class="math inline">\(\beta_x = \frac{dy}{d\ln x}= \frac{dy}{dx /x}\)</span>. Therefore, <span class="math inline">\(\beta_x\)</span> is the ratio of an absolute variation of <span class="math inline">\(y\)</span> and a relative variation of <span class="math inline">\(x\)</span>. For <span class="math inline">\(dx/x=1\)</span>, which means that the production is multiplied by 2, <span class="math inline">\(dy = -3.71\)</span>, which means that the price of the bottle decreases by -3.71 US$ of 2000. </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">nl_yx</span> <span class="op">%&gt;%</span> <span class="va">augment</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9,600 × 8
      y `log(x)` .fitted .resid     .hat .sigma   .cooksd .std.resid
  &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
1  27.1     5.70    35.9  -8.74 0.000219   19.1   2.30e-5    -0.458 
2  32.1     6.21    34.0  -1.87 0.000156   19.1   7.47e-7    -0.0979
3  25.5     7.40    29.6  -4.07 0.000105   19.1   2.40e-6    -0.214 
4  27.0     6.68    32.2  -5.18 0.000120   19.1   4.43e-6    -0.272 
5  26.4     7.05    30.9  -4.48 0.000106   19.1   2.93e-6    -0.235 
# ℹ 9,595 more rows</code></pre>
</div>
</div>
<p>With this new specification, for the first bottle, the price is lower than the expected value of the price by an amount of <span class="math inline">\(-8.74\)</span>. If the production is measured in m<sup>3</sup>, we get, replacing <span class="math inline">\(x_n\)</span> by <span class="math inline">\(w_n / 0.009\)</span>:</p>
<p><span class="math display">\[
y_n = \alpha + \beta_x \ln (w_n / 0.009) + \epsilon_n =
y_n = (\alpha - \beta_x \ln 0.009) + \beta_x \ln w_n + \epsilon_n
\]</span> </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">nl_yw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">w</span><span class="op">)</span>, <span class="va">wine2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">nl_yw</span><span class="op">)</span></span>
<span><span class="co">## (Intercept)      log(w) </span></span>
<span><span class="co">##      39.544      -3.708</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Therefore, the slope is unchanged because it measures the effect of doubling the production on the price, which obviously doesn’t depend on the unit of measurement of the production. The intercept is modified by an amount equal to <span class="math inline">\(-\beta_x\ln 0.009\)</span>: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">nl_yw</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">nl_yx</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##      -17.46</span></span>
<span><span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">nl_yw</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">0.009</span><span class="op">)</span></span>
<span><span class="co">## log(w) </span></span>
<span><span class="co">## -17.46</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Consider now that the price is measured in US$ of 2020:</p>
<p><span class="math display">\[
y_n = \frac{q_n}{1.5} = \alpha + \beta_x \ln x_n + \epsilon_n
\]</span></p>
<p>All the elements of the initial model are therefore multiplied by 1.5: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">nl_qx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">q</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="va">wine2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">nl_qx</span><span class="op">)</span></span>
<span><span class="co">## (Intercept)      log(x) </span></span>
<span><span class="co">##      85.513      -5.561</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">nl_qx</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">nl_yx</span><span class="op">)</span></span>
<span><span class="co">## (Intercept)      log(x) </span></span>
<span><span class="co">##         1.5         1.5</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">nl_qx</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="co">##       1       2       3 </span></span>
<span><span class="co">## -13.112  -2.801  -6.112</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">nl_qx</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">nl_yx</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="co">##   1   2   3 </span></span>
<span><span class="co">## 1.5 1.5 1.5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="response-in-logarithm" class="level3"><h3 class="anchored" data-anchor-id="response-in-logarithm">Response in logarithm</h3>
<p>Consider now the case when the response is in logarithm. In terms of the response, we then start from a multiplicative model:</p>
<p><span class="math display">\[
y_n = e^{\alpha + \beta_x x} (1 + \eta_n)
\]</span> where <span class="math inline">\(\eta_n\)</span> is a multiplicative error. For example, if <span class="math inline">\(\eta_n=-0.2\)</span>, it means that for the given wine, the price is 20% lower than the expected value for this level of production. Taking logs, we get:</p>
<p><span class="math display">\[
\ln y_n = \alpha + \beta_x x_n + \ln(1 + \eta_n) = \alpha + \beta_x x_n + \epsilon_n
\]</span></p>
<p>The error term is now <span class="math inline">\(\epsilon = \ln(1 + \eta_n)\)</span>. But, if <span class="math inline">\(\eta_n\)</span> is “small”: <span class="math inline">\(\ln(1+\eta_n) \approx \eta_n\)</span>. For example, <span class="math inline">\(\ln(1 + 0.05) = 0.049\)</span> and <span class="math inline">\(\ln(1 - 0.10) = -0.105\)</span>. Therefore, <span class="math inline">\(\epsilon\)</span> can be interpreted as a percentage of variation between the actual price and the expected value for the given level of production. </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ln_yx</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">~</span> <span class="va">x</span>, <span class="va">wine2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">ln_yx</span><span class="op">)</span></span>
<span><span class="co">## (Intercept)           x </span></span>
<span><span class="co">##   3.3076419  -0.0000138</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The intercept is now the expected value of <span class="math inline">\(\ln y\)</span> when <span class="math inline">\(x = 0\)</span>. Taking the exponential of the intercept, we get: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">ln_yx</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##       27.32</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>which is quite close to the value obtained in the reference model (31.71). <span class="math inline">\(\beta_x\)</span> is now the derivative of <span class="math inline">\(\ln y\)</span> with <span class="math inline">\(x\)</span>:</p>
<p><span class="math display">\[
\frac{d \ln y}{d x} = \frac{dy / y}{d x}
\]</span></p>
<p>It is therefore the ratio of a relative variation of <span class="math inline">\(y\)</span> and an absolute variation of <span class="math inline">\(x\)</span>. The results indicate that when the production increases by one case, the relative variation of the price is -10^{-5}, i.e., approximately <span class="math inline">\(0.001\)</span>%. Consider now the production in m<sup>3</sup>:</p>
<p><span class="math display">\[
\ln y_n = \alpha + \beta_x (w_n / 0.009) + \epsilon_n = \alpha +
(\beta_x / 0.009) w_n + \epsilon_n
\]</span></p>
<p>The only effect of this change of measurement for the covariate is that, as the covariate is multiplied by <span class="math inline">\(0.009\)</span>, <span class="math inline">\(\beta_x\)</span> is divided by the same amount: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ln_yw</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">~</span> <span class="va">w</span>, <span class="va">wine2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">ln_yw</span><span class="op">)</span></span>
<span><span class="co">## (Intercept)           w </span></span>
<span><span class="co">##    3.307642   -0.001533</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">ln_yx</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">ln_yw</span><span class="op">)</span></span>
<span><span class="co">## (Intercept)           x </span></span>
<span><span class="co">##       1.000       0.009</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>the intercept, the fitted values and the residuals being unchanged. If the response is measured in US$ of 2020, starting from the initial model, we have:</p>
<p><span class="math display">\[
\ln y_n = \ln \frac{q_n}{1.5} = \alpha + \beta_x x_n + \epsilon_n
\]</span></p>
<p>which leads to:</p>
<p><span class="math display">\[
\ln q_n = (\alpha + \ln 1.5) + \beta_x x_n + \epsilon_n
\]</span></p>
<p>Therefore, the only effect is that the intercept increases by <span class="math inline">\(\ln 1.5\)</span>: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ln_qw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">q</span><span class="op">)</span> <span class="op">~</span> <span class="va">w</span>, <span class="va">wine2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">ln_qw</span><span class="op">)</span></span>
<span><span class="co">## (Intercept)           w </span></span>
<span><span class="co">##    3.713107   -0.001533</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">ln_qw</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">ln_yw</span><span class="op">)</span></span>
<span><span class="co">## (Intercept)           w </span></span>
<span><span class="co">##   4.055e-01  -6.072e-18</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.4055</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>the slope, the predictions and the residuals being unchanged.</p>
</section><section id="response-and-covariate-in-log" class="level3"><h3 class="anchored" data-anchor-id="response-and-covariate-in-log">Response and covariate in log</h3>
<p>Consider finally the case where both the response and the covariate are in logs:</p>
<p><span class="math display">\[
\ln y_n = \beta_0 +\beta_x \ln x_n + \epsilon_n
\]</span></p>
<p>The slope is the derivative of <span class="math inline">\(\ln y\)</span> with <span class="math inline">\(\ln x\)</span>:</p>
<p><span class="math display">\[
\beta_x = \frac{d\ln y}{d\ln x}=\frac{dy / y}{dx / x}
\]</span></p>
<p>and is therefore a ratio of two relative variations.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ll_yx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="va">wine2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">ll_yx</span><span class="op">)</span></span>
<span><span class="co">## (Intercept)      log(x) </span></span>
<span><span class="co">##      4.3042     -0.1466</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When <span class="math inline">\(dx / x = 1\)</span>, which means that the production is doubling, the relative variation of the price is <span class="math inline">\(-0.147\)</span> or <span class="math inline">\(-14.7\)</span>%. Equivalently, when the production increases by 1%, the price decreases by <span class="math inline">\(-0.147\)</span>%; <span class="math inline">\(\beta_x\)</span> is an elasticity and is a number without unit. Therefore, it is invariant to any linear transformation of the covariate or of the response. </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ll_yw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">w</span><span class="op">)</span>, <span class="va">wine2</span><span class="op">)</span></span>
<span><span class="va">ll_qx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">q</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="va">wine2</span><span class="op">)</span></span>
<span><span class="va">ll_qw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">q</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">w</span><span class="op">)</span>, <span class="va">wine2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span>ll_yx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">ll_yx</span><span class="op">)</span>, ll_yw <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">ll_yw</span><span class="op">)</span>,</span>
<span>      ll_qx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">ll_qx</span><span class="op">)</span>, ll_qw <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">ll_qw</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">##       (Intercept)  log(x)</span></span>
<span><span class="co">## ll_yx       4.304 -0.1466</span></span>
<span><span class="co">## ll_yw       3.614 -0.1466</span></span>
<span><span class="co">## ll_qx       4.710 -0.1466</span></span>
<span><span class="co">## ll_qw       4.019 -0.1466</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="sec-integer_covariate" class="level3"><h3 class="anchored" data-anchor-id="sec-integer_covariate">Integer covariate</h3>
<p>Consider the same model: <span class="math inline">\(y_n = \alpha + \beta_x x_n + \epsilon_n\)</span>, but <span class="math inline">\(x_n\)</span> is now an integer. In the <code>wine</code> data set, <code>age</code> is the age of the wine in years, from 1 to 6. </p>
<div class="cell" data-layout-align="center">

</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">price</span> <span class="op">~</span> <span class="va">age</span>, <span class="va">wine</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">coef</span></span>
<span><span class="co">## (Intercept)         age </span></span>
<span><span class="co">##       9.910       7.288</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span class="math inline">\(\beta\)</span> is still the derivative of <span class="math inline">\(y\)</span> with <span class="math inline">\(x\)</span>, but the computation of the derivative makes little sense when <span class="math inline">\(x\)</span> is an integer, as infinitesimal variations are not relevant in this case. Therefore, instead of a marginal effect, one is interested in a discrete variation of <span class="math inline">\(x_n\)</span> (for example from 3 to 4). If we compute the variation of <span class="math inline">\(\mbox{E}(y \mid x = x_n)\)</span> when <span class="math inline">\(x\)</span> increases from <span class="math inline">\(x_n\)</span> to <span class="math inline">\(x_n + 1\)</span>, we get:</p>
<p><span class="math display">\[\left(\alpha + \beta_x (x_n + 1)\right) - \left(\alpha + \beta_x x_n\right) = \beta_x\]</span></p>
<p>Therefore, <span class="math inline">\(\beta_x\)</span> is not only the derivative, but it is also the variation of <span class="math inline">\(y\)</span> caused by an increase of one unit of <span class="math inline">\(x\)</span>. In our example, when the age of the wine increases by one year, its expected price increases by $7.3.</p>
</section></section><section id="sec-categorical_covariates" class="level2" data-number="4.2"><h2 data-number="4.2" class="anchored" data-anchor-id="sec-categorical_covariates">
<span class="header-section-number">4.2</span> Categorical covariate</h2>
<p>A categorical variable is a variable that defines a set of modalities, each observations belonging to one modality and only one. The preferred way to deal with categorical variables with <strong>R</strong> is to use a variable type that is called <strong>factor</strong>, the modalities being called <strong>levels</strong>. Factors have at least two levels. A categorical variable with two levels is a <strong>dichotomic</strong> variable, and the factor can be replaced by a dummy variable (a numerical variable for which the only two values are 0 and 1). For example, sex can be stored as a factor with levels male and female, or as a dummy variable with for example 1 for females and 0 for males. When the number of levels is greater than 2, the variable is <strong>polytomic</strong>, and it is advisable to store the variable as a factor. Base <strong>R</strong> proposed several functions to deal with factors, but we’ll use the <strong>forcats</strong> packages which is part of the <strong>tidyverse</strong>.</p>
<section id="dichotomic-variable" class="level3"><h3 class="anchored" data-anchor-id="dichotomic-variable">Dichotomic variable</h3>
<p>We consider here the <code>"vineyard"</code> variable which has two modalities (<code>"yes"</code> and <code>"no"</code>), and we create a variant of this variable by creating a dummy variable equal to <span class="math inline">\(1\)</span> if <code>vineyard</code> is equal to <code>"yes"</code> and 0 otherwise: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">wine</span> <span class="op">&lt;-</span> <span class="va">wine</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>vyd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">vineyard</span> <span class="op">==</span> <span class="st">"yes"</span>, <span class="fl">1L</span>, <span class="fl">0L</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="response-in-level" class="level4"><h4 class="anchored" data-anchor-id="response-in-level">Response in level</h4>
<p>We first compute the average price for the two categories: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Mwine</span> <span class="op">&lt;-</span> <span class="va">wine</span> <span class="op">%&gt;%</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">vineyard</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">summarise</span><span class="op">(</span>price <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">price</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Mwine</span></span>
<span><span class="co">## # A tibble: 2 × 2</span></span>
<span><span class="co">##   vineyard price</span></span>
<span><span class="co">##   &lt;fct&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">## 1 no        28.9</span></span>
<span><span class="co">## 2 yes       34.9</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The average price difference between the two categories is substantial ($5.97). We now consider the estimation of the linear model, with <span class="math inline">\(x_n\)</span> a dummy variable equal to 1 if the wine has vineyard indications. The effect of <span class="math inline">\(x_n\)</span> varying from 0 to 1 on the conditional expectation of the price is:</p>
<p><span class="math display">\[
(\alpha + \beta_x \times 1) - (\alpha + \beta_x \times 0) = \beta_x
\]</span> We then estimate the linear model, using <code>vineyard</code> and <code>vyd</code>: </p>
<div class="cell" data-layout-align="center" data-level="ols_dichotomic">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">price</span> <span class="op">~</span> <span class="va">vyd</span>, <span class="va">wine</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">coef</span></span>
<span><span class="co">## (Intercept)         vyd </span></span>
<span><span class="co">##      28.900       5.974</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">price</span> <span class="op">~</span> <span class="va">vineyard</span>, <span class="va">wine</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">coef</span></span>
<span><span class="co">## (Intercept) vineyardyes </span></span>
<span><span class="co">##      28.900       5.974</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The intercept is the average price for wines with no vineyard indication, and <span class="math inline">\(\beta_x\)</span> is the price increase caused by vineyard indication. Note also that <span class="math inline">\(\alpha + \beta_x\)</span> is the average price for wines with a vineyard indication. Identical results are obtained using either <code>vyd</code> and <code>vineyard</code>. The difference is that in the first case, <code>vyd</code> is directly used in the regression. In the second case, the factor <code>vineyard</code> is replaced in the regression by a dummy variable called <code>vineyardyes</code> equal to 1 when <code>vineyard</code> equals <code>"yes"</code>.</p>
<p>Removing the intercept, we get: </p>
<div class="cell" data-layout-align="center" data-level="ols_dichotomic">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">price</span> <span class="op">~</span> <span class="va">vineyard</span> <span class="op">-</span> <span class="fl">1</span>, <span class="va">wine</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">coef</span></span>
<span><span class="co">##  vineyardno vineyardyes </span></span>
<span><span class="co">##       28.90       34.87</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Two dummies are created, one for <code>vineyard = "yes"</code> as previously done, but also one for <code>vineyard = "no"</code>. The two coefficients are now average prices for the two categories.</p>
</section><section id="response-in-log" class="level4"><h4 class="anchored" data-anchor-id="response-in-log">Response in log</h4>
<p>Consider now a regression with the response in log and a dummy covariate: <span class="math inline">\(\ln y_n = \alpha + \beta_x x_n + \epsilon_n\)</span>. Consider two wines with the same value of <span class="math inline">\(\epsilon\)</span>, but one with <span class="math inline">\(x = 1\)</span> and the other with <span class="math inline">\(x = 0\)</span>, and call <span class="math inline">\(y^1\)</span> and <span class="math inline">\(y^0\)</span> the respective prices. The difference in log price is:</p>
<p><span class="math display">\[
\ln y^1 - \ln y^0 = \beta_x
\]</span></p>
<p>Denoting <span class="math inline">\(\tau_x = \frac{y^1 - y^0}{y^0}\)</span> the variation rate of the price for a wine with vineyard indication compared to a wine without vineyard indication, we get:</p>
<p><span class="math display">\[
\ln y^1 - \ln y^0 = \ln (1 + \tau_x) = \beta_x
\]</span></p>
<p><span class="math inline">\(\beta_x\)</span> is therefore equal to <span class="math inline">\(\ln (1 + \tau)\)</span> and, as seen previously, for a “small” value of <span class="math inline">\(\tau_x\)</span>, <span class="math inline">\(\ln (1 + \tau_x) \approx \tau_x\)</span>. Therefore, <span class="math inline">\(\beta_x\)</span> is approximately the relative price difference for a wine with and without vineyard indications.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">log_bin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">price</span><span class="op">)</span> <span class="op">~</span> <span class="va">vineyard</span>, <span class="va">wine</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">log_bin</span><span class="op">)</span></span>
<span><span class="co">## (Intercept) vineyardyes </span></span>
<span><span class="co">##       3.191       0.248</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span class="math inline">\(\hat{\beta}_x=0.25\)</span> is the approximation of the relative difference (25%), as the true relative difference is given by the formula: <span class="math inline">\(\tau = e^{\beta_x}-1\)</span>, which is 0.28. Therefore, <span class="math inline">\(\hat{\beta}_x\)</span> gives quite a good approximation of the relative difference.</p>
</section></section><section id="polytomic-covariate" class="level3"><h3 class="anchored" data-anchor-id="polytomic-covariate">Polytomic covariate</h3>
<p>Consider now the case of a polytomic covariate. <code>region</code> is a factor with numerous modalities: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">wine</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">region</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">levels</span></span>
<span><span class="co">## [1] "other"      "napavalley" "baycentral" "sonoma"     "southcoast"</span></span>
<span><span class="co">## [6] "carneros"   "sierra"     "mendocino"  "washington"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To simplify, we keep only the two most important regions (Napa Valley and Sonoma) and merge all the other regions in a <code>other</code> category. This operation is easily performed using the <code><a href="https://forcats.tidyverse.org/reference/fct_lump.html">forcats::fct_lump</a></code> function: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">wine</span> <span class="op">&lt;-</span> <span class="va">wine</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>reg <span class="op">=</span> <span class="fu">fct_lump</span><span class="op">(</span><span class="va">region</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">wine</span> <span class="op">%&gt;%</span> <span class="fu">count</span><span class="op">(</span><span class="va">reg</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  reg            n
  &lt;fct&gt;      &lt;int&gt;
1 napavalley  2770
2 sonoma      2358
3 Other       4472</code></pre>
</div>
</div>
<p>The <code>reg</code> variable has then three modalities: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">wine</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">reg</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">levels</span></span>
<span><span class="co">## [1] "napavalley" "sonoma"     "Other"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="response-in-level-1" class="level4"><h4 class="anchored" data-anchor-id="response-in-level-1">Response in level</h4>
<p>We first compute the average price for these three modalities: </p>
<div class="cell" data-layout-align="center" data-level="count_modalities_polytomic">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Mwine</span> <span class="op">&lt;-</span> <span class="va">wine</span> <span class="op">%&gt;%</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">reg</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">summarise</span><span class="op">(</span>price <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">price</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Mwine</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  reg        price
  &lt;fct&gt;      &lt;dbl&gt;
1 napavalley  41.3
2 sonoma      28.7
3 Other       23.9</code></pre>
</div>
</div>
<p>Consider a linear model, without and with an intercept: </p>
<div class="cell" data-layout-align="center" data-level="polytomic_with_without_intercept">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lin_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">price</span> <span class="op">~</span> <span class="va">reg</span> <span class="op">-</span> <span class="fl">1</span>, <span class="va">wine</span><span class="op">)</span></span>
<span><span class="va">lin_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">price</span> <span class="op">~</span> <span class="va">reg</span>, <span class="va">wine</span><span class="op">)</span></span>
<span><span class="va">lin_1</span> <span class="op">%&gt;%</span> <span class="va">coef</span></span>
<span><span class="co">## regnapavalley     regsonoma      regOther </span></span>
<span><span class="co">##         41.28         28.72         23.90</span></span>
<span><span class="va">lin_2</span> <span class="op">%&gt;%</span> <span class="va">coef</span></span>
<span><span class="co">## (Intercept)   regsonoma    regOther </span></span>
<span><span class="co">##       41.28      -12.55      -17.37</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Without an intercept, three dummy variables are created and introduced in the regression. With an intercept, only two dummy variables are introduced. We have noted previously that the three levels are <code>napavalley</code>, <code>sonoma</code> and <code>Other</code>. The name of the dummy variables are obtained by merging the name of the variable <code>reg</code> and the name of the level. Note that when an intercept is introduced, the dummy variable corresponding to the first level (here <code>napavalley</code>) is omitted. Without an intercept, the three estimated coefficients are simply the average prices for the three regions. With an intercept, the intercept is the average price for the first level of the variable (the Napa Valley region) and the two other coefficients are the differences between the average price for the two regions and the average price for the reference region (Napa Valley). For example, using the second regression (<code>lin_2</code>), the average price for the Sonoma region can be computed as the sum of the first two coefficients: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unname.html">unname</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">lin_2</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">lin_2</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">## [1] 28.72</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The reference level can be changed by modifying the order of the levels of the factor. This task can easily be performed using the <code><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">forcats::fct_relevel</a></code> function and indicating, for example, that <code>"Other"</code> should be the first level: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">wine</span> <span class="op">&lt;-</span> <span class="fu">mutate</span><span class="op">(</span><span class="va">wine</span>, reg <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">reg</span>, <span class="st">"Other"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">lin_2b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">price</span> <span class="op">~</span> <span class="va">reg</span>, <span class="va">wine</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">lin_2b</span><span class="op">)</span></span>
<span><span class="co">##   (Intercept) regnapavalley     regsonoma </span></span>
<span><span class="co">##         23.90         17.37          4.82</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The average price for Sonoma is now equal to the sum of the first coefficient (the intercept which is the average price for “other regions”) and the third coefficient (the difference between the average price in Sonoma and “other regions”): </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unname.html">unname</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">lin_2b</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">lin_2b</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">## [1] 28.72</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="response-in-log-1" class="level4"><h4 class="anchored" data-anchor-id="response-in-log-1">Response in log</h4>
<p>We first compute the average of the <em>log</em> prices for the three regions: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Mwine</span> <span class="op">&lt;-</span> <span class="va">wine</span> <span class="op">%&gt;%</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">reg</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarise</span><span class="op">(</span>mprice <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">price</span><span class="op">)</span>, </span>
<span>              lprice <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">price</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              mlprice <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">lprice</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Mwine</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  reg        mprice lprice mlprice
  &lt;fct&gt;       &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
1 Other        23.9   3.04    20.9
2 napavalley   41.3   3.56    35.2
3 sonoma       28.7   3.24    25.6</code></pre>
</div>
</div>
<p>By definition, taking the exponential of the mean of the logs, we get the geometric mean of prices, which is always lower than the arithmetic mean. Estimating the model without intercept: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">log_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">price</span><span class="op">)</span> <span class="op">~</span> <span class="va">reg</span> <span class="op">-</span> <span class="fl">1</span>, <span class="va">wine</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">log_3</span><span class="op">)</span></span>
<span><span class="co">##      regOther regnapavalley     regsonoma </span></span>
<span><span class="co">##         3.040         3.562         3.243</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- new page -->
<div style="page-break-after: always;"></div>
<p>we get a model with a coefficient for the three regions. Taking the exponential of these coefficients, we get the geometric means of price previously computed for the three regions. Adding an intercept, only two dummies are introduced in the regression: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">log_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">price</span><span class="op">)</span> <span class="op">~</span> <span class="va">reg</span>, <span class="va">wine</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">log_2</span><span class="op">)</span></span>
<span><span class="co">##   (Intercept) regnapavalley     regsonoma </span></span>
<span><span class="co">##        3.0399        0.5221        0.2033</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The intercept is the mean of the logarithms of the prices for the reference region. The coefficient for the Napa Valley region is the difference of mean log prices for the Napa Valley and “other regions”.</p>
<p><span class="math display">\[
\beta^s = \ln y^s_n - \ln y^o_n = \ln \frac{y^s_n}{y^o_n} = \ln (1 +
\tau_{s}) \approx \tau_{s}
\]</span> where <span class="math inline">\(\tau_{s}\)</span> is the relative price difference between Sonoma and “other regions”. <span class="math inline">\(\beta^s\)</span> is an approximation of <span class="math inline">\(\tau_{s}\)</span>. The coefficient is 0.52 (or 52%) as the exact formula for <span class="math inline">\(\tau\)</span> gives 0.69 (or 69%). The approximation in this example is quite bad, because the value of <span class="math inline">\(\hat{\beta}^s\)</span> is high.</p>
</section></section></section><section id="sec-several_covariates" class="level2" data-number="4.3"><h2 data-number="4.3" class="anchored" data-anchor-id="sec-several_covariates">
<span class="header-section-number">4.3</span> Several covariates</h2>
<p>Most of the time, the model of interest includes several numerical and/or categorical covariates. A first step is to introduce these covariates separately, so that their linear effect is analyzed. But it is also sometimes interesting to introduce the product of two covariates in the regression. This enables to analyze the interaction effect of two covariates, i.e., the fact that the effect of <span class="math inline">\(x_1\)</span> on <span class="math inline">\(y\)</span> depends on the value of <span class="math inline">\(x_2\)</span>.</p>
<section id="separate-effects" class="level3"><h3 class="anchored" data-anchor-id="separate-effects">Separate effects</h3>
<p>Consider the log-log model with the numerical <code>cases</code> covariate and add the <code>reg</code> categorical variable. We use the <code>+</code> operator in the formula to separate these two covariates: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">di_us</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">price</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">cases</span><span class="op">)</span> <span class="op">+</span> <span class="va">reg</span>, <span class="va">wine</span><span class="op">)</span></span>
<span><span class="va">di_us</span> <span class="op">%&gt;%</span> <span class="va">coef</span></span>
<span><span class="co">##   (Intercept)    log(cases) regnapavalley     regsonoma </span></span>
<span><span class="co">##        4.0966       -0.1456        0.5186        0.2071</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From previous subsections, we are able to interpret the results:</p>
<ul>
<li>a 1% increase in production leads to a decrease of <span class="math inline">\(-0.15\)</span>% in price,</li>
<li>wine produced in Napa Valley and Sonoma are more expensive than wine produced in other regions (by an amount approximately equal to 51.9% and 20.7%).</li>
</ul>
<div style="page-break-after: always;"></div>
<p>This model is represented in <a href="#fig-additive_effects">Figure&nbsp;<span>4.1</span></a>. The slope is the same for the three regions, but the intercept is different. Therefore, the fitted model is represented by three parallel lines. Note that the sample mean for each region, depicted by a large point, is part of the corresponding regression line.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-additive_effects" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="coefficients_files/figure-html/fig-additive_effects-1.png" class="img-fluid figure-img" style="width:60.0%"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.1: Additive effects of production and region</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section><section id="multiplicative-effects" class="level3"><h3 class="anchored" data-anchor-id="multiplicative-effects">Multiplicative effects</h3>
<p>A multiplicative effect is obtained by introducing in the regression the product of two covariates. Consider first the case where the two covariates are numeric; we’ll consider as an example the production in m<sup>3</sup> (<code>prodcubm</code>) and <code>score</code>. The product can be computed before the estimation: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">wine</span> <span class="op">&lt;-</span> <span class="va">wine</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>prodcubm <span class="op">=</span> <span class="va">cases</span> <span class="op">*</span> <span class="fl">0.009</span>, </span>
<span>                        prod_score <span class="op">=</span> <span class="va">prodcubm</span> <span class="op">*</span> <span class="va">score</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and introduced in the regression: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">price</span> <span class="op">~</span> <span class="va">prod_score</span>, <span class="va">wine</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">coef</span></span>
<span><span class="co">## (Intercept)  prod_score </span></span>
<span><span class="co">##    31.66271    -0.04194</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The same result can be obtained by computing “on the fly” the product in the formula: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">price</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">prodcubm</span> <span class="op">*</span> <span class="va">score</span><span class="op">)</span>, <span class="va">wine</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">coef</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note the use of the <code>I</code> function in the formula; arithmetic operators (<code>+</code>, <code>-</code>, <code>*</code>, <code>:</code> and <code>/</code>) have a special meaning in formulas and therefore they should be “protected” in order to perform the usual arithmetic operation. The last (and best solution) is to use the formula syntax: <code>x_1:x_2</code> introduces the interaction effect between <code>x_1</code> and <code>x_2</code>, i.e., their product: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">price</span> <span class="op">~</span> <span class="va">prodcubm</span><span class="op">:</span><span class="va">score</span>, <span class="va">wine</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">coef</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div style="page-break-after: always;"></div>
<p>This model is of the form: <span class="math inline">\(y_n = \alpha + \beta x_1 x_2 + \epsilon_n\)</span>. Therefore, the marginal effect of <span class="math inline">\(x_1\)</span> is <span class="math inline">\(\beta x_2\)</span> and the one of <span class="math inline">\(x_2\)</span> is <span class="math inline">\(\beta x_1\)</span>, which is difficult to justify. When one wants to introduce interaction effects, it’s recommended to introduce them with the additive effects. This can be performed using any of the following commands: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">price</span> <span class="op">~</span> <span class="va">prodcubm</span> <span class="op">+</span> <span class="va">score</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">prodcubm</span> <span class="op">*</span> <span class="va">score</span><span class="op">)</span>, <span class="va">wine</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">price</span> <span class="op">~</span> <span class="va">prodcubm</span> <span class="op">+</span> <span class="va">score</span> <span class="op">+</span> <span class="va">prod_score</span>, <span class="va">wine</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">price</span> <span class="op">~</span> <span class="va">prodcubm</span> <span class="op">+</span> <span class="va">score</span> <span class="op">+</span> <span class="va">prodcubm</span> <span class="op">:</span> <span class="va">score</span>, <span class="va">wine</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>the last expression uses the formula syntax, i.e., use <code>+</code> and <code>:</code>. However, introducing the additive and the interacting effect is a very common task, so that the <code>*</code> operator is devoted to this task: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">price</span> <span class="op">~</span> <span class="va">prodcubm</span> <span class="op">*</span> <span class="va">score</span>, <span class="va">wine</span><span class="op">)</span></span>
<span><span class="va">z</span> <span class="op">%&gt;%</span> <span class="va">coef</span></span>
<span><span class="co">##    (Intercept)       prodcubm          score prodcubm:score </span></span>
<span><span class="co">##      -191.9906         0.1487       259.2007        -0.2066</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This model is now of the form: <span class="math inline">\(y_n = \alpha + \beta_1 x_{n1} + \beta_2 x_{n2} + \beta_{12} x_{n1}x_{n2}\epsilon_n\)</span> and the marginal effect for <span class="math inline">\(x_1\)</span> is now <span class="math inline">\(\beta_1 + \beta_{12} x_{n2}\)</span>. This model has as a special case the additive model (<span class="math inline">\(\beta_{12} = 0\)</span>) and this hypothesis can be tested, which was not the case for the model with only the interaction between the two covariates. The marginal effect of one more m<sup>3</sup> of production is (denoting <span class="math inline">\(x_2\)</span> the score): <span class="math inline">\(0.149 - 0.207 x_2\)</span> and is therefore a decreasing function of the score. Note that the coefficient of <code>prodcubm</code> (<span class="math inline">\(0.149\)</span>) can be misleading. It indicates that, for a wine with a score equal to 0, the price increases with the production. But actually, such low scores are not observed, the lowest in the sample being 0.68 and for this value, the marginal effect of production is <span class="math inline">\(0.149 - 0.207 \times 0.68 = 0.01\)</span>. The marginal effect of production has the expected negative sign for <span class="math inline">\(x_2 &gt; 0.149 / 0.207 = 0.72\)</span>, which is the case for 9560 wines out of 9580 in the sample. Therefore, the model predicts a negative marginal effect of the production on the price of a bottle for almost the whole sample, and this negative effect increases with the score obtained by the wine. We can easily test the hypothesis that the additive model is relevant using the value of the Student statistic for the interaction term: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">4</span>, <span class="op">]</span></span>
<span><span class="co">##   Estimate Std. Error    t value   Pr(&gt;|t|) </span></span>
<span><span class="co">## -2.066e-01  4.972e-02 -4.155e+00  3.283e-05</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>which indicates that the interaction term is highly significant. For a model with the production and the age as covariates, we have: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">price</span> <span class="op">~</span> <span class="va">prodcubm</span> <span class="op">*</span> <span class="va">age</span>, <span class="va">wine</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">4</span>, <span class="op">]</span></span>
<span><span class="co">##   Estimate Std. Error    t value   Pr(&gt;|t|) </span></span>
<span><span class="co">##  4.489e-05  2.837e-03  1.582e-02  9.874e-01</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and this time, the interaction term is not significant and the additive model should be favored.</p>
</section><section id="polynomials" class="level3"><h3 class="anchored" data-anchor-id="polynomials">Polynomials</h3>
<p>Until now, we have introduced the numerical covariates either in level or in log. In both cases, a unique coefficient <span class="math inline">\(\hat{\beta}\)</span> is estimated and the marginal effect of the covariate on the response is necessarily monotonic, which is not in practice always a relevant feature. For example, in a famous article, <span class="citation" data-cites="KUZN:55">Kuznets (<a href="#ref-KUZN:55" role="doc-biblioref">1955</a>)</span> analyzed the relation between economic development and inequality and his analysis has been formalized by <span class="citation" data-cites="ROBI:76">Robinson (<a href="#ref-ROBI:76" role="doc-biblioref">1976</a>)</span>. A dual economy is considered, with a rural and an urban sector. In the rural sector, income is low and exhibits little variations as, in the urban sector, income is high and exhibits high variations. Denoting <span class="math inline">\(\mu_r\)</span> and <span class="math inline">\(\mu_u\)</span> the mean log-income in the rural and the urban sector and <span class="math inline">\(\sigma_r ^ 2\)</span> and <span class="math inline">\(\sigma_u ^ 2\)</span> the variance of log-income, it is therefore assumed that <span class="math inline">\(\mu_r &lt; \mu_u\)</span> and <span class="math inline">\(\sigma_r ^ 2 &lt; \sigma_u ^ 2\)</span>. <span class="math inline">\(x\)</span> is the share of the urban sector and, during the process of development, <span class="math inline">\(x\)</span> increases. The mean log-income for the whole economy is: <span id="eq-mean_logincome"><span class="math display">\[
\mu = (1 - x) \mu_r + x \mu_u = \mu_r + x (\mu_u - \mu_r)
\tag{4.1}\]</span></span></p>
<p>As <span class="math inline">\(\mu_u &gt; \mu_r\)</span>, mean log-income increases during the process of development. To get the variance of log-income for the whole economy, which is a measure of inequality, we apply the variance decomposition formula <!-- !!! rule of the variance ? --> <span id="eq-var_logincome"><span class="math display">\[
\sigma^2 = (1 - x) \sigma_r ^ 2 + x \sigma_u ^ 2 + (1-x)(\mu_r - \mu) ^ 2 + x(\mu_u - \mu) ^ 2
\tag{4.2}\]</span></span></p>
<p>Replacing <span class="math inline">\(\mu\)</span> by its expression in <a href="#eq-mean_logincome">Equation&nbsp;<span>4.1</span></a> and denoting <span class="math inline">\(\Delta_\mu = \mu_u - \mu_r\)</span> and <span class="math inline">\(\Delta_{\sigma^2} = \sigma_u ^ 2 - \sigma_r ^ 2\)</span>, <a href="#eq-var_logincome">Equation&nbsp;<span>4.2</span></a> can be rewritten as:</p>
<p><span class="math display">\[
\sigma^2 = \sigma_r ^ 2 +  (\Delta_{\sigma^2} + \Delta_\mu^2) x - \Delta_\mu ^ 2 x ^ 2
\]</span> Therefore, the overall variance of log-income is the equation of a parabola with a positive first order term and a negative second order term. Graphically, the relation between the share of the modern sector and the overall variance of log-income is inverted U-shaped. From <a href="#eq-mean_logincome">Equation&nbsp;<span>4.1</span></a>, the mean of log income is positively correlated with the share of the urban sector. The relation between the variance and the mean of log-income is therefore also inverted U-shaped, and is called in the economic literature the <strong>Kuznets curve</strong>. We use the <code>kuznets</code> data set, which is used by <span class="citation" data-cites="ANAN:KANB:93">Sudhir and Kanbur (<a href="#ref-ANAN:KANB:93" role="doc-biblioref">1993</a>)</span>: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">kuznets</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 60 × 5
  country  group        gnp  gini varlog
  &lt;chr&gt;    &lt;fct&gt;      &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 Chad     developing  79.5 0.369  0.368
2 Malawi   developing  80   0.470  0.576
3 Dahomey  developing  91.3 0.468  0.594
4 Pakistan developing  93.7 0.386  0.468
5 Tanzania developing 104.  0.503  0.661
# ℹ 55 more rows</code></pre>
</div>
</div>
<p>It contains data for 60 countries in the sixties; <code>group</code> categorizes developing, developed and socialist countries, <code>gnp</code> is the per capita gross national product in US$ of 1970, <code>gini</code> is the Gini index of inequality and <code>varlog</code> is the variance of the log-income. <a href="#fig-kuznets_curve">Figure&nbsp;<span>4.2</span></a> presents the relationship between log-income and inequality, the fitting line being a second-order polynomial. To perform the regression, <code>log(gnp)</code> and its square can be computed before the estimation or “on the fly” in the formula:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-kuznets_curve" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="coefficients_files/figure-html/fig-kuznets_curve-1.png" class="img-fluid figure-img" style="width:60.0%"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.2: The Kuznets curve</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">kuznets</span> <span class="op">&lt;-</span> <span class="va">kuznets</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>lgnp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">gnp</span><span class="op">)</span>,</span>
<span>         lgnp2 <span class="op">=</span> <span class="va">lgnp</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">varlog</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">gnp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">gnp</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span>, <span class="va">kuznets</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">varlog</span> <span class="op">~</span> <span class="va">lgnp</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">lgnp</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span>, <span class="va">kuznets</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">varlog</span> <span class="op">~</span> <span class="va">lgnp</span> <span class="op">+</span> <span class="va">lgnp2</span>, <span class="va">kuznets</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>or more simply (especially if the order of the polynomial is high), using the <code>poly</code> function, which returns a matrix with a number of columns equal to the order of the polynomial: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lgnp3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span><span class="op">(</span><span class="va">kuznets</span><span class="op">$</span><span class="va">lgnp</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">lgnp3</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           1      2       3
[1,] -0.2200 0.2790 -0.2601
[2,] -0.2193 0.2764 -0.2547
[3,] -0.2040 0.2253 -0.1512</code></pre>
</div>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/crossprod.html">crossprod</a></span><span class="op">(</span><span class="va">lgnp3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           1          2          3
1  1.000e+00 -3.062e-16 -7.980e-17
2 -3.062e-16  1.000e+00 -1.028e-16
3 -7.980e-17 -1.028e-16  1.000e+00</code></pre>
</div>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">lgnp3</span>, <span class="fl">2</span>, <span class="va">mean</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         1          2          3 
 1.007e-17 -3.084e-18  1.382e-19 </code></pre>
</div>
</div>
<p>By default, orthogonal polynomials are computed, i.e., polynomials for which all the inner products of the different terms are 0. Moreover, all the terms have a zero mean and a unit variance. “Raw” polynomials can be computed by setting the <code>raw</code> argument to <code>TRUE</code>. Using raw or orthogonal polynomials gives of course different coefficients, but the same fitted values and residuals. The <code>poly</code> function can be used inside a formula, so that the Kuznets model can be estimated using: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">kc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">varlog</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span><span class="op">(</span><span class="va">lgnp</span>, <span class="fl">2</span>, raw <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="va">kuznets</span><span class="op">)</span></span>
<span><span class="va">kc</span> <span class="op">%&gt;%</span> <span class="va">coef</span> <span class="op">%&gt;%</span> <span class="va">unname</span></span>
<span><span class="co">## [1] -1.99919  0.92973 -0.07577</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The results validate the Kuznets hypothesis, i.e., per capital income have first a positive, and then a negative effect on inequality. Denoting <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\beta_2\)</span> the coefficients of log-income and its square, the summit of the curve is given by <span class="math inline">\(\ln \mbox{gnp} = -\beta_1 / (2 \beta_2) = 6.14\)</span>, that corresponds to a per capita GNP equal to 462, which is very close to the median per capita income in the sample.</p>
<p>Using orthogonal polynomials, the covariance matrix of the estimators is now diagonal, but we get the same residuals and the same fitted values as previously:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">kcp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">varlog</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span><span class="op">(</span><span class="va">lgnp</span>, <span class="fl">2</span><span class="op">)</span>, <span class="va">kuznets</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">kc</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">head</span></span>
<span><span class="co">##        1        2        3        4        5        6 </span></span>
<span><span class="co">## -0.25068 -0.04445 -0.05983 -0.19245 -0.02260 -0.27027</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">kcp</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">head</span></span>
<span><span class="co">##        1        2        3        4        5        6 </span></span>
<span><span class="co">## -0.25068 -0.04445 -0.05983 -0.19245 -0.02260 -0.27027</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/vcov.html">vcov</a></span><span class="op">(</span><span class="va">kcp</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               (Intercept) poly(lgnp, 2)1 poly(lgnp, 2)2
(Intercept)      2.432e-03      3.138e-18      1.742e-33
poly(lgnp, 2)1   3.138e-18      1.459e-01      8.101e-17
poly(lgnp, 2)2   1.742e-33      8.101e-17      1.459e-01</code></pre>
</div>
</div>
</section></section><section id="sec-marginal_effects" class="level2" data-number="4.4"><h2 data-number="4.4" class="anchored" data-anchor-id="sec-marginal_effects">
<span class="header-section-number">4.4</span> Marginal effects</h2>
<p> Until now, we have interpreted the coefficients in a linear model. However, except in the case where the covariate is in level, the coefficients are different from the marginal effects. For example, in a model with:</p>
<ul>
<li>the covariate in log: <span class="math inline">\(y_n = \alpha + \beta \ln x + \epsilon_n\)</span>, the marginal effect is <span class="math inline">\(d y_n / d x_n = \beta / x_n\)</span>,</li>
<li>the covariate introduced as a second degree polynomial: <span class="math inline">\(y_n = \alpha + \beta_1 x + \beta_2 x ^ 2\)</span>, the marginal effect is <span class="math inline">\(d y_n / dx_n = \beta_1 + 2 \beta_2 x\)</span>.</li>
</ul>
<p>Therefore, the marginal effect of <span class="math inline">\(x\)</span> on <span class="math inline">\(y\)</span> depends on the value of <span class="math inline">\(x\)</span> and is therefore different from one observation to another. Moreover, the standard error of the marginal effect will also depend on the value of <span class="math inline">\(x\)</span>. There are several <strong>R</strong> packages which enable the automatic computation of marginal effects. We’ll present in this section the <strong>marginaleffects</strong> package <span class="citation" data-cites="AREL:23">(see <a href="#ref-AREL:23" role="doc-biblioref">Arel-Bundock 2023</a>)</span> which provides a very rich set of analytical and graphical tools to compute and analyze marginal effects.</p>
<section id="computation-of-the-marginal-effects-with-one-covariate" class="level3"><h3 class="anchored" data-anchor-id="computation-of-the-marginal-effects-with-one-covariate">Computation of the marginal effects with one covariate</h3>
<p>Denote <span class="math inline">\(m(\gamma, x_n) = d y / d x (\gamma, x_n)\)</span>. Until now, we have considered models which are linear in the parameters and are therefore of the form:</p>
<p><span class="math display">\[
y_n = \alpha + \sum_{k=1}^K \beta_kf_k(x_n)
\]</span></p>
<p>The marginal effect of a given covariate <span class="math inline">\(l\)</span> is then: <span class="math inline">\(m_l(\beta, x_n) = \sum_k \beta_k \frac{\partial f_k}{\partial x_{nl}}(x_n)\)</span> and the fitted marginal effect is <span class="math inline">\(\sum_k \hat{\beta}_k \frac{\partial f_k}{\partial x_{nl}}(x_n)\)</span>. Its variance is then a function of the matrix of covariance of the coefficients and of the partial derivatives of <span class="math inline">\(f_k\)</span> with respect to <span class="math inline">\(x_{nl}\)</span>. Consider as an example the Kuznets curve: <span class="math inline">\(y_n = \alpha + \beta_1 \ln x_n + \beta_2 \ln^2 x_n\)</span>. The estimated marginal effect of the unique covariate is <span class="math inline">\(\hat{\beta}_1 / x_n + 2\hat{\beta}_2 \ln x_n / x_n\)</span>. It is therefore of the form <span class="math inline">\(a \hat{\beta}_1 + b \hat{\beta}_2\)</span>, for which the variance is: <span class="math inline">\(a^2\sigma_{\hat{\beta}_1}^2 + b^2\sigma_{\hat{\beta}_1}^2 + 2 ab\sigma_{\hat{\beta}_1\hat{\beta}_2}\)</span>. Therefore, for the Kuznets model, the variance of the marginal effect of per capita GNP is:</p>
<p><span class="math display">\[
\left(1 / x_n\right)^2 \sigma_{\beta_1} ^ 2 +  \left(2\ln(x_n)/x_n\right) ^ 2 \sigma_{\beta_2}^2+ 2 \times \left(1 / x_n\right)\left(2\ln(x_n)/x_n\right) \sigma_{\beta_1\beta_2}
\]</span> We first fit the Kuznets curve equation, and note that we use <code>log(gnp)</code> and not <code>lgnp</code> in the formula: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">kc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">varlog</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">gnp</span><span class="op">)</span>, <span class="fl">2</span>, raw <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="va">kuznets</span><span class="op">)</span></span>
<span><span class="va">kc</span> <span class="op">%&gt;%</span> <span class="va">coef</span> <span class="op">%&gt;%</span> <span class="va">unname</span></span>
<span><span class="co">## [1] -1.99919  0.92973 -0.07577</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Applying the preceding formulas, we compute the marginal effect and its standard error for each observation: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mekc</span> <span class="op">&lt;-</span> <span class="va">kuznets</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">transmute</span><span class="op">(</span>me <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">kc</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">/</span> <span class="va">gnp</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">kc</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">gnp</span><span class="op">)</span> <span class="op">/</span> <span class="va">gnp</span>,</span>
<span>            sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="va">gnp</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/vcov.html">vcov</a></span><span class="op">(</span><span class="va">kc</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">+</span> </span>
<span>                        <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">gnp</span><span class="op">)</span> <span class="op">/</span> <span class="va">gnp</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/vcov.html">vcov</a></span><span class="op">(</span><span class="va">kc</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">+</span> </span>
<span>                        <span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="va">gnp</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">gnp</span><span class="op">)</span> <span class="op">/</span> <span class="va">gnp</span><span class="op">)</span> <span class="op">*</span> </span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/stats/vcov.html">vcov</a></span><span class="op">(</span><span class="va">kc</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mekc</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
       me      sd
    &lt;dbl&gt;   &lt;dbl&gt;
1 0.00335 0.00201
2 0.00332 0.00199
3 0.00269 0.00164</code></pre>
</div>
</div>
<p>The <strong>marginaleffects</strong> package provides the <code>slopes</code> function to compute the marginal effects and their standard error for all the observations in the sample. It has a <code>variables</code> argument that is a character vector containing the variables for which the marginal effect has to be computed. It is unnecessary here, as we have only one covariate:<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://marginaleffects.com/">marginaleffects</a></span><span class="op">)</span></span>
<span><span class="va">kc_slps</span> <span class="op">&lt;-</span> <span class="va">kc</span> <span class="op">%&gt;%</span> <span class="va">slopes</span></span>
<span><span class="va">kc_slps</span> <span class="op">%&gt;%</span> <span class="va">as_tibble</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 60 × 14
  rowid term  estimate std.error statistic p.value s.value  conf.low
  &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;
1     1 gnp    0.00335   0.00201      1.67  0.0949    3.40 -0.000582
2     2 gnp    0.00332   0.00199      1.67  0.0951    3.39 -0.000579
3     3 gnp    0.00269   0.00164      1.64  0.100     3.32 -0.000519
4     4 gnp    0.00258   0.00158      1.64  0.102     3.30 -0.000509
5     5 gnp    0.00218   0.00135      1.61  0.107     3.23 -0.000468
# ℹ 55 more rows
# ℹ 6 more variables: conf.high &lt;dbl&gt;, predicted_lo &lt;dbl&gt;,
#   predicted_hi &lt;dbl&gt;, predicted &lt;dbl&gt;, varlog &lt;dbl&gt;, gnp &lt;dbl&gt;</code></pre>
</div>
</div>
<p>We can check that we get “almost” the same results as previously. The tiny difference is due to the fact that we used analytical derivatives, as <code>slopes</code> use numerical derivatives. We have seen previously that the same regression could have been performed by computing before the estimation the log of the per capita GNP: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">kc2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">varlog</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span><span class="op">(</span><span class="va">lgnp</span>, <span class="fl">2</span>, raw <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="va">kuznets</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>although the coefficients are the same as previously, using <code>slopes</code> with this model returns completely different results: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">kc2</span> <span class="op">%&gt;%</span> <span class="va">slopes</span> <span class="op">%&gt;%</span> <span class="va">as_tibble</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 60 × 14
  rowid term  estimate std.error statistic p.value s.value conf.low
  &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
1     1 lgnp     0.267     0.160      1.67  0.0950    3.40  -0.0463
2     2 lgnp     0.266     0.159      1.67  0.0952    3.39  -0.0464
3     3 lgnp     0.246     0.150      1.64  0.100     3.32  -0.0474
4     4 lgnp     0.242     0.148      1.64  0.101     3.30  -0.0475
5     5 lgnp     0.226     0.140      1.61  0.107     3.23  -0.0486
# ℹ 55 more rows
# ℹ 6 more variables: conf.high &lt;dbl&gt;, predicted_lo &lt;dbl&gt;,
#   predicted_hi &lt;dbl&gt;, predicted &lt;dbl&gt;, varlog &lt;dbl&gt;, lgnp &lt;dbl&gt;</code></pre>
</div>
</div>
<p>The covariate is now <code>lgnp</code> and the marginal effect is no longer the effect of an increase of $1 of per capita on inequality, but the effect of a doubling of income.</p>
<p>The computation of the individual marginal effects results in a very large output, that is as such difficult to interpret. It is therefore customary to provide a unique value that summarizes the marginal effect of the covariate on the response for the whole sample. The preferred statistic is the <strong>average marginal effects</strong> (<strong>AME</strong>). It is simply the arithmetic mean of the individual effects. It can be obtained either using the <code>avg_slopes</code> function or applying the <code>summary</code> method to the object returned by <code>slope</code>: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">z</span> <span class="op">&lt;-</span> <span class="va">kc</span> <span class="op">%&gt;%</span> <span class="va">slopes</span> <span class="op">%&gt;%</span> <span class="va">summary</span></span>
<span><span class="va">kc</span> <span class="op">%&gt;%</span> <span class="va">avg_slopes</span> <span class="op">%&gt;%</span> <span class="va">as_tibble</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 12
  term  contrast    estimate std.error statistic p.value s.value
  &lt;chr&gt; &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1 gnp   mean(dY/dX) 0.000409  0.000304      1.35   0.178    2.49
# ℹ 5 more variables: conf.low &lt;dbl&gt;, conf.high &lt;dbl&gt;,
#   predicted_lo &lt;dbl&gt;, predicted_hi &lt;dbl&gt;, predicted &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Note that the effect of <code>gnp</code> on inequality is not significant on average. This is hardly surprising as the effect is positive for about half of the sample and negative for the other half. Another popular choice to summarize marginal effects is the <strong>marginal effect at the mean</strong>. It consists of computing the marginal effect for a virtual observation for which all the covariates are set to their average in the sample. We get for our Kuznets curve: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">tibble</span><span class="op">(</span>gnp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">kuznets</span><span class="op">$</span><span class="va">gnp</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">transmute</span><span class="op">(</span>me <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">kc</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">/</span> <span class="va">gnp</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">kc</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">gnp</span><span class="op">)</span> <span class="op">/</span> <span class="va">gnp</span>,</span>
<span>            sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="va">gnp</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/vcov.html">vcov</a></span><span class="op">(</span><span class="va">kc</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">+</span> </span>
<span>                        <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">gnp</span><span class="op">)</span> <span class="op">/</span> <span class="va">gnp</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/vcov.html">vcov</a></span><span class="op">(</span><span class="va">kc</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">+</span> </span>
<span>                        <span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="va">gnp</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">gnp</span><span class="op">)</span> <span class="op">/</span> <span class="va">gnp</span><span class="op">)</span> <span class="op">*</span> </span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/stats/vcov.html">vcov</a></span><span class="op">(</span><span class="va">kc</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span>,</span>
<span>            z <span class="op">=</span> <span class="va">me</span> <span class="op">/</span> <span class="va">sd</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 1 × 3</span></span>
<span><span class="co">##          me        sd     z</span></span>
<span><span class="co">##       &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">## 1 -0.000116 0.0000597 -1.94</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The effect is now negative and almost significant at the 5% level. This can be explained by the fact that the distribution of per capita income is highly asymmetric in our sample, so that the mean of <code>gnp</code> ($971) is much higher than the median ($456). </p>
</section><section id="general-computation-of-marginal-effects" class="level3"><h3 class="anchored" data-anchor-id="general-computation-of-marginal-effects">General computation of marginal effects</h3>
<p>Consider now a model with several covariates, some being numerical, other categorical and with interactions. Using the <code>wine</code> data set, we fit the following model: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">wine</span> <span class="op">&lt;-</span> <span class="va">wine</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>lprodcubm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">prodcubm</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">u</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">price</span><span class="op">)</span> <span class="op">~</span> <span class="va">reg</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">score</span><span class="op">)</span> <span class="op">*</span> <span class="va">lprodcubm</span> <span class="op">+</span> </span>
<span>          <span class="va">reg</span> <span class="op">:</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">score</span><span class="op">)</span> <span class="op">+</span> <span class="va">vyd</span>, <span class="va">wine</span><span class="op">)</span></span>
<span><span class="va">u</span> <span class="op">%&gt;%</span> <span class="va">summary</span> <span class="op">%&gt;%</span> <span class="va">coef</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                         Estimate Std. Error t value  Pr(&gt;|t|)
(Intercept)               3.84186    0.03345 114.869 0.000e+00
regnapavalley             0.69442    0.03290  21.109 1.013e-96
regsonoma                 0.19544    0.03833   5.099 3.476e-07
log(score)                3.13420    0.21026  14.907 1.074e-49
lprodcubm                -0.03561    0.01003  -3.550 3.878e-04
vyd                       0.09840    0.01066   9.232 3.216e-20
log(score):lprodcubm      0.51801    0.06182   8.379 6.068e-17
regnapavalley:log(score)  2.28783    0.21854  10.469 1.649e-25
regsonoma:log(score)      0.45321    0.24372   1.860 6.299e-02</code></pre>
</div>
</div>
<p>The response is in log, so that every marginal effect measures a relative variation of the response. Two numerical variables are introduced in logs, but note that for the production, the log is computed before computing the regression, so that the covariate is <code>lprodcubm</code> and not <code>prodcubm</code>. On the contrary, for the score variable, the log is computed inside the formula. Therefore, while computing marginal effects, one has to keep in mind that what is measured is an increase of 100% of the production and of 1 point of the score. Note the use of the <code>*</code> operator between <code>log(score)</code> and <code>lprodcubm</code> so that the multiplicative effect of these two covariates is added to their separate additive effects. We also use the categorical variable <code>reg</code> (the region with three modalities) and a dummy variable for vineyard indication <code>vyd</code>. Moreover, the term <code>reg:log(score)</code> indicates that the effect of score on price will be different from one region to another. With such a complex linear regression, the coefficients are difficult to interpret and the computation of marginal effects is particularly useful. Using slopes without any further arguments, we get: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">u_slps</span> <span class="op">&lt;-</span> <span class="va">u</span> <span class="op">%&gt;%</span> <span class="va">slopes</span></span>
<span><span class="va">u</span> <span class="op">%&gt;%</span> <span class="va">nobs</span></span>
<span><span class="co">## [1] 9600</span></span>
<span><span class="va">u_slps</span> <span class="op">%&gt;%</span> <span class="va">nrow</span></span>
<span><span class="co">## [1] 48000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The model is fitted on a sample of 9600 observations, but <code>slopes</code> return a data frame of <span class="math inline">\(9600 \times 5 = 48000\)</span> because there is one line for each observation and each covariate. The lines are sorted by covariate first and then by observation, the index of the observation being stored in a column called <code>rowid</code>. To get the marginal effects for the second observation, we can use: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">u_slps</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">rowid</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">as_tibble</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 6
  rowid term      contrast           estimate std.error statistic
  &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;                 &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1     2 lprodcubm dY/dX               -0.0902   0.00423    -21.3 
2     2 reg       napavalley - Other   0.453    0.0131      34.7 
3     2 reg       sonoma - Other       0.148    0.0152       9.69
4     2 score     dY/dX                4.35     0.165       26.3 
5     2 vyd       1 - 0                0.0984   0.0107       9.23</code></pre>
</div>
</div>
<!-- !!! expliquer tidy -->
<p>The term of marginal effects is actually relevant only for numerical variables. The <code>contrast</code> column indicates the kind of effect that is computed. It is <code>dY/dX</code> (a derivative) for the two numerical covariates <code>lprobcubm</code> and <code>score</code>. For factors, the term is a contrast, i.e., the difference between one level (<code>sonoma</code> and <code>napavaley</code> for <code>reg</code>) and the reference level (<code>Other</code>). This is also the case for the dummy variable <code>vid</code>, for which the effect is the difference of prediction for <code>vid</code> equal to 1 and 0.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> The <code>variables</code> argument can be used to compute the marginal effects only for a subset of covariate: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">u</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/marginaleffects/man/slopes.html">slopes</a></span><span class="op">(</span>variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"score"</span>, <span class="st">"reg"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">as_tibble</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">rowid</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As previously, we can compute the average marginal effect using <code>avg_slopes</code>: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">u</span> <span class="op">%&gt;%</span> <span class="va">avg_slopes</span> <span class="op">%&gt;%</span> <span class="va">as_tibble</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 12
  term      contrast  estimate std.error statistic   p.value s.value
  &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
1 lprodcubm mean(dY/…  -0.113    0.00290    -39.1  0           Inf  
2 reg       mean(nap…   0.351    0.0102      34.3  1.02e-257   854. 
3 reg       mean(son…   0.127    0.0103      12.4  3.20e- 35   115. 
4 score     mean(dY/…   6.07     0.110       55.2  0           Inf  
5 vyd       mean(1) …   0.0984   0.0107       9.23 2.65e- 20    65.0
# ℹ 5 more variables: conf.low &lt;dbl&gt;, conf.high &lt;dbl&gt;,
#   predicted_lo &lt;dbl&gt;, predicted_hi &lt;dbl&gt;, predicted &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Moreover, the <strong>AME</strong> can be computed for the different modalities of a factor, using the <code>by</code> argument: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">u</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/marginaleffects/man/slopes.html">avg_slopes</a></span><span class="op">(</span>variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"score"</span>, <span class="st">"lprodcubm"</span><span class="op">)</span>, </span>
<span>                 by <span class="op">=</span> <span class="st">"reg"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">as_tibble</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  term      contrast    reg        estimate std.error statistic
  &lt;chr&gt;     &lt;chr&gt;       &lt;fct&gt;         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 lprodcubm mean(dY/dX) Other        -0.120   0.00292     -41.0
2 lprodcubm mean(dY/dX) napavalley   -0.105   0.00319     -32.8
3 lprodcubm mean(dY/dX) sonoma       -0.112   0.00293     -38.3
4 score     mean(dY/dX) Other         5.25    0.153        34.3
5 score     mean(dY/dX) napavalley    7.70    0.202        38.2
# ℹ 1 more row</code></pre>
</div>
</div>
<p>The marginal effects can also be computed for hypothetical observations, using the <code>newdata</code> argument, which should be a data frame containing one or several hypothetical observations. Such data frames can be easily computed using the <code>datagrid</code> function; it has a <code>model</code> argument and by default returns a one-line data frame containing the mean for the numerical variables and the mode for categorical variables: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/marginaleffects/man/datagrid.html">datagrid</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">u</span><span class="op">)</span></span>
<span><span class="co">##     reg  score lprodcubm vyd rowid</span></span>
<span><span class="co">## 1 Other 0.8614     2.547   0     1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p> and can be used to compute the marginal effects at the mean: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">u</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/marginaleffects/man/slopes.html">slopes</a></span><span class="op">(</span>newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/marginaleffects/man/datagrid.html">datagrid</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">as_tibble</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 6
  rowid term      contrast           estimate std.error statistic
  &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;                 &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1     1 lprodcubm dY/dX               -0.113    0.00291    -38.8 
2     1 reg       napavalley - Other   0.353    0.0102      34.6 
3     1 reg       sonoma - Other       0.128    0.0103      12.4 
4     1 score     dY/dX                5.17     0.151       34.2 
5     1 vyd       1 - 0                0.0984   0.0107       9.23</code></pre>
</div>
</div>
<p><code>datagrid</code> can also include arguments whose names are the names of some covariates and their values are some values of the covariate. If, for example, two values are provided for the first covariate and three values for the second covariates, six observations are generated, obtained by taking all the combinations of the two covariates: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/marginaleffects/man/datagrid.html">datagrid</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">u</span>, score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">50</span>, <span class="fl">100</span><span class="op">)</span>, vyd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    reg lprodcubm score vyd rowid
1 Other     2.547    20   0     1
2 Other     2.547    20   1     2
3 Other     2.547    50   0     3
4 Other     2.547    50   1     4
5 Other     2.547   100   0     5
6 Other     2.547   100   1     6</code></pre>
</div>
</div>
<p>Note that for unspecified covariates the mean / mode are introduced for numerical / categorical variables. We’ve just presented a few features of the <strong>marginaleffects</strong> package. Detailed documentation can be found at <a href="https://marginaleffects.com/">https://marginaleffects.com/</a>. </p>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-AREL:23" class="csl-entry" role="doc-biblioentry">
Arel-Bundock, Vincent. 2023. <em>Marginaleffects: Predictions, Comparisons, Slopes, Marginal Means, and Hypothesis Tests</em>. <a href="https://CRAN.R-project.org/package=marginaleffects">https://CRAN.R-project.org/package=marginaleffects</a>.
</div>
<div id="ref-COST:MITT:MCCL:09" class="csl-entry" role="doc-biblioentry">
Costanigro, Marco, Ron C. Mittelhammer, and Jill J. McCluskey. 2009. <span>“Estimating Class-Specific Parametric Models Under Class Uncertainty: Local Polynomial Regression Clustering in an Hedonic Analysis of Wine Markets.”</span> <em>Journal of Applied Econometrics</em> 24 (7): 1117–35. <a href="https://doi.org/10.1002/jae.1094">https://doi.org/10.1002/jae.1094</a>.
</div>
<div id="ref-KUZN:55" class="csl-entry" role="doc-biblioentry">
Kuznets, Simon. 1955. <span>“Economic Growth and Income Inequality.”</span> <em>The American Economic Review</em> 45 (1): 1–28. <a href="http://www.jstor.org/stable/1811581">http://www.jstor.org/stable/1811581</a>.
</div>
<div id="ref-ROBI:76" class="csl-entry" role="doc-biblioentry">
Robinson, Sherman. 1976. <span>“A Note on the u Hypothesis Relating Income Inequality and Economic Development.”</span> <em>The American Economic Review</em> 66 (3): 437–40. <a href="http://www.jstor.org/stable/1828182">http://www.jstor.org/stable/1828182</a>.
</div>
<div id="ref-ANAN:KANB:93" class="csl-entry" role="doc-biblioentry">
Sudhir, Anand, and S. M. R. Kanbur. 1993. <span>“The Kuznets Process and the Inequality-Development Relationship.”</span> <em>Journal of Development Economics</em> 40: 25–52.
</div>
</div>
</section></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>Note the use of <code>as_tibble</code>: objects returned by <code>slopes</code> are data frames with further attributes and don’t print nicely in a book.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Actually in a linear model, this difference is equal to the derivative, see <a href="#sec-integer_covariate"><span>Section&nbsp;4.1.5</span></a>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../chapters/multiple_regression.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Multiple regression model</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../beyond_OLS.html" class="pagination-link">
        <span class="nav-page-text">Beyond the OLS estimator</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb91" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Interpretation of the Coefficients {#sec-interpretation_chapter}</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: coefficients</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"../_commonR.R"</span>)</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>prtcoef <span class="ot">&lt;-</span> <span class="cf">function</span>(x, id, <span class="at">digits =</span> <span class="dv">3</span>) <span class="fu">unname</span>(<span class="fu">round</span>(<span class="fu">coef</span>(x)[id], digits))</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>In the simplest model, a regression with a real numerical response and a real numerical covariate: $y_n = \alpha + \beta x_n + \epsilon_n$; the interpretation of $\beta$ is simply the constant marginal effect of $x_n$ on $y_n$ or, mathematically, the derivative of $y$ with respect to $x$. However, linear models are much richer than this simple one, as some covariates may be:</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>integer and not real (e.g., the number of children),</span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>dummy variables (e.g., 0 for a male and 1 for a female),</span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>categorical variables (e.g., marital status, with modalities married, single, divorced, widower),</span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>introduced in the regression after a transformation, for example, by taking the logarithm or the square root (this can be also true for the response),</span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>introduced as a polynomial, for example, not only $x$ is introduced, but also its square,</span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>jointly introduced with an interaction, i.e., not only $x_1$ and $x_2$ are introduced, but also their product. </span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a>In all these cases, $\beta$ is no longer the derivative of $y$ with respect to $x$ and special care is required in the interpretation of the estimated coefficients. Throughout this chapter, we'll use the data set of @COST:MITT:MCCL:09\index<span class="co">[</span><span class="ot">author</span><span class="co">]</span>{Costanigro}\index<span class="co">[</span><span class="ot">author</span><span class="co">]</span>{Mittelhammer}\index<span class="co">[</span><span class="ot">author</span><span class="co">]</span>{McCluskey} (called <span class="in">`wine`</span>) who estimate a hedonic price function for wines.</span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a>\idxdata<span class="co">[</span><span class="ot">(</span><span class="co">]</span>{wine}{micsr.data}</span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: wine</span></span>
<span id="cb91-24"><a href="#cb91-24" aria-hidden="true" tabindex="-1"></a>wine <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">3</span>)</span>
<span id="cb91-25"><a href="#cb91-25" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-26"><a href="#cb91-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-27"><a href="#cb91-27" aria-hidden="true" tabindex="-1"></a>The data set contains 9600 wines, for which one observes:</span>
<span id="cb91-28"><a href="#cb91-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-29"><a href="#cb91-29" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`price`</span>: the price in US$ of 2000 per bottle,</span>
<span id="cb91-30"><a href="#cb91-30" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`cases`</span>: the production in number of cases, a case containing 12 bottles of 75 cl,</span>
<span id="cb91-31"><a href="#cb91-31" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`region`</span>: the region where the wine comes from,</span>
<span id="cb91-32"><a href="#cb91-32" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`vineyard`</span>:  equal to <span class="in">`"yes"`</span> if vineyard information is provided and <span class="in">`"no"`</span> otherwise,</span>
<span id="cb91-33"><a href="#cb91-33" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`age`</span>: the age of the wine in years, which is an integer, from 1 to 6,</span>
<span id="cb91-34"><a href="#cb91-34" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`score`</span>: the score given by the Wine Spectator magazine, between 0 and 100.</span>
<span id="cb91-35"><a href="#cb91-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-36"><a href="#cb91-36" aria-hidden="true" tabindex="-1"></a>We divide the score by 100 so that the maximum attainable score is 1:</span>
<span id="cb91-37"><a href="#cb91-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-40"><a href="#cb91-40" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-41"><a href="#cb91-41" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: mutate_score</span></span>
<span id="cb91-42"><a href="#cb91-42" aria-hidden="true" tabindex="-1"></a>wine <span class="ot">&lt;-</span> wine <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">score =</span> score <span class="sc">/</span> <span class="dv">100</span>)</span>
<span id="cb91-43"><a href="#cb91-43" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-44"><a href="#cb91-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-45"><a href="#cb91-45" aria-hidden="true" tabindex="-1"></a>@sec-numerical_covariate deals with numerical covariates and @sec-categorical_covariates with categorical covariates. @sec-several_covariates introduces interactions between several covariates. Finally, @sec-marginal_effects presents useful tools to compute marginal effects.</span>
<span id="cb91-46"><a href="#cb91-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-47"><a href="#cb91-47" aria-hidden="true" tabindex="-1"></a><span class="fu">## Numerical covariate {#sec-numerical_covariate}</span></span>
<span id="cb91-48"><a href="#cb91-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-49"><a href="#cb91-49" aria-hidden="true" tabindex="-1"></a>We first consider the production as the unique covariate. High quality wines are often produced in small areas, with a low yield; we therefore expect a negative relationship between price and production. We consider two measures of production and price:</span>
<span id="cb91-50"><a href="#cb91-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-51"><a href="#cb91-51" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>production is measured in cases ($x$) and in m^3^ ($w$). A case contains 12 bottles of 75 cl, or 9 liters, which is also $9/1000$ m^3^. Therefore, the number of cases must be multiplied by $0.009$ in order to get the production in m^3^ ($w = 0.009x$),</span>
<span id="cb91-52"><a href="#cb91-52" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>price ($y$) is measured in US$ of 2000 per bottle. The price index in the United States was equal to 172 in 2000 and to 258 in 2020. Therefore, to get the price in US$ of 2020 ($q$), we have to multiply the price in US$ of 2000 by $258/172 = 1.5$ ($q = 1.5 y$).</span>
<span id="cb91-53"><a href="#cb91-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-54"><a href="#cb91-54" aria-hidden="true" tabindex="-1"></a>We perform these transformations, and we select only the relevant variables:</span>
<span id="cb91-55"><a href="#cb91-55" aria-hidden="true" tabindex="-1"></a>\idxfun{select}{dplyr}\idxfun{mutate}{dplyr}</span>
<span id="cb91-56"><a href="#cb91-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-57"><a href="#cb91-57" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb91-58"><a href="#cb91-58" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: mutate_select_wine</span></span>
<span id="cb91-59"><a href="#cb91-59" aria-hidden="true" tabindex="-1"></a>wine2 <span class="ot">&lt;-</span> wine <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="at">x =</span> cases, <span class="at">y =</span> price) <span class="sc">%&gt;%</span> </span>
<span id="cb91-60"><a href="#cb91-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">w =</span> x <span class="sc">*</span> <span class="fl">0.009</span>,  <span class="at">q =</span> y <span class="sc">*</span> <span class="fl">1.5</span>)</span>
<span id="cb91-61"><a href="#cb91-61" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-62"><a href="#cb91-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-63"><a href="#cb91-63" aria-hidden="true" tabindex="-1"></a><span class="fu">### Response and covariate in level</span></span>
<span id="cb91-64"><a href="#cb91-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-65"><a href="#cb91-65" aria-hidden="true" tabindex="-1"></a>We start by a set of simple linear regressions of $y$</span>
<span id="cb91-66"><a href="#cb91-66" aria-hidden="true" tabindex="-1"></a>/ $q$ on $x$ / $w$:</span>
<span id="cb91-67"><a href="#cb91-67" aria-hidden="true" tabindex="-1"></a>\idxfun{lm}{stats}\idxfun{coef}{stats}</span>
<span id="cb91-68"><a href="#cb91-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-69"><a href="#cb91-69" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb91-70"><a href="#cb91-70" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: linear_models_production_price</span></span>
<span id="cb91-71"><a href="#cb91-71" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb91-72"><a href="#cb91-72" aria-hidden="true" tabindex="-1"></a>nn_yx <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, wine2)</span>
<span id="cb91-73"><a href="#cb91-73" aria-hidden="true" tabindex="-1"></a>nn_yw <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> w, wine2)</span>
<span id="cb91-74"><a href="#cb91-74" aria-hidden="true" tabindex="-1"></a>nn_qx <span class="ot">&lt;-</span> <span class="fu">lm</span>(q <span class="sc">~</span> x, wine2)</span>
<span id="cb91-75"><a href="#cb91-75" aria-hidden="true" tabindex="-1"></a>nn_qw <span class="ot">&lt;-</span> <span class="fu">lm</span>(q <span class="sc">~</span> w, wine2)</span>
<span id="cb91-76"><a href="#cb91-76" aria-hidden="true" tabindex="-1"></a>nn_yx <span class="sc">%&gt;%</span> coef</span>
<span id="cb91-77"><a href="#cb91-77" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-78"><a href="#cb91-78" aria-hidden="true" tabindex="-1"></a>The initial model, with $y$ and $x$ is: $y_n = \alpha + \beta_x x_n + \epsilon_n$. $y$ being measured in US$ of 2000, so are $\alpha$, $\beta x_n$ and</span>
<span id="cb91-79"><a href="#cb91-79" aria-hidden="true" tabindex="-1"></a>$\epsilon_n$. The intercept indicates the expected value of a bottle of wine when the production is 0, which of course makes no sense. However, we can consider the intercept as the expected value of a bottle for a wine with a very low production. We get here: <span class="in">`r prtcoef(nn_yx, 1, 1)`</span>. $\beta_x x$ is measured in US$ of 2000 and $x$ in cases, $\beta_x$ is measured in US$ of 2000 per case. Therefore, when the production increases by one case, the price of a bottle decreases by  <span class="in">`r prtcoef(nn_yx, 2, 5)`</span> US$ of 2000, i.e., 0.03 cent. The residuals and the fitted values are also measured in US$ of 2000. To see the response, the fitted values and the residuals, we can create a tibble, using the <span class="in">`resid`</span> and the <span class="in">`fitted`</span> functions:</span>
<span id="cb91-80"><a href="#cb91-80" aria-hidden="true" tabindex="-1"></a>\idxfun{tibble}{tibble}\idxfun{resid}{stats}\idxfun{fitted}{stats}</span>
<span id="cb91-81"><a href="#cb91-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-82"><a href="#cb91-82" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb91-83"><a href="#cb91-83" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: response_fitted_residuals</span></span>
<span id="cb91-84"><a href="#cb91-84" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: false</span></span>
<span id="cb91-85"><a href="#cb91-85" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">y =</span> wine2<span class="sc">$</span>y, <span class="at">heps =</span> <span class="fu">resid</span>(nn_yx), <span class="at">hy =</span> <span class="fu">fitted</span>(nn_yx))</span>
<span id="cb91-86"><a href="#cb91-86" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-87"><a href="#cb91-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-88"><a href="#cb91-88" aria-hidden="true" tabindex="-1"></a>or more simply using the <span class="in">`broom::augment`</span> function, which adds to the model frame of a fitted object different columns, including the residuals (<span class="in">`.resid`</span>) and the fitted values (<span class="in">`.fitted`</span>):</span>
<span id="cb91-89"><a href="#cb91-89" aria-hidden="true" tabindex="-1"></a>\idxfun{augment}{broom}</span>
<span id="cb91-90"><a href="#cb91-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-93"><a href="#cb91-93" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-94"><a href="#cb91-94" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb91-95"><a href="#cb91-95" aria-hidden="true" tabindex="-1"></a>nn_yx <span class="sc">%&gt;%</span> augment</span>
<span id="cb91-96"><a href="#cb91-96" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-97"><a href="#cb91-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-98"><a href="#cb91-98" aria-hidden="true" tabindex="-1"></a>For example, for the first wine in the sample, the observed price is $<span class="in">`r round(wine2$y[1], 1)`</span> and is the sum of:</span>
<span id="cb91-99"><a href="#cb91-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-100"><a href="#cb91-100" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>the prediction of the model, i.e., the estimation of the expected value of a bottle for this level of production: <span class="in">`r round(fitted(nn_yx), 1)[1]`</span>,</span>
<span id="cb91-101"><a href="#cb91-101" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>the residual, i.e., the difference between the actual and the predicted price, which is negative for the first bottle ($<span class="in">`r round(resid(nn_yx), 2)[1]`</span>$).</span>
<span id="cb91-102"><a href="#cb91-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-103"><a href="#cb91-103" aria-hidden="true" tabindex="-1"></a>We now measure the price in US$ of 2020. This means that the unit of measurement of the response, as well as that of  $\alpha$, $\beta_x x_n$ and $\epsilon_n$ is changed. More precisely, all these values are multiplied by 1.5. $\beta_x x_n$ is multiplied by 1.5, but as $x_n$ is unchanged, $\beta_x$ is multiplied by 1.5.</span>
<span id="cb91-104"><a href="#cb91-104" aria-hidden="true" tabindex="-1"></a>\idxfun{resid}{stats}\idxfun{coef}{stats}</span>
<span id="cb91-105"><a href="#cb91-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-106"><a href="#cb91-106" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb91-107"><a href="#cb91-107" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb91-108"><a href="#cb91-108" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: change_unit_response</span></span>
<span id="cb91-109"><a href="#cb91-109" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(nn_qx)</span>
<span id="cb91-110"><a href="#cb91-110" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(nn_qx) <span class="sc">/</span> <span class="fu">coef</span>(nn_yx)</span>
<span id="cb91-111"><a href="#cb91-111" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">resid</span>(nn_qx), <span class="dv">2</span>)</span>
<span id="cb91-112"><a href="#cb91-112" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">resid</span>(nn_qx), <span class="dv">2</span>) <span class="sc">/</span> <span class="fu">head</span>(<span class="fu">resid</span>(nn_yx), <span class="dv">2</span>)</span>
<span id="cb91-113"><a href="#cb91-113" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-114"><a href="#cb91-114" aria-hidden="true" tabindex="-1"></a>For example, the price of the first bottle is lower than the estimated expected value for this given level of production by an amount of </span>
<span id="cb91-115"><a href="#cb91-115" aria-hidden="true" tabindex="-1"></a>$<span class="in">`r round(resid(nn_qx)[1], 2)`</span>$ US$ of 2020, which is 1.5 times the residual of the initial regression ($<span class="in">`r round(resid(nn_yx)[1], 2)`</span>$).</span>
<span id="cb91-116"><a href="#cb91-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-117"><a href="#cb91-117" aria-hidden="true" tabindex="-1"></a>Consider now that the production is measured in m^3^ and the price in US$ of 2000. The reference model can in this case be rewritten as:</span>
<span id="cb91-118"><a href="#cb91-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-119"><a href="#cb91-119" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb91-120"><a href="#cb91-120" aria-hidden="true" tabindex="-1"></a>y_n = \alpha + \beta_x (w_n / 0.009) + \epsilon_n = \alpha + (\beta_x / 0.009) w_n + \epsilon_n =</span>
<span id="cb91-121"><a href="#cb91-121" aria-hidden="true" tabindex="-1"></a>\alpha + \beta_w w_n + \epsilon_n</span>
<span id="cb91-122"><a href="#cb91-122" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb91-123"><a href="#cb91-123" aria-hidden="true" tabindex="-1"></a>Compared to the reference model, the three elements of the model are still measured in US$ of 2000, and it is particularly the case for $\beta_w w_n$. As the production is now measured in m^3^, it has been multiplied by 0.009, and therefore, the slope is divided by the same amount. The intercept, the predictions and the residuals still have the same unit of measurement (US$ of 2000) and therefore the same values.</span>
<span id="cb91-124"><a href="#cb91-124" aria-hidden="true" tabindex="-1"></a>\idxfun{lm}{stats}\idxfun{coef}{stats}</span>
<span id="cb91-125"><a href="#cb91-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-126"><a href="#cb91-126" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb91-127"><a href="#cb91-127" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: change_unit_covariate</span></span>
<span id="cb91-128"><a href="#cb91-128" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb91-129"><a href="#cb91-129" aria-hidden="true" tabindex="-1"></a>nn_yw <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> w, wine2)</span>
<span id="cb91-130"><a href="#cb91-130" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(nn_yw)</span>
<span id="cb91-131"><a href="#cb91-131" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(nn_yx) <span class="sc">/</span> <span class="fu">coef</span>(nn_yw)</span>
<span id="cb91-132"><a href="#cb91-132" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-133"><a href="#cb91-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-134"><a href="#cb91-134" aria-hidden="true" tabindex="-1"></a>The price of a bottle of very rare wine is still</span>
<span id="cb91-135"><a href="#cb91-135" aria-hidden="true" tabindex="-1"></a><span class="in">`r prtcoef(nn_yw, 1, 1)`</span> US$ of 2000, and the slope now indicates that when the production increases by 1 m^3^, the price of a bottle decreases by $<span class="in">`r prtcoef(nn_yw, 2, 3)`</span>$, which is approximately  4 cents.</span>
<span id="cb91-136"><a href="#cb91-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-137"><a href="#cb91-137" aria-hidden="true" tabindex="-1"></a><span class="fu">### Covariate in logarithm</span></span>
<span id="cb91-138"><a href="#cb91-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-139"><a href="#cb91-139" aria-hidden="true" tabindex="-1"></a>We now consider that the covariate is the logarithm of the production: $y_n = \alpha + \beta_x \ln x_n + \epsilon_n$. The response is still measured in US$ of 2000, and therefore so are $\alpha$,</span>
<span id="cb91-140"><a href="#cb91-140" aria-hidden="true" tabindex="-1"></a>$\beta_x \ln x_n$, $\epsilon_n$, $\hat{y}_n$ and $\hat{\epsilon}_n$.</span>
<span id="cb91-141"><a href="#cb91-141" aria-hidden="true" tabindex="-1"></a>\idxfun{lm}{stats}\idxfun{coef}{stats}</span>
<span id="cb91-142"><a href="#cb91-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-143"><a href="#cb91-143" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb91-144"><a href="#cb91-144" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: lm_log_covariate</span></span>
<span id="cb91-145"><a href="#cb91-145" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb91-146"><a href="#cb91-146" aria-hidden="true" tabindex="-1"></a>nl_yx <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">log</span>(x), wine2)</span>
<span id="cb91-147"><a href="#cb91-147" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(nl_yx)</span>
<span id="cb91-148"><a href="#cb91-148" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-149"><a href="#cb91-149" aria-hidden="true" tabindex="-1"></a>The intercept is now the expected value of the price of a bottle for $x=1$ (and not 0 as previously) and is therefore not particularly meaningful. $\beta_x$ is now the derivative of $y$ with $\ln x$, which is $\beta_x = \frac{dy}{d\ln x}= \frac{dy}{dx /x}$. Therefore, $\beta_x$ is the ratio of an absolute variation of $y$ and a relative variation of $x$. For $dx/x=1$, which means that the production is multiplied by 2, </span>
<span id="cb91-150"><a href="#cb91-150" aria-hidden="true" tabindex="-1"></a>$dy = <span class="in">`r prtcoef(nl_yx, 2, 2)`</span>$, which means that the price of the bottle decreases by</span>
<span id="cb91-151"><a href="#cb91-151" aria-hidden="true" tabindex="-1"></a><span class="in">`r prtcoef(nl_yx, 2, 2)`</span> US$ of 2000. </span>
<span id="cb91-152"><a href="#cb91-152" aria-hidden="true" tabindex="-1"></a>\idxfun{augment}{broom}</span>
<span id="cb91-153"><a href="#cb91-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-154"><a href="#cb91-154" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb91-155"><a href="#cb91-155" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: price_wine_decomp</span></span>
<span id="cb91-156"><a href="#cb91-156" aria-hidden="true" tabindex="-1"></a>nl_yx <span class="sc">%&gt;%</span> augment</span>
<span id="cb91-157"><a href="#cb91-157" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-158"><a href="#cb91-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-159"><a href="#cb91-159" aria-hidden="true" tabindex="-1"></a>With this new specification, for the first bottle, the price is lower than the expected value of the price by an amount of $<span class="in">`r round(resid(nl_yx)[1], 2)`</span>$. If the production is measured in m^3^, we get, replacing $x_n$</span>
<span id="cb91-160"><a href="#cb91-160" aria-hidden="true" tabindex="-1"></a>by $w_n / 0.009$:</span>
<span id="cb91-161"><a href="#cb91-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-162"><a href="#cb91-162" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb91-163"><a href="#cb91-163" aria-hidden="true" tabindex="-1"></a>y_n = \alpha + \beta_x \ln (w_n / 0.009) + \epsilon_n = </span>
<span id="cb91-164"><a href="#cb91-164" aria-hidden="true" tabindex="-1"></a>y_n = (\alpha - \beta_x \ln 0.009) + \beta_x \ln w_n + \epsilon_n</span>
<span id="cb91-165"><a href="#cb91-165" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb91-166"><a href="#cb91-166" aria-hidden="true" tabindex="-1"></a>\idxfun{lm}{stats}\idxfun{coef}{stats}</span>
<span id="cb91-167"><a href="#cb91-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-168"><a href="#cb91-168" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb91-169"><a href="#cb91-169" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: log_covariate_new_unit</span></span>
<span id="cb91-170"><a href="#cb91-170" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb91-171"><a href="#cb91-171" aria-hidden="true" tabindex="-1"></a>nl_yw <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">log</span>(w), wine2)</span>
<span id="cb91-172"><a href="#cb91-172" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(nl_yw)</span>
<span id="cb91-173"><a href="#cb91-173" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-174"><a href="#cb91-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-175"><a href="#cb91-175" aria-hidden="true" tabindex="-1"></a>Therefore, the slope is unchanged because it measures the effect of doubling the production on the price, which obviously doesn't depend on the unit of measurement of the production. </span>
<span id="cb91-176"><a href="#cb91-176" aria-hidden="true" tabindex="-1"></a>The intercept is modified by an amount equal to $-\beta_x\ln 0.009$:</span>
<span id="cb91-177"><a href="#cb91-177" aria-hidden="true" tabindex="-1"></a>\idxfun{coef}{stats}</span>
<span id="cb91-178"><a href="#cb91-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-179"><a href="#cb91-179" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb91-180"><a href="#cb91-180" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb91-181"><a href="#cb91-181" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: log_covariate_new_unit_intercept</span></span>
<span id="cb91-182"><a href="#cb91-182" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(nl_yw)[<span class="dv">1</span>] <span class="sc">-</span> <span class="fu">coef</span>(nl_yx)[<span class="dv">1</span>]</span>
<span id="cb91-183"><a href="#cb91-183" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span> <span class="fu">coef</span>(nl_yw)[<span class="dv">2</span>] <span class="sc">*</span> <span class="fu">log</span>(<span class="fl">0.009</span>)</span>
<span id="cb91-184"><a href="#cb91-184" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-185"><a href="#cb91-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-186"><a href="#cb91-186" aria-hidden="true" tabindex="-1"></a>Consider now that the price is measured in US$ of 2020:</span>
<span id="cb91-187"><a href="#cb91-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-188"><a href="#cb91-188" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb91-189"><a href="#cb91-189" aria-hidden="true" tabindex="-1"></a>y_n = \frac{q_n}{1.5} = \alpha + \beta_x \ln x_n + \epsilon_n</span>
<span id="cb91-190"><a href="#cb91-190" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb91-191"><a href="#cb91-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-192"><a href="#cb91-192" aria-hidden="true" tabindex="-1"></a>All the elements of the initial model are therefore multiplied by 1.5:</span>
<span id="cb91-193"><a href="#cb91-193" aria-hidden="true" tabindex="-1"></a>\idxfun{lm}{stats}\idxfun{coef}{stats}\idxfun{resid}{stats}</span>
<span id="cb91-194"><a href="#cb91-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-195"><a href="#cb91-195" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb91-196"><a href="#cb91-196" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb91-197"><a href="#cb91-197" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: log_covariate_response_new_unit</span></span>
<span id="cb91-198"><a href="#cb91-198" aria-hidden="true" tabindex="-1"></a>nl_qx <span class="ot">&lt;-</span> <span class="fu">lm</span>(q <span class="sc">~</span> <span class="fu">log</span>(x), wine2)</span>
<span id="cb91-199"><a href="#cb91-199" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(nl_qx)</span>
<span id="cb91-200"><a href="#cb91-200" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(nl_qx) <span class="sc">/</span> <span class="fu">coef</span>(nl_yx)</span>
<span id="cb91-201"><a href="#cb91-201" aria-hidden="true" tabindex="-1"></a><span class="fu">resid</span>(nl_qx)[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span>
<span id="cb91-202"><a href="#cb91-202" aria-hidden="true" tabindex="-1"></a><span class="fu">resid</span>(nl_qx)[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>] <span class="sc">/</span> <span class="fu">resid</span>(nl_yx)[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span>
<span id="cb91-203"><a href="#cb91-203" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-204"><a href="#cb91-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-205"><a href="#cb91-205" aria-hidden="true" tabindex="-1"></a><span class="fu">### Response in logarithm</span></span>
<span id="cb91-206"><a href="#cb91-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-207"><a href="#cb91-207" aria-hidden="true" tabindex="-1"></a>Consider now the case when the response is in logarithm. In terms of the response, we then start from a multiplicative model:</span>
<span id="cb91-208"><a href="#cb91-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-209"><a href="#cb91-209" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb91-210"><a href="#cb91-210" aria-hidden="true" tabindex="-1"></a>y_n = e^{\alpha + \beta_x x} (1 + \eta_n)</span>
<span id="cb91-211"><a href="#cb91-211" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb91-212"><a href="#cb91-212" aria-hidden="true" tabindex="-1"></a>where $\eta_n$ is a multiplicative error. For example, if $\eta_n=-0.2$, it means that for the given wine, the price is 20% lower than the expected value for this level of production.</span>
<span id="cb91-213"><a href="#cb91-213" aria-hidden="true" tabindex="-1"></a>Taking logs, we get:</span>
<span id="cb91-214"><a href="#cb91-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-215"><a href="#cb91-215" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb91-216"><a href="#cb91-216" aria-hidden="true" tabindex="-1"></a>\ln y_n = \alpha + \beta_x x_n + \ln(1 + \eta_n) = \alpha + \beta_x x_n + \epsilon_n</span>
<span id="cb91-217"><a href="#cb91-217" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb91-218"><a href="#cb91-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-219"><a href="#cb91-219" aria-hidden="true" tabindex="-1"></a>The error term is now $\epsilon = \ln(1 + \eta_n)$. But, if $\eta_n$ is "small": $\ln(1+\eta_n) \approx \eta_n$. For example, $\ln(1 + 0.05) = <span class="in">`r round(log(1+0.05), 3)`</span>$ and</span>
<span id="cb91-220"><a href="#cb91-220" aria-hidden="true" tabindex="-1"></a>$\ln(1 - 0.10) = <span class="in">`r round(log(1-0.10), 3)`</span>$. Therefore, $\epsilon$ can be interpreted as a percentage of variation between the actual price and the expected value for the given level of production.</span>
<span id="cb91-221"><a href="#cb91-221" aria-hidden="true" tabindex="-1"></a>\idxfun{lm}{stats}\idxfun{coef}{stats}</span>
<span id="cb91-222"><a href="#cb91-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-223"><a href="#cb91-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-224"><a href="#cb91-224" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb91-225"><a href="#cb91-225" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: response_log</span></span>
<span id="cb91-226"><a href="#cb91-226" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb91-227"><a href="#cb91-227" aria-hidden="true" tabindex="-1"></a>ln_yx <span class="ot">=</span> <span class="fu">lm</span>(<span class="fu">log</span>(y) <span class="sc">~</span> x, wine2)</span>
<span id="cb91-228"><a href="#cb91-228" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(ln_yx)</span>
<span id="cb91-229"><a href="#cb91-229" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-230"><a href="#cb91-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-231"><a href="#cb91-231" aria-hidden="true" tabindex="-1"></a>The intercept is now the expected value of $\ln y$ when $x = 0$. </span>
<span id="cb91-232"><a href="#cb91-232" aria-hidden="true" tabindex="-1"></a>Taking the exponential of the intercept, we get:</span>
<span id="cb91-233"><a href="#cb91-233" aria-hidden="true" tabindex="-1"></a>\idxfun{coef}{stats}</span>
<span id="cb91-234"><a href="#cb91-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-235"><a href="#cb91-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-236"><a href="#cb91-236" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb91-237"><a href="#cb91-237" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: exponential_intercept</span></span>
<span id="cb91-238"><a href="#cb91-238" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb91-239"><a href="#cb91-239" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(ln_yx)[<span class="dv">1</span>])</span>
<span id="cb91-240"><a href="#cb91-240" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-241"><a href="#cb91-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-242"><a href="#cb91-242" aria-hidden="true" tabindex="-1"></a>which is quite close to the value obtained in the reference model </span>
<span id="cb91-243"><a href="#cb91-243" aria-hidden="true" tabindex="-1"></a>(<span class="in">`r prtcoef(nn_yx, 1, 2)`</span>). $\beta_x$ is now the derivative of $\ln y$ with $x$:</span>
<span id="cb91-244"><a href="#cb91-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-245"><a href="#cb91-245" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb91-246"><a href="#cb91-246" aria-hidden="true" tabindex="-1"></a>\frac{d \ln y}{d x} = \frac{dy / y}{d x}</span>
<span id="cb91-247"><a href="#cb91-247" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb91-248"><a href="#cb91-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-249"><a href="#cb91-249" aria-hidden="true" tabindex="-1"></a>It is therefore the ratio of a relative variation of $y$ and an absolute variation of $x$. The results indicate that when the production increases by one case, the relative variation of the price is <span class="in">`r prtcoef(ln_yx, 2, 5)`</span>, i.e., approximately $0.001$%.</span>
<span id="cb91-250"><a href="#cb91-250" aria-hidden="true" tabindex="-1"></a>Consider now the production in m^3^: </span>
<span id="cb91-251"><a href="#cb91-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-252"><a href="#cb91-252" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb91-253"><a href="#cb91-253" aria-hidden="true" tabindex="-1"></a>\ln y_n = \alpha + \beta_x (w_n / 0.009) + \epsilon_n = \alpha +</span>
<span id="cb91-254"><a href="#cb91-254" aria-hidden="true" tabindex="-1"></a>(\beta_x / 0.009) w_n + \epsilon_n</span>
<span id="cb91-255"><a href="#cb91-255" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb91-256"><a href="#cb91-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-257"><a href="#cb91-257" aria-hidden="true" tabindex="-1"></a>The only effect of this change of measurement for the covariate is that, as the covariate is multiplied by $0.009$, $\beta_x$ is divided by the same amount:</span>
<span id="cb91-258"><a href="#cb91-258" aria-hidden="true" tabindex="-1"></a>\idxfun{lm}{stats}\idxfun{coef}{stats}</span>
<span id="cb91-259"><a href="#cb91-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-260"><a href="#cb91-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-261"><a href="#cb91-261" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb91-262"><a href="#cb91-262" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: response_log_change_covariate_unit</span></span>
<span id="cb91-263"><a href="#cb91-263" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb91-264"><a href="#cb91-264" aria-hidden="true" tabindex="-1"></a>ln_yw <span class="ot">=</span> <span class="fu">lm</span>(<span class="fu">log</span>(y) <span class="sc">~</span> w, wine2)</span>
<span id="cb91-265"><a href="#cb91-265" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(ln_yw)</span>
<span id="cb91-266"><a href="#cb91-266" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(ln_yx) <span class="sc">/</span> <span class="fu">coef</span>(ln_yw)</span>
<span id="cb91-267"><a href="#cb91-267" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-268"><a href="#cb91-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-269"><a href="#cb91-269" aria-hidden="true" tabindex="-1"></a>the intercept, the fitted values and the residuals being unchanged.</span>
<span id="cb91-270"><a href="#cb91-270" aria-hidden="true" tabindex="-1"></a>If the response is measured in US$ of 2020, starting from the initial model, we have:</span>
<span id="cb91-271"><a href="#cb91-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-272"><a href="#cb91-272" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb91-273"><a href="#cb91-273" aria-hidden="true" tabindex="-1"></a>\ln y_n = \ln \frac{q_n}{1.5} = \alpha + \beta_x x_n + \epsilon_n</span>
<span id="cb91-274"><a href="#cb91-274" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb91-275"><a href="#cb91-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-276"><a href="#cb91-276" aria-hidden="true" tabindex="-1"></a>which leads to:</span>
<span id="cb91-277"><a href="#cb91-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-278"><a href="#cb91-278" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb91-279"><a href="#cb91-279" aria-hidden="true" tabindex="-1"></a>\ln q_n = (\alpha + \ln 1.5) + \beta_x x_n + \epsilon_n</span>
<span id="cb91-280"><a href="#cb91-280" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb91-281"><a href="#cb91-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-282"><a href="#cb91-282" aria-hidden="true" tabindex="-1"></a>Therefore, the only effect is that the intercept increases by $\ln 1.5$:</span>
<span id="cb91-283"><a href="#cb91-283" aria-hidden="true" tabindex="-1"></a>\idxfun{lm}{stats}\idxfun{coef}{stats}</span>
<span id="cb91-284"><a href="#cb91-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-285"><a href="#cb91-285" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb91-286"><a href="#cb91-286" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb91-287"><a href="#cb91-287" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: response_log_change_unit</span></span>
<span id="cb91-288"><a href="#cb91-288" aria-hidden="true" tabindex="-1"></a>ln_qw <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(q) <span class="sc">~</span> w, wine2)</span>
<span id="cb91-289"><a href="#cb91-289" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(ln_qw)</span>
<span id="cb91-290"><a href="#cb91-290" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(ln_qw) <span class="sc">-</span> <span class="fu">coef</span>(ln_yw)</span>
<span id="cb91-291"><a href="#cb91-291" aria-hidden="true" tabindex="-1"></a><span class="fu">log</span>(<span class="fl">1.5</span>)</span>
<span id="cb91-292"><a href="#cb91-292" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-293"><a href="#cb91-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-294"><a href="#cb91-294" aria-hidden="true" tabindex="-1"></a>the slope, the predictions and the residuals being unchanged.</span>
<span id="cb91-295"><a href="#cb91-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-296"><a href="#cb91-296" aria-hidden="true" tabindex="-1"></a><span class="fu">### Response and covariate in log</span></span>
<span id="cb91-297"><a href="#cb91-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-298"><a href="#cb91-298" aria-hidden="true" tabindex="-1"></a>Consider finally the case where both the response and the covariate are in logs:</span>
<span id="cb91-299"><a href="#cb91-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-300"><a href="#cb91-300" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb91-301"><a href="#cb91-301" aria-hidden="true" tabindex="-1"></a>\ln y_n = \beta_0 +\beta_x \ln x_n + \epsilon_n</span>
<span id="cb91-302"><a href="#cb91-302" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb91-303"><a href="#cb91-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-304"><a href="#cb91-304" aria-hidden="true" tabindex="-1"></a>The slope is the derivative of $\ln y$ with $\ln x$:</span>
<span id="cb91-305"><a href="#cb91-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-306"><a href="#cb91-306" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb91-307"><a href="#cb91-307" aria-hidden="true" tabindex="-1"></a>\beta_x = \frac{d\ln y}{d\ln x}=\frac{dy / y}{dx / x}</span>
<span id="cb91-308"><a href="#cb91-308" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb91-309"><a href="#cb91-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-310"><a href="#cb91-310" aria-hidden="true" tabindex="-1"></a>and is therefore a ratio of two relative variations.</span>
<span id="cb91-311"><a href="#cb91-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-312"><a href="#cb91-312" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb91-313"><a href="#cb91-313" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: elasticity</span></span>
<span id="cb91-314"><a href="#cb91-314" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb91-315"><a href="#cb91-315" aria-hidden="true" tabindex="-1"></a>ll_yx <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(y) <span class="sc">~</span> <span class="fu">log</span>(x), wine2)</span>
<span id="cb91-316"><a href="#cb91-316" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(ll_yx)</span>
<span id="cb91-317"><a href="#cb91-317" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-318"><a href="#cb91-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-319"><a href="#cb91-319" aria-hidden="true" tabindex="-1"></a>When $dx / x = 1$, which means that the production is doubling, the relative variation of the price is $<span class="in">`r prtcoef(ll_yx, 2, 3)`</span>$ or $<span class="in">`r 100 * prtcoef(ll_yx, 2, 3)`</span>$%. Equivalently, when the production increases by 1%, the price decreases by  $<span class="in">`r prtcoef(ll_yx, 2, 3)`</span>$%; $\beta_x$ is an elasticity and is a number without unit. Therefore, it is invariant to any linear transformation of the covariate or of the response.</span>
<span id="cb91-320"><a href="#cb91-320" aria-hidden="true" tabindex="-1"></a>\idxfun{lm}{stats}\idxfun{coef}{stats}\idxfun{rbind}{base}</span>
<span id="cb91-321"><a href="#cb91-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-322"><a href="#cb91-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-323"><a href="#cb91-323" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb91-324"><a href="#cb91-324" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: elasticity_invariant_units</span></span>
<span id="cb91-325"><a href="#cb91-325" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb91-326"><a href="#cb91-326" aria-hidden="true" tabindex="-1"></a>ll_yw <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(y) <span class="sc">~</span> <span class="fu">log</span>(w), wine2)</span>
<span id="cb91-327"><a href="#cb91-327" aria-hidden="true" tabindex="-1"></a>ll_qx <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(q) <span class="sc">~</span> <span class="fu">log</span>(x), wine2)</span>
<span id="cb91-328"><a href="#cb91-328" aria-hidden="true" tabindex="-1"></a>ll_qw <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(q) <span class="sc">~</span> <span class="fu">log</span>(w), wine2)</span>
<span id="cb91-329"><a href="#cb91-329" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(<span class="at">ll_yx =</span> <span class="fu">coef</span>(ll_yx), <span class="at">ll_yw =</span> <span class="fu">coef</span>(ll_yw),</span>
<span id="cb91-330"><a href="#cb91-330" aria-hidden="true" tabindex="-1"></a>      <span class="at">ll_qx =</span> <span class="fu">coef</span>(ll_qx), <span class="at">ll_qw =</span> <span class="fu">coef</span>(ll_qw))</span>
<span id="cb91-331"><a href="#cb91-331" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-332"><a href="#cb91-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-333"><a href="#cb91-333" aria-hidden="true" tabindex="-1"></a><span class="fu">### Integer covariate {#sec-integer_covariate}</span></span>
<span id="cb91-334"><a href="#cb91-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-335"><a href="#cb91-335" aria-hidden="true" tabindex="-1"></a>Consider the same model: $y_n = \alpha + \beta_x x_n + \epsilon_n$, but $x_n$ is now an integer. In the <span class="in">`wine`</span> data set, <span class="in">`age`</span> is the age of the wine in years, from 1 to 6. </span>
<span id="cb91-336"><a href="#cb91-336" aria-hidden="true" tabindex="-1"></a>\idxfun{lm}{stats}\idxfun{coef}{stats}</span>
<span id="cb91-337"><a href="#cb91-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-340"><a href="#cb91-340" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-341"><a href="#cb91-341" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb91-342"><a href="#cb91-342" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: integer_covariate_hide</span></span>
<span id="cb91-343"><a href="#cb91-343" aria-hidden="true" tabindex="-1"></a>cov_count <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> age, wine)</span>
<span id="cb91-344"><a href="#cb91-344" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-345"><a href="#cb91-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-348"><a href="#cb91-348" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-349"><a href="#cb91-349" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: integer_covariate</span></span>
<span id="cb91-350"><a href="#cb91-350" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb91-351"><a href="#cb91-351" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(price <span class="sc">~</span> age, wine) <span class="sc">%&gt;%</span> coef</span>
<span id="cb91-352"><a href="#cb91-352" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-353"><a href="#cb91-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-354"><a href="#cb91-354" aria-hidden="true" tabindex="-1"></a>$\beta$ is still the derivative of $y$ with $x$, but the computation of the derivative makes little sense when $x$ is an integer, as infinitesimal variations are not relevant in this case. Therefore, instead of a marginal effect, one is interested in a discrete variation of $x_n$ (for example from 3 to 4). If we compute the variation of $\mbox{E}(y \mid x = x_n)$ when $x$ increases from $x_n$ to $x_n + 1$, we get:</span>
<span id="cb91-355"><a href="#cb91-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-356"><a href="#cb91-356" aria-hidden="true" tabindex="-1"></a>$$\left(\alpha + \beta_x (x_n + 1)\right) - \left(\alpha + \beta_x x_n\right) = \beta_x$$</span>
<span id="cb91-357"><a href="#cb91-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-358"><a href="#cb91-358" aria-hidden="true" tabindex="-1"></a>Therefore, $\beta_x$ is not only the derivative, but it is also the variation of $y$ caused by an increase of one unit of $x$. In our example, when the age of the wine increases by one year, its expected price increases by $<span class="in">`r prtcoef(cov_count, 2, 1)`</span>.</span>
<span id="cb91-359"><a href="#cb91-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-360"><a href="#cb91-360" aria-hidden="true" tabindex="-1"></a><span class="fu">## Categorical covariate {#sec-categorical_covariates}</span></span>
<span id="cb91-361"><a href="#cb91-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-362"><a href="#cb91-362" aria-hidden="true" tabindex="-1"></a>A categorical variable is a variable that defines a set of modalities, each observations belonging to one modality and only one. The preferred way to deal with categorical variables with **R** is to use a variable type that is called **factor**, the modalities being called **levels**. Factors have at least two levels. A categorical variable with two levels is a **dichotomic** variable, and the factor can be replaced by a dummy variable (a numerical variable for which the only two values are 0 and 1). For example, sex can be stored as a factor with levels male and female, or as a dummy variable with for example 1 for females and 0 for males. When the number of levels is greater than 2, the variable is **polytomic**, and it is advisable to store the variable as a factor. Base **R** proposed several functions to deal with factors, but we'll use the **forcats** packages which is part of the **tidyverse**.</span>
<span id="cb91-363"><a href="#cb91-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-364"><a href="#cb91-364" aria-hidden="true" tabindex="-1"></a><span class="fu">### Dichotomic variable</span></span>
<span id="cb91-365"><a href="#cb91-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-366"><a href="#cb91-366" aria-hidden="true" tabindex="-1"></a>We consider here the <span class="in">`"vineyard"`</span> variable which has two modalities (<span class="in">`"yes"`</span> and</span>
<span id="cb91-367"><a href="#cb91-367" aria-hidden="true" tabindex="-1"></a><span class="in">`"no"`</span>), and we create a variant of this variable by creating a dummy variable equal to $1$ if <span class="in">`vineyard`</span> is equal to <span class="in">`"yes"`</span> and 0 otherwise:</span>
<span id="cb91-368"><a href="#cb91-368" aria-hidden="true" tabindex="-1"></a>\idxfun{mutate}{dplyr}</span>
<span id="cb91-369"><a href="#cb91-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-370"><a href="#cb91-370" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb91-371"><a href="#cb91-371" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: create_dummy</span></span>
<span id="cb91-372"><a href="#cb91-372" aria-hidden="true" tabindex="-1"></a>wine <span class="ot">&lt;-</span> wine <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">vyd =</span> <span class="fu">ifelse</span>(vineyard <span class="sc">==</span> <span class="st">"yes"</span>, 1L, 0L))</span>
<span id="cb91-373"><a href="#cb91-373" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-374"><a href="#cb91-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-375"><a href="#cb91-375" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Response in level</span></span>
<span id="cb91-376"><a href="#cb91-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-377"><a href="#cb91-377" aria-hidden="true" tabindex="-1"></a>We first compute the average price for the two categories:</span>
<span id="cb91-378"><a href="#cb91-378" aria-hidden="true" tabindex="-1"></a>\idxfun{group<span class="sc">\_</span>by}{dplyr}\idxfun{summarise}{dplyr}</span>
<span id="cb91-379"><a href="#cb91-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-380"><a href="#cb91-380" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb91-381"><a href="#cb91-381" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: average_price_modalities</span></span>
<span id="cb91-382"><a href="#cb91-382" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb91-383"><a href="#cb91-383" aria-hidden="true" tabindex="-1"></a>Mwine <span class="ot">&lt;-</span> wine <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(vineyard) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">price =</span> <span class="fu">mean</span>(price))</span>
<span id="cb91-384"><a href="#cb91-384" aria-hidden="true" tabindex="-1"></a>Mwine</span>
<span id="cb91-385"><a href="#cb91-385" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-386"><a href="#cb91-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-387"><a href="#cb91-387" aria-hidden="true" tabindex="-1"></a>The average price difference between the two categories is substantial  ($<span class="in">`r round(Mwine$price[2] - Mwine$price[1], 2)`</span>).</span>
<span id="cb91-388"><a href="#cb91-388" aria-hidden="true" tabindex="-1"></a>We now consider the estimation of the linear model, with $x_n$ a dummy variable equal to 1 if the wine has vineyard indications. The effect of $x_n$ varying from 0 to 1 on the conditional expectation of the price is:</span>
<span id="cb91-389"><a href="#cb91-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-390"><a href="#cb91-390" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb91-391"><a href="#cb91-391" aria-hidden="true" tabindex="-1"></a>(\alpha + \beta_x \times 1) - (\alpha + \beta_x \times 0) = \beta_x</span>
<span id="cb91-392"><a href="#cb91-392" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb91-393"><a href="#cb91-393" aria-hidden="true" tabindex="-1"></a>We then estimate the linear model, using <span class="in">`vineyard`</span> and <span class="in">`vyd`</span>:</span>
<span id="cb91-394"><a href="#cb91-394" aria-hidden="true" tabindex="-1"></a>\idxfun{lm}{stats}\idxfun{coef}{stats}</span>
<span id="cb91-395"><a href="#cb91-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-396"><a href="#cb91-396" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb91-397"><a href="#cb91-397" aria-hidden="true" tabindex="-1"></a><span class="co">#| level: ols_dichotomic</span></span>
<span id="cb91-398"><a href="#cb91-398" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb91-399"><a href="#cb91-399" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(price <span class="sc">~</span> vyd, wine) <span class="sc">%&gt;%</span> coef</span>
<span id="cb91-400"><a href="#cb91-400" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(price <span class="sc">~</span> vineyard, wine) <span class="sc">%&gt;%</span> coef</span>
<span id="cb91-401"><a href="#cb91-401" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-402"><a href="#cb91-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-403"><a href="#cb91-403" aria-hidden="true" tabindex="-1"></a>The intercept is the average price for wines with no vineyard indication, and $\beta_x$ is the price increase caused by vineyard indication. Note also that $\alpha + \beta_x$ is the average price for wines with a vineyard indication. Identical results are obtained using either <span class="in">`vyd`</span> and <span class="in">`vineyard`</span>. The difference is that in the first case, <span class="in">`vyd`</span> is directly used in the regression. In the second case, the factor <span class="in">`vineyard`</span> is replaced in the regression by a dummy variable called <span class="in">`vineyardyes`</span> equal to 1 when <span class="in">`vineyard`</span> equals <span class="in">`"yes"`</span>. </span>
<span id="cb91-404"><a href="#cb91-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-405"><a href="#cb91-405" aria-hidden="true" tabindex="-1"></a>Removing the intercept, we get:</span>
<span id="cb91-406"><a href="#cb91-406" aria-hidden="true" tabindex="-1"></a>\idxfun{lm}{stats}\idxfun{coef}{stats}</span>
<span id="cb91-407"><a href="#cb91-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-408"><a href="#cb91-408" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb91-409"><a href="#cb91-409" aria-hidden="true" tabindex="-1"></a><span class="co">#| level: ols_dichotomic</span></span>
<span id="cb91-410"><a href="#cb91-410" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb91-411"><a href="#cb91-411" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(price <span class="sc">~</span> vineyard <span class="sc">-</span> <span class="dv">1</span>, wine) <span class="sc">%&gt;%</span> coef</span>
<span id="cb91-412"><a href="#cb91-412" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-413"><a href="#cb91-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-414"><a href="#cb91-414" aria-hidden="true" tabindex="-1"></a>Two dummies are created, one for <span class="in">`vineyard = "yes"`</span> as previously done, but also one for <span class="in">`vineyard = "no"`</span>. The two coefficients are now average prices for the two categories. </span>
<span id="cb91-415"><a href="#cb91-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-416"><a href="#cb91-416" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Response in log</span></span>
<span id="cb91-417"><a href="#cb91-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-418"><a href="#cb91-418" aria-hidden="true" tabindex="-1"></a>Consider now a regression with the response in log and a dummy covariate: $\ln y_n = \alpha + \beta_x  x_n + \epsilon_n$.  Consider two wines with the same value of $\epsilon$, but one with $x = 1$ and the other with $x = 0$, and call $y^1$ and $y^0$ the respective prices. The difference in log price is:</span>
<span id="cb91-419"><a href="#cb91-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-420"><a href="#cb91-420" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb91-421"><a href="#cb91-421" aria-hidden="true" tabindex="-1"></a>\ln y^1 - \ln y^0 = \beta_x</span>
<span id="cb91-422"><a href="#cb91-422" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb91-423"><a href="#cb91-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-424"><a href="#cb91-424" aria-hidden="true" tabindex="-1"></a>Denoting $\tau_x = \frac{y^1 - y^0}{y^0}$ the variation rate of the price for a wine with vineyard indication compared to a wine without vineyard indication, we get:</span>
<span id="cb91-425"><a href="#cb91-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-426"><a href="#cb91-426" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb91-427"><a href="#cb91-427" aria-hidden="true" tabindex="-1"></a>\ln y^1 - \ln y^0 = \ln (1 + \tau_x) = \beta_x</span>
<span id="cb91-428"><a href="#cb91-428" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb91-429"><a href="#cb91-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-430"><a href="#cb91-430" aria-hidden="true" tabindex="-1"></a>$\beta_x$ is therefore equal to $\ln (1 + \tau)$ and, as seen previously, for a "small" value of </span>
<span id="cb91-431"><a href="#cb91-431" aria-hidden="true" tabindex="-1"></a>$\tau_x$,  $\ln (1 + \tau_x) \approx \tau_x$. Therefore, $\beta_x$ is approximately the relative price difference for a wine with and without vineyard indications.</span>
<span id="cb91-432"><a href="#cb91-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-433"><a href="#cb91-433" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb91-434"><a href="#cb91-434" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: log_covariate_dichotomic</span></span>
<span id="cb91-435"><a href="#cb91-435" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb91-436"><a href="#cb91-436" aria-hidden="true" tabindex="-1"></a>log_bin <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(price) <span class="sc">~</span> vineyard, wine)</span>
<span id="cb91-437"><a href="#cb91-437" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(log_bin)</span>
<span id="cb91-438"><a href="#cb91-438" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-439"><a href="#cb91-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-440"><a href="#cb91-440" aria-hidden="true" tabindex="-1"></a>$\hat{\beta}_x=<span class="in">`r prtcoef(log_bin, 2, 2)`</span>$ is the approximation of the relative difference (25%), as the true relative difference is given by the formula: $\tau = e^{\beta_x}-1$, which is </span>
<span id="cb91-441"><a href="#cb91-441" aria-hidden="true" tabindex="-1"></a><span class="in">`r round(exp(coef(log_bin)[2]) - 1, 2)`</span>. Therefore, $\hat{\beta}_x$ gives quite a good approximation of the relative difference.</span>
<span id="cb91-442"><a href="#cb91-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-443"><a href="#cb91-443" aria-hidden="true" tabindex="-1"></a><span class="fu">### Polytomic covariate</span></span>
<span id="cb91-444"><a href="#cb91-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-445"><a href="#cb91-445" aria-hidden="true" tabindex="-1"></a>Consider now the case of a polytomic covariate. </span>
<span id="cb91-446"><a href="#cb91-446" aria-hidden="true" tabindex="-1"></a><span class="in">`region`</span> is a factor with numerous modalities:</span>
<span id="cb91-447"><a href="#cb91-447" aria-hidden="true" tabindex="-1"></a>\idxfun{pull}{dplyr}\idxfun{levels}{base}</span>
<span id="cb91-448"><a href="#cb91-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-451"><a href="#cb91-451" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-452"><a href="#cb91-452" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: regions_levels</span></span>
<span id="cb91-453"><a href="#cb91-453" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb91-454"><a href="#cb91-454" aria-hidden="true" tabindex="-1"></a>wine <span class="sc">%&gt;%</span> <span class="fu">pull</span>(region) <span class="sc">%&gt;%</span> levels</span>
<span id="cb91-455"><a href="#cb91-455" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-456"><a href="#cb91-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-457"><a href="#cb91-457" aria-hidden="true" tabindex="-1"></a>To simplify, we keep only the two most important regions (Napa Valley and Sonoma) and merge all the other regions in a <span class="in">`other`</span> category. This operation is easily performed using the <span class="in">`forcats::fct_lump`</span> function:</span>
<span id="cb91-458"><a href="#cb91-458" aria-hidden="true" tabindex="-1"></a>\idxfun{mutate}{dplyr}\idxfun{fct<span class="sc">\_</span>lump}{forcats}\idxfun{count}{dplyr}</span>
<span id="cb91-459"><a href="#cb91-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-462"><a href="#cb91-462" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-463"><a href="#cb91-463" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: region_freq</span></span>
<span id="cb91-464"><a href="#cb91-464" aria-hidden="true" tabindex="-1"></a>wine <span class="ot">&lt;-</span> wine <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">reg =</span> <span class="fu">fct_lump</span>(region, <span class="dv">2</span>))</span>
<span id="cb91-465"><a href="#cb91-465" aria-hidden="true" tabindex="-1"></a>wine <span class="sc">%&gt;%</span> <span class="fu">count</span>(reg)</span>
<span id="cb91-466"><a href="#cb91-466" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-467"><a href="#cb91-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-468"><a href="#cb91-468" aria-hidden="true" tabindex="-1"></a>The <span class="in">`reg`</span> variable has then three modalities:</span>
<span id="cb91-469"><a href="#cb91-469" aria-hidden="true" tabindex="-1"></a>\idxfun{pull}{dplyr}\idxfun{levels}{base}</span>
<span id="cb91-470"><a href="#cb91-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-473"><a href="#cb91-473" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-474"><a href="#cb91-474" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: polytomic_levels</span></span>
<span id="cb91-475"><a href="#cb91-475" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb91-476"><a href="#cb91-476" aria-hidden="true" tabindex="-1"></a>wine <span class="sc">%&gt;%</span> <span class="fu">pull</span>(reg) <span class="sc">%&gt;%</span> levels</span>
<span id="cb91-477"><a href="#cb91-477" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-478"><a href="#cb91-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-479"><a href="#cb91-479" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Response in level</span></span>
<span id="cb91-480"><a href="#cb91-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-481"><a href="#cb91-481" aria-hidden="true" tabindex="-1"></a>We first compute the average price for these three modalities:</span>
<span id="cb91-482"><a href="#cb91-482" aria-hidden="true" tabindex="-1"></a>\idxfun{group<span class="sc">\_</span>by}{dplyr}\idxfun{summarise}{dplyr}</span>
<span id="cb91-483"><a href="#cb91-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-486"><a href="#cb91-486" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-487"><a href="#cb91-487" aria-hidden="true" tabindex="-1"></a><span class="co">#| level: count_modalities_polytomic</span></span>
<span id="cb91-488"><a href="#cb91-488" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: false</span></span>
<span id="cb91-489"><a href="#cb91-489" aria-hidden="true" tabindex="-1"></a>Mwine <span class="ot">&lt;-</span> wine <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(reg) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">price =</span> <span class="fu">mean</span>(price))</span>
<span id="cb91-490"><a href="#cb91-490" aria-hidden="true" tabindex="-1"></a>Mwine</span>
<span id="cb91-491"><a href="#cb91-491" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-492"><a href="#cb91-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-493"><a href="#cb91-493" aria-hidden="true" tabindex="-1"></a>Consider a linear model, without and with an intercept:</span>
<span id="cb91-494"><a href="#cb91-494" aria-hidden="true" tabindex="-1"></a>\idxfun{lm}{stats}\idxfun{coef}{stats}</span>
<span id="cb91-495"><a href="#cb91-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-496"><a href="#cb91-496" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb91-497"><a href="#cb91-497" aria-hidden="true" tabindex="-1"></a><span class="co">#| level: polytomic_with_without_intercept</span></span>
<span id="cb91-498"><a href="#cb91-498" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb91-499"><a href="#cb91-499" aria-hidden="true" tabindex="-1"></a>lin_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> reg <span class="sc">-</span> <span class="dv">1</span>, wine)</span>
<span id="cb91-500"><a href="#cb91-500" aria-hidden="true" tabindex="-1"></a>lin_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> reg, wine)</span>
<span id="cb91-501"><a href="#cb91-501" aria-hidden="true" tabindex="-1"></a>lin_1 <span class="sc">%&gt;%</span> coef</span>
<span id="cb91-502"><a href="#cb91-502" aria-hidden="true" tabindex="-1"></a>lin_2 <span class="sc">%&gt;%</span> coef</span>
<span id="cb91-503"><a href="#cb91-503" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-504"><a href="#cb91-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-505"><a href="#cb91-505" aria-hidden="true" tabindex="-1"></a>Without an intercept, three dummy variables are created and introduced in the regression. With an intercept, only two dummy variables are introduced. We have noted previously that the three levels are <span class="in">`napavalley`</span>, <span class="in">`sonoma`</span> and <span class="in">`Other`</span>. The name of the dummy variables are obtained by merging the name of the variable <span class="in">`reg`</span> and the name of the level. Note that when an intercept is introduced, the dummy variable corresponding to the first level (here <span class="in">`napavalley`</span>) is omitted. </span>
<span id="cb91-506"><a href="#cb91-506" aria-hidden="true" tabindex="-1"></a>Without an intercept, the three estimated coefficients are simply the average prices for the three regions. With an intercept, the intercept is the average price for the first level of the variable (the Napa Valley region) and the two other coefficients are the differences between the average price for the two regions and the average price for the reference region (Napa Valley). For example, using the second regression (<span class="in">`lin_2`</span>), the average price for the Sonoma region can be computed as the sum of the first two coefficients:</span>
<span id="cb91-507"><a href="#cb91-507" aria-hidden="true" tabindex="-1"></a>\idxfun{coef}{stats}\idxfun{unname}{base}</span>
<span id="cb91-508"><a href="#cb91-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-509"><a href="#cb91-509" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb91-510"><a href="#cb91-510" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb91-511"><a href="#cb91-511" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: sonoma_price</span></span>
<span id="cb91-512"><a href="#cb91-512" aria-hidden="true" tabindex="-1"></a><span class="fu">unname</span>(<span class="fu">coef</span>(lin_2)[<span class="dv">1</span>] <span class="sc">+</span> <span class="fu">coef</span>(lin_2)[<span class="dv">2</span>])</span>
<span id="cb91-513"><a href="#cb91-513" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-514"><a href="#cb91-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-515"><a href="#cb91-515" aria-hidden="true" tabindex="-1"></a>The reference level can be changed by modifying the order of the levels of the factor. This task can easily be performed using the <span class="in">`forcats::fct_relevel`</span> function and indicating, for example, that <span class="in">`"Other"`</span> should be the first level:</span>
<span id="cb91-516"><a href="#cb91-516" aria-hidden="true" tabindex="-1"></a>\idxfun{coef}{stats}\idxfun{lm}{stats}\idxfun{fct<span class="sc">\_</span>relevel}{forcats}</span>
<span id="cb91-517"><a href="#cb91-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-518"><a href="#cb91-518" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb91-519"><a href="#cb91-519" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: change_reference_level</span></span>
<span id="cb91-520"><a href="#cb91-520" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb91-521"><a href="#cb91-521" aria-hidden="true" tabindex="-1"></a>wine <span class="ot">&lt;-</span> <span class="fu">mutate</span>(wine, <span class="at">reg =</span> <span class="fu">fct_relevel</span>(reg, <span class="st">"Other"</span>))</span>
<span id="cb91-522"><a href="#cb91-522" aria-hidden="true" tabindex="-1"></a>lin_2b <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> reg, wine)</span>
<span id="cb91-523"><a href="#cb91-523" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(lin_2b)</span>
<span id="cb91-524"><a href="#cb91-524" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-525"><a href="#cb91-525" aria-hidden="true" tabindex="-1"></a>The average price for Sonoma is now equal to the sum of the first coefficient (the intercept which is the average price for "other regions") and the third coefficient (the difference between the average price in Sonoma and "other regions"):</span>
<span id="cb91-526"><a href="#cb91-526" aria-hidden="true" tabindex="-1"></a>\idxfun{coef}{stats}\idxfun{unname}{base}</span>
<span id="cb91-527"><a href="#cb91-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-528"><a href="#cb91-528" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb91-529"><a href="#cb91-529" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: sonoma_price_2</span></span>
<span id="cb91-530"><a href="#cb91-530" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb91-531"><a href="#cb91-531" aria-hidden="true" tabindex="-1"></a><span class="fu">unname</span>(<span class="fu">coef</span>(lin_2b)[<span class="dv">1</span>] <span class="sc">+</span> <span class="fu">coef</span>(lin_2b)[<span class="dv">3</span>])</span>
<span id="cb91-532"><a href="#cb91-532" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-533"><a href="#cb91-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-534"><a href="#cb91-534" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Response in log</span></span>
<span id="cb91-535"><a href="#cb91-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-536"><a href="#cb91-536" aria-hidden="true" tabindex="-1"></a>We first compute the average of the *log* prices for the three regions:</span>
<span id="cb91-537"><a href="#cb91-537" aria-hidden="true" tabindex="-1"></a>\idxfun{group<span class="sc">\_</span>by}{dplyr}\idxfun{summarise}{dplyr}</span>
<span id="cb91-538"><a href="#cb91-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-539"><a href="#cb91-539" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb91-540"><a href="#cb91-540" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: average_log_prices</span></span>
<span id="cb91-541"><a href="#cb91-541" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: false</span></span>
<span id="cb91-542"><a href="#cb91-542" aria-hidden="true" tabindex="-1"></a>Mwine <span class="ot">&lt;-</span> wine <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(reg) <span class="sc">%&gt;%</span></span>
<span id="cb91-543"><a href="#cb91-543" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">mprice =</span> <span class="fu">mean</span>(price), </span>
<span id="cb91-544"><a href="#cb91-544" aria-hidden="true" tabindex="-1"></a>              <span class="at">lprice =</span> <span class="fu">mean</span>(<span class="fu">log</span>(price)),</span>
<span id="cb91-545"><a href="#cb91-545" aria-hidden="true" tabindex="-1"></a>              <span class="at">mlprice =</span> <span class="fu">exp</span>(lprice))</span>
<span id="cb91-546"><a href="#cb91-546" aria-hidden="true" tabindex="-1"></a>Mwine</span>
<span id="cb91-547"><a href="#cb91-547" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-548"><a href="#cb91-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-549"><a href="#cb91-549" aria-hidden="true" tabindex="-1"></a>By definition, taking the exponential of the mean of the logs, we get the geometric mean of prices, which is always lower than the arithmetic mean. Estimating the model without intercept:</span>
<span id="cb91-550"><a href="#cb91-550" aria-hidden="true" tabindex="-1"></a>\idxfun{lm}{stats}\idxfun{coef}{stats}</span>
<span id="cb91-551"><a href="#cb91-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-552"><a href="#cb91-552" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb91-553"><a href="#cb91-553" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: log_response_polytomic_no_intercept</span></span>
<span id="cb91-554"><a href="#cb91-554" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb91-555"><a href="#cb91-555" aria-hidden="true" tabindex="-1"></a>log_3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(price) <span class="sc">~</span> reg <span class="sc">-</span> <span class="dv">1</span>, wine)</span>
<span id="cb91-556"><a href="#cb91-556" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(log_3)</span>
<span id="cb91-557"><a href="#cb91-557" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-558"><a href="#cb91-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-559"><a href="#cb91-559" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- new page --&gt;</span></span>
<span id="cb91-560"><a href="#cb91-560" aria-hidden="true" tabindex="-1"></a>\newpage</span>
<span id="cb91-561"><a href="#cb91-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-562"><a href="#cb91-562" aria-hidden="true" tabindex="-1"></a>we get a model with a coefficient for the three regions. Taking the exponential of these coefficients, we get the geometric means of price previously computed for the three regions. Adding an intercept, only two dummies are introduced in the regression:</span>
<span id="cb91-563"><a href="#cb91-563" aria-hidden="true" tabindex="-1"></a>\idxfun{lm}{stats}\idxfun{coef}{stats}</span>
<span id="cb91-564"><a href="#cb91-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-565"><a href="#cb91-565" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb91-566"><a href="#cb91-566" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: log_response_polytomic_intercept</span></span>
<span id="cb91-567"><a href="#cb91-567" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb91-568"><a href="#cb91-568" aria-hidden="true" tabindex="-1"></a>log_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(price) <span class="sc">~</span> reg, wine)</span>
<span id="cb91-569"><a href="#cb91-569" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(log_2)</span>
<span id="cb91-570"><a href="#cb91-570" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-571"><a href="#cb91-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-572"><a href="#cb91-572" aria-hidden="true" tabindex="-1"></a>The intercept is the mean of the logarithms of the prices for the reference region. The coefficient for the Napa Valley region is the difference of mean log prices for the Napa Valley and "other regions". </span>
<span id="cb91-573"><a href="#cb91-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-574"><a href="#cb91-574" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb91-575"><a href="#cb91-575" aria-hidden="true" tabindex="-1"></a> \beta^s = \ln y^s_n - \ln y^o_n = \ln \frac{y^s_n}{y^o_n} = \ln (1 +</span>
<span id="cb91-576"><a href="#cb91-576" aria-hidden="true" tabindex="-1"></a>\tau_{s}) \approx \tau_{s}</span>
<span id="cb91-577"><a href="#cb91-577" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb91-578"><a href="#cb91-578" aria-hidden="true" tabindex="-1"></a>where $\tau_{s}$ is the relative price difference between Sonoma and "other regions". $\beta^s$ is an approximation of $\tau_{s}$. The coefficient is </span>
<span id="cb91-579"><a href="#cb91-579" aria-hidden="true" tabindex="-1"></a><span class="in">`r prtcoef(log_2, 2, 2)`</span> </span>
<span id="cb91-580"><a href="#cb91-580" aria-hidden="true" tabindex="-1"></a>(or <span class="in">`r 100 * prtcoef(log_2, 2, 2)`</span>%) as the exact formula for $\tau$ gives</span>
<span id="cb91-581"><a href="#cb91-581" aria-hidden="true" tabindex="-1"></a><span class="in">`r round(exp(coef(log_2)[2]), 2) -1`</span> </span>
<span id="cb91-582"><a href="#cb91-582" aria-hidden="true" tabindex="-1"></a>(or <span class="in">`r 100 * round(exp(coef(log_2)[2]), 2) - 100`</span>%). The approximation in this example is quite bad, because the value of $\hat{\beta}^s$ is high.</span>
<span id="cb91-583"><a href="#cb91-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-584"><a href="#cb91-584" aria-hidden="true" tabindex="-1"></a><span class="fu">## Several covariates {#sec-several_covariates}</span></span>
<span id="cb91-585"><a href="#cb91-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-586"><a href="#cb91-586" aria-hidden="true" tabindex="-1"></a>Most of the time, the model of interest includes several numerical and/or categorical covariates. A first step is to introduce these covariates separately, so that their linear effect is analyzed. But it is also sometimes interesting to introduce the product of two covariates in the regression. This enables to analyze the interaction effect of two covariates, i.e., the fact that the effect of $x_1$ on $y$ depends on the value of $x_2$.</span>
<span id="cb91-587"><a href="#cb91-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-588"><a href="#cb91-588" aria-hidden="true" tabindex="-1"></a><span class="fu">### Separate effects</span></span>
<span id="cb91-589"><a href="#cb91-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-590"><a href="#cb91-590" aria-hidden="true" tabindex="-1"></a>Consider the log-log model with the numerical <span class="in">`cases`</span> covariate and add the <span class="in">`reg`</span> categorical variable. We use the <span class="in">`+`</span> operator in the formula to separate these two covariates:</span>
<span id="cb91-591"><a href="#cb91-591" aria-hidden="true" tabindex="-1"></a>\idxfun{lm}{stats}\idxfun{coef}{stats}</span>
<span id="cb91-592"><a href="#cb91-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-593"><a href="#cb91-593" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb91-594"><a href="#cb91-594" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: numerical_factor_separate</span></span>
<span id="cb91-595"><a href="#cb91-595" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb91-596"><a href="#cb91-596" aria-hidden="true" tabindex="-1"></a>di_us <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(price) <span class="sc">~</span> <span class="fu">log</span>(cases) <span class="sc">+</span> reg, wine)</span>
<span id="cb91-597"><a href="#cb91-597" aria-hidden="true" tabindex="-1"></a>di_us <span class="sc">%&gt;%</span> coef</span>
<span id="cb91-598"><a href="#cb91-598" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-599"><a href="#cb91-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-600"><a href="#cb91-600" aria-hidden="true" tabindex="-1"></a>From previous subsections, we are able to interpret the results:</span>
<span id="cb91-601"><a href="#cb91-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-602"><a href="#cb91-602" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>a 1% increase in production leads to a decrease of $<span class="in">`r prtcoef(di_us, 2, 2)`</span>$% in price,</span>
<span id="cb91-603"><a href="#cb91-603" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>wine produced in Napa Valley and Sonoma are more expensive than wine produced in other regions (by an amount approximately equal to <span class="in">`r prtcoef(di_us, 3, 3) * 100`</span>% and <span class="in">`r prtcoef(di_us, 4, 3) * 100`</span>%).</span>
<span id="cb91-604"><a href="#cb91-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-605"><a href="#cb91-605" aria-hidden="true" tabindex="-1"></a>\newpage</span>
<span id="cb91-606"><a href="#cb91-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-607"><a href="#cb91-607" aria-hidden="true" tabindex="-1"></a>This model is represented in @fig-additive_effects. The slope is the same for the three regions, but the intercept is different. Therefore, the fitted model is represented by three parallel lines. Note that the sample mean for each region, depicted by a large point, is part of the corresponding regression line. </span>
<span id="cb91-608"><a href="#cb91-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-609"><a href="#cb91-609" aria-hidden="true" tabindex="-1"></a><span class="in">```{r } </span></span>
<span id="cb91-610"><a href="#cb91-610" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb91-611"><a href="#cb91-611" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Additive effects of production and region"</span></span>
<span id="cb91-612"><a href="#cb91-612" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-additive_effects</span></span>
<span id="cb91-613"><a href="#cb91-613" aria-hidden="true" tabindex="-1"></a>ui_us <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(price) <span class="sc">~</span> <span class="fu">log</span>(cases) <span class="sc">+</span> reg, wine)</span>
<span id="cb91-614"><a href="#cb91-614" aria-hidden="true" tabindex="-1"></a>Mwine <span class="ot">&lt;-</span> wine <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(reg) <span class="sc">%&gt;%</span></span>
<span id="cb91-615"><a href="#cb91-615" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">mlcases =</span> <span class="fu">mean</span>(<span class="fu">log</span>(cases)),</span>
<span id="cb91-616"><a href="#cb91-616" aria-hidden="true" tabindex="-1"></a>              <span class="at">mlprice =</span> <span class="fu">mean</span>(<span class="fu">log</span>(price))) <span class="sc">%&gt;%</span> </span>
<span id="cb91-617"><a href="#cb91-617" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">int =</span> <span class="fu">coef</span>(ui_us)[<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb91-618"><a href="#cb91-618" aria-hidden="true" tabindex="-1"></a>               <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">unname</span>(<span class="fu">coef</span>(ui_us)[<span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>])),</span>
<span id="cb91-619"><a href="#cb91-619" aria-hidden="true" tabindex="-1"></a>           <span class="at">slp =</span> <span class="fu">coef</span>(ui_us)[<span class="dv">2</span>])</span>
<span id="cb91-620"><a href="#cb91-620" aria-hidden="true" tabindex="-1"></a>gwine <span class="ot">&lt;-</span> wine <span class="sc">%&gt;%</span></span>
<span id="cb91-621"><a href="#cb91-621" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="fu">log</span>(cases), <span class="fu">log</span>(price), <span class="at">shape =</span> reg)) <span class="sc">+</span></span>
<span id="cb91-622"><a href="#cb91-622" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.1</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb91-623"><a href="#cb91-623" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> Mwine, <span class="fu">aes</span>(mlcases, mlprice, <span class="at">shape =</span> reg),</span>
<span id="cb91-624"><a href="#cb91-624" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb91-625"><a href="#cb91-625" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set2"</span>)</span>
<span id="cb91-626"><a href="#cb91-626" aria-hidden="true" tabindex="-1"></a>gwine <span class="sc">+</span> <span class="fu">geom_abline</span>(<span class="at">data =</span> Mwine,</span>
<span id="cb91-627"><a href="#cb91-627" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">aes</span>(<span class="at">intercept =</span> int,</span>
<span id="cb91-628"><a href="#cb91-628" aria-hidden="true" tabindex="-1"></a>                        <span class="at">slope =</span> slp,</span>
<span id="cb91-629"><a href="#cb91-629" aria-hidden="true" tabindex="-1"></a>                        <span class="at">linetype =</span> reg))</span>
<span id="cb91-630"><a href="#cb91-630" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-631"><a href="#cb91-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-632"><a href="#cb91-632" aria-hidden="true" tabindex="-1"></a><span class="fu">### Multiplicative effects</span></span>
<span id="cb91-633"><a href="#cb91-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-634"><a href="#cb91-634" aria-hidden="true" tabindex="-1"></a>A multiplicative effect is obtained by introducing in the regression the product of two covariates. Consider first the case where the two covariates are numeric; we'll consider as an example the production in m^3^ (<span class="in">`prodcubm`</span>) and <span class="in">`score`</span>. The product can be computed before the estimation:</span>
<span id="cb91-635"><a href="#cb91-635" aria-hidden="true" tabindex="-1"></a>\idxfun{mutate}{dplyr}</span>
<span id="cb91-636"><a href="#cb91-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-639"><a href="#cb91-639" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-640"><a href="#cb91-640" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: prodcubm_score</span></span>
<span id="cb91-641"><a href="#cb91-641" aria-hidden="true" tabindex="-1"></a>wine <span class="ot">&lt;-</span> wine <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">prodcubm =</span> cases <span class="sc">*</span> <span class="fl">0.009</span>, </span>
<span id="cb91-642"><a href="#cb91-642" aria-hidden="true" tabindex="-1"></a>                        <span class="at">prod_score =</span> prodcubm <span class="sc">*</span> score)</span>
<span id="cb91-643"><a href="#cb91-643" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-644"><a href="#cb91-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-645"><a href="#cb91-645" aria-hidden="true" tabindex="-1"></a>and introduced in the regression:</span>
<span id="cb91-646"><a href="#cb91-646" aria-hidden="true" tabindex="-1"></a>\idxfun{lm}{stats}\idxfun{coef}{stats}</span>
<span id="cb91-647"><a href="#cb91-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-650"><a href="#cb91-650" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-651"><a href="#cb91-651" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: only_mult_effect</span></span>
<span id="cb91-652"><a href="#cb91-652" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb91-653"><a href="#cb91-653" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(price <span class="sc">~</span> prod_score, wine) <span class="sc">%&gt;%</span> coef</span>
<span id="cb91-654"><a href="#cb91-654" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-655"><a href="#cb91-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-656"><a href="#cb91-656" aria-hidden="true" tabindex="-1"></a>The same result can be obtained by computing "on the fly" the product in the formula:</span>
<span id="cb91-657"><a href="#cb91-657" aria-hidden="true" tabindex="-1"></a>\idxfun{lm}{stats}\idxfun{coef}{stats}\idxfun{I}{base}</span>
<span id="cb91-658"><a href="#cb91-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-661"><a href="#cb91-661" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-662"><a href="#cb91-662" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: false</span></span>
<span id="cb91-663"><a href="#cb91-663" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: only_mult_effect_I</span></span>
<span id="cb91-664"><a href="#cb91-664" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(price <span class="sc">~</span> <span class="fu">I</span>(prodcubm <span class="sc">*</span> score), wine) <span class="sc">%&gt;%</span> coef</span>
<span id="cb91-665"><a href="#cb91-665" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-666"><a href="#cb91-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-667"><a href="#cb91-667" aria-hidden="true" tabindex="-1"></a>Note the use of the <span class="in">`I`</span> function in the formula; arithmetic operators (<span class="in">`+`</span>, <span class="in">`-`</span>, <span class="in">`*`</span>, <span class="in">`:`</span> and <span class="in">`/`</span>) have a special meaning in formulas and therefore they should be "protected" in order to perform the usual arithmetic operation.</span>
<span id="cb91-668"><a href="#cb91-668" aria-hidden="true" tabindex="-1"></a>The last (and best solution) is to use the formula syntax: <span class="in">`x_1:x_2`</span> introduces the interaction effect between <span class="in">`x_1`</span> and <span class="in">`x_2`</span>, i.e., their product:</span>
<span id="cb91-669"><a href="#cb91-669" aria-hidden="true" tabindex="-1"></a>\idxfun{lm}{stats}\idxfun{coef}{stats}</span>
<span id="cb91-670"><a href="#cb91-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-673"><a href="#cb91-673" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-674"><a href="#cb91-674" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: hide</span></span>
<span id="cb91-675"><a href="#cb91-675" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: only_mult_effect_formula</span></span>
<span id="cb91-676"><a href="#cb91-676" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(price <span class="sc">~</span> prodcubm<span class="sc">:</span>score, wine) <span class="sc">%&gt;%</span> coef</span>
<span id="cb91-677"><a href="#cb91-677" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-678"><a href="#cb91-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-679"><a href="#cb91-679" aria-hidden="true" tabindex="-1"></a>\newpage</span>
<span id="cb91-680"><a href="#cb91-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-681"><a href="#cb91-681" aria-hidden="true" tabindex="-1"></a>This model is of the form: $y_n = \alpha + \beta x_1 x_2 + \epsilon_n$.</span>
<span id="cb91-682"><a href="#cb91-682" aria-hidden="true" tabindex="-1"></a>Therefore, the marginal effect of $x_1$ is $\beta x_2$ and the one of $x_2$ is $\beta x_1$, which is difficult to justify. When one wants to introduce interaction effects, it's recommended to introduce them with the additive effects. This can be performed using any of the following commands:</span>
<span id="cb91-683"><a href="#cb91-683" aria-hidden="true" tabindex="-1"></a>\idxfun{lm}{stats}\idxfun{I}{base}</span>
<span id="cb91-684"><a href="#cb91-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-687"><a href="#cb91-687" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-688"><a href="#cb91-688" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: false</span></span>
<span id="cb91-689"><a href="#cb91-689" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: add_and_mult_effects</span></span>
<span id="cb91-690"><a href="#cb91-690" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(price <span class="sc">~</span> prodcubm <span class="sc">+</span> score <span class="sc">+</span> <span class="fu">I</span>(prodcubm <span class="sc">*</span> score), wine)</span>
<span id="cb91-691"><a href="#cb91-691" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(price <span class="sc">~</span> prodcubm <span class="sc">+</span> score <span class="sc">+</span> prod_score, wine)</span>
<span id="cb91-692"><a href="#cb91-692" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(price <span class="sc">~</span> prodcubm <span class="sc">+</span> score <span class="sc">+</span> prodcubm <span class="sc">:</span> score, wine)</span>
<span id="cb91-693"><a href="#cb91-693" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-694"><a href="#cb91-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-695"><a href="#cb91-695" aria-hidden="true" tabindex="-1"></a>the last expression uses the formula syntax, i.e., use <span class="in">`+`</span> and <span class="in">`:`</span>. However, introducing the additive and the interacting effect is a very common task, so that the <span class="in">`*`</span> operator is devoted to this task:</span>
<span id="cb91-696"><a href="#cb91-696" aria-hidden="true" tabindex="-1"></a>\idxfun{lm}{stats}\idxfun{coef}{stats}</span>
<span id="cb91-697"><a href="#cb91-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-698"><a href="#cb91-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-701"><a href="#cb91-701" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-702"><a href="#cb91-702" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: star_operator_formula</span></span>
<span id="cb91-703"><a href="#cb91-703" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb91-704"><a href="#cb91-704" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> prodcubm <span class="sc">*</span> score, wine)</span>
<span id="cb91-705"><a href="#cb91-705" aria-hidden="true" tabindex="-1"></a>z <span class="sc">%&gt;%</span> coef</span>
<span id="cb91-706"><a href="#cb91-706" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-707"><a href="#cb91-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-708"><a href="#cb91-708" aria-hidden="true" tabindex="-1"></a>This model is now of the form: $y_n = \alpha + \beta_1 x_{n1} + \beta_2 x_{n2} + \beta_{12} x_{n1}x_{n2}\epsilon_n$ and the marginal effect for $x_1$ is now $\beta_1 + \beta_{12} x_{n2}$. This model has as a special case the additive model ($\beta_{12} = 0$) and this hypothesis can be tested, which was not the case for the model with only the interaction between the two covariates. The marginal effect of one more m^3^ of production is (denoting $x_2$ the score): $<span class="in">`r prtcoef(z, 2, 3)`</span> - <span class="in">`r abs(prtcoef(z, 4, 3))`</span> x_2$ and is therefore a decreasing function of the score. Note that the coefficient of <span class="in">`prodcubm`</span> ($<span class="in">`r prtcoef(z, 2, 3)`</span>$) can be misleading. It indicates that, for a wine with a score equal to 0, the price increases with the production. But actually, such low scores are not observed, the lowest in the sample being <span class="in">`r round(min(wine$score), 2)`</span> and for this value, the marginal effect of production is </span>
<span id="cb91-709"><a href="#cb91-709" aria-hidden="true" tabindex="-1"></a>$<span class="in">`r prtcoef(z, 2, 3)`</span> - <span class="in">`r abs(prtcoef(z, 4, 3))`</span> \times <span class="in">`r round(min(wine$score), 2)`</span> = <span class="in">`r round(prtcoef(z, 2, 9) + prtcoef(z, 4, 9) * min(wine$score), 2)`</span>$. The marginal effect of production has the expected negative sign for $x_2 &gt; <span class="in">`r prtcoef(z, 2, 3)`</span> / <span class="in">`r abs(prtcoef(z, 4, 3))`</span> = <span class="in">`r -round(prtcoef(z, 2, 9) / prtcoef(z, 4, 9), 3)`</span>$, which is the case for 9560 wines out of 9580 in the sample. Therefore, the model predicts a negative marginal effect of the production on the price of a bottle for almost the whole sample, and this negative effect increases with the score obtained by the wine. We can easily test the hypothesis that the additive model is relevant using the value of the Student statistic for the interaction term:</span>
<span id="cb91-710"><a href="#cb91-710" aria-hidden="true" tabindex="-1"></a>\idxfun{coef}{stats}</span>
<span id="cb91-711"><a href="#cb91-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-712"><a href="#cb91-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-715"><a href="#cb91-715" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-716"><a href="#cb91-716" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: wald_test_mult_effect</span></span>
<span id="cb91-717"><a href="#cb91-717" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb91-718"><a href="#cb91-718" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(<span class="fu">summary</span>(z))[<span class="dv">4</span>, ]</span>
<span id="cb91-719"><a href="#cb91-719" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-720"><a href="#cb91-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-721"><a href="#cb91-721" aria-hidden="true" tabindex="-1"></a>which indicates that the interaction term is highly significant. For a model with the production and the age as covariates, we have:</span>
<span id="cb91-722"><a href="#cb91-722" aria-hidden="true" tabindex="-1"></a>\idxfun{lm}{stats}\idxfun{coef}{stats}</span>
<span id="cb91-723"><a href="#cb91-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-726"><a href="#cb91-726" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-727"><a href="#cb91-727" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: wald_test_mult_effect_age</span></span>
<span id="cb91-728"><a href="#cb91-728" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb91-729"><a href="#cb91-729" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> prodcubm <span class="sc">*</span> age, wine)</span>
<span id="cb91-730"><a href="#cb91-730" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(<span class="fu">summary</span>(z))[<span class="dv">4</span>, ]</span>
<span id="cb91-731"><a href="#cb91-731" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-732"><a href="#cb91-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-733"><a href="#cb91-733" aria-hidden="true" tabindex="-1"></a>\idxdata<span class="co">[</span><span class="ot">)</span><span class="co">]</span>{wine}{micsr.data}</span>
<span id="cb91-734"><a href="#cb91-734" aria-hidden="true" tabindex="-1"></a>and this time, the interaction term is not significant and the additive model should be favored.</span>
<span id="cb91-735"><a href="#cb91-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-736"><a href="#cb91-736" aria-hidden="true" tabindex="-1"></a><span class="fu">### Polynomials</span></span>
<span id="cb91-737"><a href="#cb91-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-738"><a href="#cb91-738" aria-hidden="true" tabindex="-1"></a>Until now, we have introduced the numerical covariates either in level or in log. In both cases, a unique coefficient $\hat{\beta}$ is estimated and the marginal effect of the covariate on the response is necessarily monotonic, which is not in practice always a relevant feature. For example, in a famous article, @KUZN:55 \index<span class="co">[</span><span class="ot">author</span><span class="co">]</span>{Kuznets} analyzed the relation between economic development and inequality and his analysis has been formalized by @ROBI:76\index<span class="co">[</span><span class="ot">author</span><span class="co">]</span>{Robinson}. A dual economy is considered, with a rural and an urban sector. In the rural sector, income is low and exhibits little variations as, in the urban sector, income is high and exhibits high variations. Denoting $\mu_r$ and $\mu_u$ the mean log-income in the rural and the urban sector and $\sigma_r ^ 2$ and $\sigma_u ^ 2$ the variance of log-income, it is therefore assumed that $\mu_r &lt; \mu_u$ and $\sigma_r ^ 2 &lt; \sigma_u ^ 2$. $x$ is the share of the urban sector and, during the process of development, $x$ increases. The mean log-income for the whole economy is:</span>
<span id="cb91-739"><a href="#cb91-739" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb91-740"><a href="#cb91-740" aria-hidden="true" tabindex="-1"></a>\mu = (1 - x) \mu_r + x \mu_u = \mu_r + x (\mu_u - \mu_r)</span>
<span id="cb91-741"><a href="#cb91-741" aria-hidden="true" tabindex="-1"></a>$$ {<span class="sc">\#</span>eq-mean_logincome}</span>
<span id="cb91-742"><a href="#cb91-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-743"><a href="#cb91-743" aria-hidden="true" tabindex="-1"></a>As $\mu_u &gt; \mu_r$, mean log-income increases during the process of development. To get the variance of log-income for the whole economy, which is a measure of inequality, we apply the variance decomposition formula</span>
<span id="cb91-744"><a href="#cb91-744" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- !!! rule of the variance ? --&gt;</span></span>
<span id="cb91-745"><a href="#cb91-745" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb91-746"><a href="#cb91-746" aria-hidden="true" tabindex="-1"></a>\sigma^2 = (1 - x) \sigma_r ^ 2 + x \sigma_u ^ 2 + (1-x)(\mu_r - \mu) ^ 2 + x(\mu_u - \mu) ^ 2</span>
<span id="cb91-747"><a href="#cb91-747" aria-hidden="true" tabindex="-1"></a>$$ {<span class="sc">\#</span>eq-var_logincome}</span>
<span id="cb91-748"><a href="#cb91-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-749"><a href="#cb91-749" aria-hidden="true" tabindex="-1"></a>Replacing $\mu$ by its expression in @eq-mean_logincome and denoting $\Delta_\mu = \mu_u  - \mu_r$ and $\Delta_{\sigma^2} = \sigma_u ^ 2 - \sigma_r ^ 2$, @eq-var_logincome can be rewritten as:</span>
<span id="cb91-750"><a href="#cb91-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-751"><a href="#cb91-751" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb91-752"><a href="#cb91-752" aria-hidden="true" tabindex="-1"></a>\sigma^2 = \sigma_r ^ 2 +  (\Delta_{\sigma^2} + \Delta_\mu^2) x - \Delta_\mu ^ 2 x ^ 2</span>
<span id="cb91-753"><a href="#cb91-753" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb91-754"><a href="#cb91-754" aria-hidden="true" tabindex="-1"></a>Therefore, the overall variance of log-income is the equation of a parabola with a positive first order term and a negative second order term. Graphically, the relation between the share of the modern sector and the overall variance of log-income is inverted U-shaped. From @eq-mean_logincome, the mean of log income is positively correlated with the share of the urban sector. The relation between the variance and the mean of log-income is therefore also inverted U-shaped, and is called in the economic literature the **Kuznets curve**. We use the <span class="in">`kuznets`</span> data set, which is used by @ANAN:KANB:93:\index<span class="co">[</span><span class="ot">author</span><span class="co">]</span>{Anand}\index<span class="co">[</span><span class="ot">author</span><span class="co">]</span>{Kambur}</span>
<span id="cb91-755"><a href="#cb91-755" aria-hidden="true" tabindex="-1"></a>\idxdata<span class="co">[</span><span class="ot">(</span><span class="co">]</span>{kuznets}{micsr.data}</span>
<span id="cb91-756"><a href="#cb91-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-759"><a href="#cb91-759" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-760"><a href="#cb91-760" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: kuznets</span></span>
<span id="cb91-761"><a href="#cb91-761" aria-hidden="true" tabindex="-1"></a>kuznets</span>
<span id="cb91-762"><a href="#cb91-762" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-763"><a href="#cb91-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-764"><a href="#cb91-764" aria-hidden="true" tabindex="-1"></a>It contains data for 60 countries in the sixties; <span class="in">`group`</span> categorizes developing, developed and socialist countries, <span class="in">`gnp`</span> is the per capita gross national product in  US$ of 1970, <span class="in">`gini`</span> is the Gini index of inequality and <span class="in">`varlog`</span> is the variance of the log-income. @fig-kuznets_curve presents the relationship between log-income and inequality, the fitting line being a second-order polynomial.</span>
<span id="cb91-765"><a href="#cb91-765" aria-hidden="true" tabindex="-1"></a>To perform the regression, <span class="in">`log(gnp)`</span> and its square can be computed before the estimation or "on the fly" in the formula:</span>
<span id="cb91-766"><a href="#cb91-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-767"><a href="#cb91-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-770"><a href="#cb91-770" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-771"><a href="#cb91-771" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb91-772"><a href="#cb91-772" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-kuznets_curve</span></span>
<span id="cb91-773"><a href="#cb91-773" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "The Kuznets curve"</span></span>
<span id="cb91-774"><a href="#cb91-774" aria-hidden="true" tabindex="-1"></a>kuznets <span class="sc">%&gt;%</span> </span>
<span id="cb91-775"><a href="#cb91-775" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(gnp, varlog)) <span class="sc">+</span> </span>
<span id="cb91-776"><a href="#cb91-776" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> group)) <span class="sc">+</span> </span>
<span id="cb91-777"><a href="#cb91-777" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">poly</span>(<span class="fu">log</span>(x), <span class="dv">2</span>), <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="at">trans =</span> <span class="st">"log"</span>, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">400</span>, <span class="dv">800</span>, <span class="dv">1600</span>, <span class="dv">3200</span>)) <span class="sc">+</span></span>
<span id="cb91-778"><a href="#cb91-778" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"gnp per capita, 1970 US$"</span>, <span class="at">y  =</span> <span class="st">"variance of log-income"</span>)</span>
<span id="cb91-779"><a href="#cb91-779" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-780"><a href="#cb91-780" aria-hidden="true" tabindex="-1"></a>\idxfun{lm}{stats}\idxfun{mutate}{dplyr}\idxfun{I}{base}</span>
<span id="cb91-781"><a href="#cb91-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-784"><a href="#cb91-784" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-785"><a href="#cb91-785" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: kuznets_est_different</span></span>
<span id="cb91-786"><a href="#cb91-786" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: hide</span></span>
<span id="cb91-787"><a href="#cb91-787" aria-hidden="true" tabindex="-1"></a>kuznets <span class="ot">&lt;-</span> kuznets <span class="sc">%&gt;%</span> </span>
<span id="cb91-788"><a href="#cb91-788" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lgnp =</span> <span class="fu">log</span>(gnp),</span>
<span id="cb91-789"><a href="#cb91-789" aria-hidden="true" tabindex="-1"></a>         <span class="at">lgnp2 =</span> lgnp <span class="sc">^</span> <span class="dv">2</span>)</span>
<span id="cb91-790"><a href="#cb91-790" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(varlog <span class="sc">~</span> <span class="fu">I</span>(<span class="fu">log</span>(gnp)) <span class="sc">+</span> <span class="fu">I</span>(<span class="fu">log</span>(gnp) <span class="sc">^</span> <span class="dv">2</span>), kuznets)</span>
<span id="cb91-791"><a href="#cb91-791" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(varlog <span class="sc">~</span> lgnp <span class="sc">+</span> <span class="fu">I</span>(lgnp <span class="sc">^</span> <span class="dv">2</span>), kuznets)</span>
<span id="cb91-792"><a href="#cb91-792" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(varlog <span class="sc">~</span> lgnp <span class="sc">+</span> lgnp2, kuznets)</span>
<span id="cb91-793"><a href="#cb91-793" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-794"><a href="#cb91-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-795"><a href="#cb91-795" aria-hidden="true" tabindex="-1"></a>or more simply (especially if the order of the polynomial is high), using the <span class="in">`poly`</span> function, which returns a matrix with a number of columns equal to the order of the polynomial:</span>
<span id="cb91-796"><a href="#cb91-796" aria-hidden="true" tabindex="-1"></a>\idxfun{poly}{stats}\idxfun{head}{utils}\idxfun{crossprod}{base}\idxfun{apply}{base}</span>
<span id="cb91-797"><a href="#cb91-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-800"><a href="#cb91-800" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-801"><a href="#cb91-801" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: poly_function</span></span>
<span id="cb91-802"><a href="#cb91-802" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: false</span></span>
<span id="cb91-803"><a href="#cb91-803" aria-hidden="true" tabindex="-1"></a>lgnp3 <span class="ot">&lt;-</span> <span class="fu">poly</span>(kuznets<span class="sc">$</span>lgnp, <span class="dv">3</span>)</span>
<span id="cb91-804"><a href="#cb91-804" aria-hidden="true" tabindex="-1"></a>lgnp3 <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">3</span>)</span>
<span id="cb91-805"><a href="#cb91-805" aria-hidden="true" tabindex="-1"></a><span class="fu">crossprod</span>(lgnp3)</span>
<span id="cb91-806"><a href="#cb91-806" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(lgnp3, <span class="dv">2</span>, mean)</span>
<span id="cb91-807"><a href="#cb91-807" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-808"><a href="#cb91-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-809"><a href="#cb91-809" aria-hidden="true" tabindex="-1"></a>By default, orthogonal polynomials are computed, i.e., polynomials for which all the inner products of the different terms are 0. Moreover, all the terms have a zero mean and a unit variance. "Raw" polynomials can be computed by setting the <span class="in">`raw`</span> argument to <span class="in">`TRUE`</span>. Using raw or orthogonal polynomials gives of course different coefficients, but the same fitted values and residuals. The <span class="in">`poly`</span> function can be used inside a formula, so that the Kuznets model can be estimated using:</span>
<span id="cb91-810"><a href="#cb91-810" aria-hidden="true" tabindex="-1"></a>\idxfun{lm}{stats}\idxfun{poly}{stats}\idxfun{coef}{stats}\idxfun{unname}{base}</span>
<span id="cb91-811"><a href="#cb91-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-814"><a href="#cb91-814" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-815"><a href="#cb91-815" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: poly_kuznets</span></span>
<span id="cb91-816"><a href="#cb91-816" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb91-817"><a href="#cb91-817" aria-hidden="true" tabindex="-1"></a>kc <span class="ot">&lt;-</span> <span class="fu">lm</span>(varlog <span class="sc">~</span> <span class="fu">poly</span>(lgnp, <span class="dv">2</span>, <span class="at">raw =</span> <span class="cn">TRUE</span>), kuznets)</span>
<span id="cb91-818"><a href="#cb91-818" aria-hidden="true" tabindex="-1"></a>kc <span class="sc">%&gt;%</span> coef <span class="sc">%&gt;%</span> unname</span>
<span id="cb91-819"><a href="#cb91-819" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-820"><a href="#cb91-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-821"><a href="#cb91-821" aria-hidden="true" tabindex="-1"></a>The results validate the Kuznets hypothesis, i.e., per capital income have first a positive, and then a negative effect on inequality. Denoting $\beta_1$ and $\beta_2$ the coefficients of log-income and its square, the summit of the curve is given by $\ln \mbox{gnp} = -\beta_1 / (2 \beta_2) = <span class="in">`r round(-coef(kc)[2] / coef(kc)[3] / 2, 2)`</span>$, that corresponds to a per capita GNP equal to <span class="in">`r round(exp(-coef(kc)[2] / coef(kc)[3] / 2))`</span>, which is very close to the median per capita income in the sample.</span>
<span id="cb91-822"><a href="#cb91-822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-823"><a href="#cb91-823" aria-hidden="true" tabindex="-1"></a>Using orthogonal polynomials, the covariance matrix of the estimators is now diagonal, but we get the same residuals and the same fitted values as previously:</span>
<span id="cb91-824"><a href="#cb91-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-827"><a href="#cb91-827" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-828"><a href="#cb91-828" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb91-829"><a href="#cb91-829" aria-hidden="true" tabindex="-1"></a>kcp <span class="ot">&lt;-</span> <span class="fu">lm</span>(varlog <span class="sc">~</span> <span class="fu">poly</span>(lgnp, <span class="dv">2</span>), kuznets)</span>
<span id="cb91-830"><a href="#cb91-830" aria-hidden="true" tabindex="-1"></a><span class="fu">resid</span>(kc) <span class="sc">%&gt;%</span> head</span>
<span id="cb91-831"><a href="#cb91-831" aria-hidden="true" tabindex="-1"></a><span class="fu">resid</span>(kcp) <span class="sc">%&gt;%</span> head</span>
<span id="cb91-832"><a href="#cb91-832" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-833"><a href="#cb91-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-836"><a href="#cb91-836" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-837"><a href="#cb91-837" aria-hidden="true" tabindex="-1"></a><span class="fu">vcov</span>(kcp)</span>
<span id="cb91-838"><a href="#cb91-838" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-839"><a href="#cb91-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-840"><a href="#cb91-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-841"><a href="#cb91-841" aria-hidden="true" tabindex="-1"></a><span class="fu">## Marginal effects {#sec-marginal_effects}</span></span>
<span id="cb91-842"><a href="#cb91-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-843"><a href="#cb91-843" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">general</span><span class="co">]</span>{marginal effects|(}</span>
<span id="cb91-844"><a href="#cb91-844" aria-hidden="true" tabindex="-1"></a>Until now, we have interpreted the coefficients in a linear model. However, except in the case where the covariate is in level, the coefficients are different from the marginal effects. For example, in a model with:</span>
<span id="cb91-845"><a href="#cb91-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-846"><a href="#cb91-846" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>the covariate in log: $y_n = \alpha + \beta \ln x + \epsilon_n$, the marginal effect is $d y_n / d x_n = \beta / x_n$,</span>
<span id="cb91-847"><a href="#cb91-847" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>the covariate introduced as a second degree polynomial: $y_n = \alpha + \beta_1 x + \beta_2 x ^ 2$, the marginal effect is $d y_n / dx_n = \beta_1 + 2 \beta_2 x$.</span>
<span id="cb91-848"><a href="#cb91-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-849"><a href="#cb91-849" aria-hidden="true" tabindex="-1"></a>Therefore, the marginal effect of $x$ on $y$ depends on the value of $x$ and is therefore different from one observation to another. Moreover, the standard error of the marginal effect will also depend on the value of $x$. </span>
<span id="cb91-850"><a href="#cb91-850" aria-hidden="true" tabindex="-1"></a>There are several **R** packages which enable the automatic computation of marginal effects. We'll present in this section the **marginaleffects** package <span class="co">[</span><span class="ot">see @AREL:23</span><span class="co">]</span>\index<span class="co">[</span><span class="ot">author</span><span class="co">]</span>{Arel-Bundock} which provides a very rich set of analytical and graphical tools to compute and analyze marginal effects.</span>
<span id="cb91-851"><a href="#cb91-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-852"><a href="#cb91-852" aria-hidden="true" tabindex="-1"></a><span class="fu">### Computation of the marginal effects with one covariate</span></span>
<span id="cb91-853"><a href="#cb91-853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-854"><a href="#cb91-854" aria-hidden="true" tabindex="-1"></a>Denote $m(\gamma, x_n) = d y / d x (\gamma, x_n)$. Until now, we have considered models which are linear in the parameters and are therefore of the form:</span>
<span id="cb91-855"><a href="#cb91-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-856"><a href="#cb91-856" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb91-857"><a href="#cb91-857" aria-hidden="true" tabindex="-1"></a>y_n = \alpha + \sum_{k=1}^K \beta_kf_k(x_n)</span>
<span id="cb91-858"><a href="#cb91-858" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb91-859"><a href="#cb91-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-860"><a href="#cb91-860" aria-hidden="true" tabindex="-1"></a>The marginal effect of a given covariate $l$ is then: $m_l(\beta, x_n) = \sum_k \beta_k \frac{\partial f_k}{\partial x_{nl}}(x_n)$ and the fitted marginal effect is $\sum_k \hat{\beta}_k \frac{\partial f_k}{\partial x_{nl}}(x_n)$. Its variance is then a function of the matrix of covariance of the coefficients and of the partial derivatives of $f_k$ with respect to $x_{nl}$. Consider as an example the Kuznets curve: $y_n = \alpha + \beta_1 \ln x_n + \beta_2 \ln^2 x_n$. The estimated marginal effect of the unique covariate is $\hat{\beta}_1 / x_n + 2\hat{\beta}_2 \ln x_n / x_n$. It is therefore of the form $a \hat{\beta}_1 + b \hat{\beta}_2$, for which the variance is: $a^2\sigma_{\hat{\beta}_1}^2 + b^2\sigma_{\hat{\beta}_1}^2 + 2 ab\sigma_{\hat{\beta}_1\hat{\beta}_2}$. Therefore, for the Kuznets model, the variance of the marginal effect of per capita GNP is:</span>
<span id="cb91-861"><a href="#cb91-861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-862"><a href="#cb91-862" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb91-863"><a href="#cb91-863" aria-hidden="true" tabindex="-1"></a>\left(1 / x_n\right)^2 \sigma_{\beta_1} ^ 2 +  \left(2\ln(x_n)/x_n\right) ^ 2 \sigma_{\beta_2}^2+ 2 \times \left(1 / x_n\right)\left(2\ln(x_n)/x_n\right) \sigma_{\beta_1\beta_2}</span>
<span id="cb91-864"><a href="#cb91-864" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb91-865"><a href="#cb91-865" aria-hidden="true" tabindex="-1"></a>We first fit the Kuznets curve equation, and note that we use <span class="in">`log(gnp)`</span> and not <span class="in">`lgnp`</span> in the formula:</span>
<span id="cb91-866"><a href="#cb91-866" aria-hidden="true" tabindex="-1"></a>\idxfun{lm}{stats}\idxfun{coef}{stats}\idxfun{poly}{stats}\idxfun{unname}{base}</span>
<span id="cb91-867"><a href="#cb91-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-870"><a href="#cb91-870" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-871"><a href="#cb91-871" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: kuznets_with_gnp</span></span>
<span id="cb91-872"><a href="#cb91-872" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb91-873"><a href="#cb91-873" aria-hidden="true" tabindex="-1"></a>kc <span class="ot">&lt;-</span> <span class="fu">lm</span>(varlog <span class="sc">~</span> <span class="fu">poly</span>(<span class="fu">log</span>(gnp), <span class="dv">2</span>, <span class="at">raw =</span> <span class="cn">TRUE</span>), kuznets)</span>
<span id="cb91-874"><a href="#cb91-874" aria-hidden="true" tabindex="-1"></a>kc <span class="sc">%&gt;%</span> coef <span class="sc">%&gt;%</span> unname</span>
<span id="cb91-875"><a href="#cb91-875" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-876"><a href="#cb91-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-877"><a href="#cb91-877" aria-hidden="true" tabindex="-1"></a>Applying the preceding formulas, we compute the marginal effect and its standard error for each observation:</span>
<span id="cb91-878"><a href="#cb91-878" aria-hidden="true" tabindex="-1"></a>\idxfun{coef}{stats}\idxfun{vcov}{stats}\idxfun{head}{utils}</span>
<span id="cb91-879"><a href="#cb91-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-882"><a href="#cb91-882" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-883"><a href="#cb91-883" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: kuznets_with_gnp_me</span></span>
<span id="cb91-884"><a href="#cb91-884" aria-hidden="true" tabindex="-1"></a>mekc <span class="ot">&lt;-</span> kuznets <span class="sc">%&gt;%</span> </span>
<span id="cb91-885"><a href="#cb91-885" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">me =</span> <span class="fu">coef</span>(kc)[<span class="dv">2</span>] <span class="sc">/</span> gnp <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">coef</span>(kc)[<span class="dv">3</span>] <span class="sc">*</span> <span class="fu">log</span>(gnp) <span class="sc">/</span> gnp,</span>
<span id="cb91-886"><a href="#cb91-886" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd =</span> <span class="fu">sqrt</span>((<span class="dv">1</span> <span class="sc">/</span> gnp) <span class="sc">^</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">vcov</span>(kc)[<span class="dv">2</span>, <span class="dv">2</span>] <span class="sc">+</span> </span>
<span id="cb91-887"><a href="#cb91-887" aria-hidden="true" tabindex="-1"></a>                        (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">log</span>(gnp) <span class="sc">/</span> gnp) <span class="sc">^</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">vcov</span>(kc)[<span class="dv">3</span>, <span class="dv">3</span>] <span class="sc">+</span> </span>
<span id="cb91-888"><a href="#cb91-888" aria-hidden="true" tabindex="-1"></a>                        <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">/</span> gnp) <span class="sc">*</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">log</span>(gnp) <span class="sc">/</span> gnp) <span class="sc">*</span> </span>
<span id="cb91-889"><a href="#cb91-889" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">vcov</span>(kc)[<span class="dv">2</span>, <span class="dv">3</span>]))</span>
<span id="cb91-890"><a href="#cb91-890" aria-hidden="true" tabindex="-1"></a>mekc <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">3</span>)</span>
<span id="cb91-891"><a href="#cb91-891" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-892"><a href="#cb91-892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-893"><a href="#cb91-893" aria-hidden="true" tabindex="-1"></a>The **marginaleffects** package provides the <span class="in">`slopes`</span> function to compute the marginal effects and their standard error for all the observations in the sample. It has a <span class="in">`variables`</span> argument that is a character vector containing the variables for which the marginal effect has to be computed. It is unnecessary here, as we have only one covariate:^<span class="co">[</span><span class="ot">Note the use of `as_tibble`: objects returned by `slopes` are data frames with further attributes and don't print nicely in a book.</span><span class="co">]</span></span>
<span id="cb91-894"><a href="#cb91-894" aria-hidden="true" tabindex="-1"></a>\idxfun{slopes}{marginaleffects}\idxfun{as<span class="sc">\_</span>tibble}{tibble}</span>
<span id="cb91-895"><a href="#cb91-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-898"><a href="#cb91-898" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-899"><a href="#cb91-899" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: kuznets_marginal_effects</span></span>
<span id="cb91-900"><a href="#cb91-900" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(marginaleffects)</span>
<span id="cb91-901"><a href="#cb91-901" aria-hidden="true" tabindex="-1"></a>kc_slps <span class="ot">&lt;-</span> kc <span class="sc">%&gt;%</span> slopes</span>
<span id="cb91-902"><a href="#cb91-902" aria-hidden="true" tabindex="-1"></a>kc_slps <span class="sc">%&gt;%</span> as_tibble</span>
<span id="cb91-903"><a href="#cb91-903" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-904"><a href="#cb91-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-905"><a href="#cb91-905" aria-hidden="true" tabindex="-1"></a>We can check that we get "almost" the same results as previously. The tiny difference is due to the fact that we used analytical derivatives, as <span class="in">`slopes`</span> use numerical derivatives. </span>
<span id="cb91-906"><a href="#cb91-906" aria-hidden="true" tabindex="-1"></a>We have seen previously that the same regression could have been performed by computing before the estimation the log of the per capita GNP:</span>
<span id="cb91-907"><a href="#cb91-907" aria-hidden="true" tabindex="-1"></a>\idxfun{lm}{stats}\idxfun{poly}{stats}</span>
<span id="cb91-908"><a href="#cb91-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-911"><a href="#cb91-911" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-912"><a href="#cb91-912" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: kc2</span></span>
<span id="cb91-913"><a href="#cb91-913" aria-hidden="true" tabindex="-1"></a>kc2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(varlog <span class="sc">~</span> <span class="fu">poly</span>(lgnp, <span class="dv">2</span>, <span class="at">raw =</span> <span class="cn">TRUE</span>), kuznets)</span>
<span id="cb91-914"><a href="#cb91-914" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-915"><a href="#cb91-915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-916"><a href="#cb91-916" aria-hidden="true" tabindex="-1"></a>although the coefficients are the same as previously, using <span class="in">`slopes`</span> with this model returns completely different results:</span>
<span id="cb91-917"><a href="#cb91-917" aria-hidden="true" tabindex="-1"></a>\idxfun{slopes}{marginaleffects}\idxfun{as<span class="sc">\_</span>tibble}{tibble}</span>
<span id="cb91-918"><a href="#cb91-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-921"><a href="#cb91-921" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-922"><a href="#cb91-922" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: kc2_slopes</span></span>
<span id="cb91-923"><a href="#cb91-923" aria-hidden="true" tabindex="-1"></a>kc2 <span class="sc">%&gt;%</span> slopes <span class="sc">%&gt;%</span> as_tibble</span>
<span id="cb91-924"><a href="#cb91-924" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-925"><a href="#cb91-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-926"><a href="#cb91-926" aria-hidden="true" tabindex="-1"></a>The covariate is now <span class="in">`lgnp`</span> and the marginal effect is no longer the effect of an increase of $1 of per capita on inequality, but the effect of a doubling of income.</span>
<span id="cb91-927"><a href="#cb91-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-928"><a href="#cb91-928" aria-hidden="true" tabindex="-1"></a>The computation of the individual marginal effects results in a very large output, that is as such difficult to interpret. It is therefore customary to provide a unique value that summarizes the marginal effect of the covariate on the response for the whole sample. The preferred statistic is the **average marginal effects** (**AME**). It is simply the arithmetic mean of the individual effects. It can be obtained either using the <span class="in">`avg_slopes`</span> function or applying the <span class="in">`summary`</span> method to the object returned by <span class="in">`slope`</span>:</span>
<span id="cb91-929"><a href="#cb91-929" aria-hidden="true" tabindex="-1"></a>\idxfun{slopes}{marginaleffects}\idxfun{avg<span class="sc">\_</span>slopes}{marginaleffects}\idxfun{as<span class="sc">\_</span>tibble}{tibble}</span>
<span id="cb91-930"><a href="#cb91-930" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">general</span><span class="co">]</span>{marginal effects!average marginal effects}</span>
<span id="cb91-931"><a href="#cb91-931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-932"><a href="#cb91-932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-935"><a href="#cb91-935" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-936"><a href="#cb91-936" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: kuznets_avg_slopes</span></span>
<span id="cb91-937"><a href="#cb91-937" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> kc <span class="sc">%&gt;%</span> slopes <span class="sc">%&gt;%</span> summary</span>
<span id="cb91-938"><a href="#cb91-938" aria-hidden="true" tabindex="-1"></a>kc <span class="sc">%&gt;%</span> avg_slopes <span class="sc">%&gt;%</span> as_tibble</span>
<span id="cb91-939"><a href="#cb91-939" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-940"><a href="#cb91-940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-941"><a href="#cb91-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-942"><a href="#cb91-942" aria-hidden="true" tabindex="-1"></a>Note that the effect of <span class="in">`gnp`</span> on inequality is not significant on average. This is hardly surprising as the effect is positive for about half of the sample and negative for the other half.</span>
<span id="cb91-943"><a href="#cb91-943" aria-hidden="true" tabindex="-1"></a>Another popular choice to summarize marginal effects is the **marginal effect at the mean**. It consists of computing the marginal effect for a virtual observation for which all the covariates are set to their average in the sample. We get for our Kuznets curve:</span>
<span id="cb91-944"><a href="#cb91-944" aria-hidden="true" tabindex="-1"></a>\idxfun{tibble}{tibble}\idxfun{transmute}{dplyr}</span>
<span id="cb91-945"><a href="#cb91-945" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">general</span><span class="co">]</span>{marginal effects!at the mean}</span>
<span id="cb91-946"><a href="#cb91-946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-949"><a href="#cb91-949" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-950"><a href="#cb91-950" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: mem_manual</span></span>
<span id="cb91-951"><a href="#cb91-951" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb91-952"><a href="#cb91-952" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">gnp =</span> <span class="fu">mean</span>(kuznets<span class="sc">$</span>gnp)) <span class="sc">%&gt;%</span> </span>
<span id="cb91-953"><a href="#cb91-953" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">me =</span> <span class="fu">coef</span>(kc)[<span class="dv">2</span>] <span class="sc">/</span> gnp <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">coef</span>(kc)[<span class="dv">3</span>] <span class="sc">*</span> <span class="fu">log</span>(gnp) <span class="sc">/</span> gnp,</span>
<span id="cb91-954"><a href="#cb91-954" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd =</span> <span class="fu">sqrt</span>((<span class="dv">1</span> <span class="sc">/</span> gnp) <span class="sc">^</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">vcov</span>(kc)[<span class="dv">2</span>, <span class="dv">2</span>] <span class="sc">+</span> </span>
<span id="cb91-955"><a href="#cb91-955" aria-hidden="true" tabindex="-1"></a>                        (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">log</span>(gnp) <span class="sc">/</span> gnp) <span class="sc">^</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">vcov</span>(kc)[<span class="dv">3</span>, <span class="dv">3</span>] <span class="sc">+</span> </span>
<span id="cb91-956"><a href="#cb91-956" aria-hidden="true" tabindex="-1"></a>                        <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">/</span> gnp) <span class="sc">*</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">log</span>(gnp) <span class="sc">/</span> gnp) <span class="sc">*</span> </span>
<span id="cb91-957"><a href="#cb91-957" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">vcov</span>(kc)[<span class="dv">2</span>, <span class="dv">3</span>]),</span>
<span id="cb91-958"><a href="#cb91-958" aria-hidden="true" tabindex="-1"></a>            <span class="at">z =</span> me <span class="sc">/</span> sd)</span>
<span id="cb91-959"><a href="#cb91-959" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-960"><a href="#cb91-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-961"><a href="#cb91-961" aria-hidden="true" tabindex="-1"></a>The effect is now negative and almost significant at the 5% level. This can be explained by the fact that the distribution of per capita income is highly asymmetric in our sample, so that the mean of <span class="in">`gnp`</span> ($<span class="in">`r round(mean(kuznets$gnp))`</span>) is much higher than the median ($<span class="in">`r round(median(kuznets$gnp))`</span>).</span>
<span id="cb91-962"><a href="#cb91-962" aria-hidden="true" tabindex="-1"></a>\idxdata<span class="co">[</span><span class="ot">)</span><span class="co">]</span>{kuznets}{micsr.data}</span>
<span id="cb91-963"><a href="#cb91-963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-964"><a href="#cb91-964" aria-hidden="true" tabindex="-1"></a><span class="fu">### General computation of marginal effects</span></span>
<span id="cb91-965"><a href="#cb91-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-966"><a href="#cb91-966" aria-hidden="true" tabindex="-1"></a>Consider now a model with several covariates, some being numerical, other categorical and with interactions. Using the <span class="in">`wine`</span> data set, we fit the following model:</span>
<span id="cb91-967"><a href="#cb91-967" aria-hidden="true" tabindex="-1"></a>\idxfun{mutate}{dplyr}\idxfun{lm}{stats}\idxfun{coef}{stats}</span>
<span id="cb91-968"><a href="#cb91-968" aria-hidden="true" tabindex="-1"></a>\idxdata<span class="co">[</span><span class="ot">(</span><span class="co">]</span>{wine}{micsr.data}</span>
<span id="cb91-969"><a href="#cb91-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-970"><a href="#cb91-970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-973"><a href="#cb91-973" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-974"><a href="#cb91-974" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: general_wine_model</span></span>
<span id="cb91-975"><a href="#cb91-975" aria-hidden="true" tabindex="-1"></a>wine <span class="ot">&lt;-</span> wine <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">lprodcubm =</span> <span class="fu">log</span>(prodcubm))</span>
<span id="cb91-976"><a href="#cb91-976" aria-hidden="true" tabindex="-1"></a>u <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(price) <span class="sc">~</span> reg <span class="sc">+</span> <span class="fu">log</span>(score) <span class="sc">*</span> lprodcubm <span class="sc">+</span> </span>
<span id="cb91-977"><a href="#cb91-977" aria-hidden="true" tabindex="-1"></a>          reg <span class="sc">:</span> <span class="fu">log</span>(score) <span class="sc">+</span> vyd, wine)</span>
<span id="cb91-978"><a href="#cb91-978" aria-hidden="true" tabindex="-1"></a>u <span class="sc">%&gt;%</span> summary <span class="sc">%&gt;%</span> coef</span>
<span id="cb91-979"><a href="#cb91-979" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-980"><a href="#cb91-980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-981"><a href="#cb91-981" aria-hidden="true" tabindex="-1"></a>The response is in log, so that every marginal effect measures a relative variation of the response. Two numerical variables are introduced in logs, but note that for the production, the log is computed before computing the regression, so that the covariate is <span class="in">`lprodcubm`</span> and not <span class="in">`prodcubm`</span>. On the contrary, for the score variable, the log is computed inside the formula. Therefore, while computing marginal effects, one has to keep in mind that what is measured is an increase of 100% of the production and of 1 point of the score. Note the use of the <span class="in">`*`</span> operator between <span class="in">`log(score)`</span> and <span class="in">`lprodcubm`</span> so that the multiplicative effect of these two covariates is added to their separate additive effects. We also use the categorical variable <span class="in">`reg`</span> (the region with three modalities) and a dummy variable for vineyard indication <span class="in">`vyd`</span>. Moreover, the term <span class="in">`reg:log(score)`</span> indicates that the effect of score on price will be different from one region to another. With such a complex linear regression, the coefficients are difficult to interpret and the computation of marginal effects is particularly useful. </span>
<span id="cb91-982"><a href="#cb91-982" aria-hidden="true" tabindex="-1"></a>Using slopes without any further arguments, we get:</span>
<span id="cb91-983"><a href="#cb91-983" aria-hidden="true" tabindex="-1"></a>\idxfun{slopes}{marginaleffects}\idxfun{nobs}{stats}\idxfun{nrow}{base}</span>
<span id="cb91-984"><a href="#cb91-984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-987"><a href="#cb91-987" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-988"><a href="#cb91-988" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb91-989"><a href="#cb91-989" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: meffects_general_model</span></span>
<span id="cb91-990"><a href="#cb91-990" aria-hidden="true" tabindex="-1"></a>u_slps <span class="ot">&lt;-</span> u <span class="sc">%&gt;%</span> slopes</span>
<span id="cb91-991"><a href="#cb91-991" aria-hidden="true" tabindex="-1"></a>u <span class="sc">%&gt;%</span> nobs</span>
<span id="cb91-992"><a href="#cb91-992" aria-hidden="true" tabindex="-1"></a>u_slps <span class="sc">%&gt;%</span> nrow</span>
<span id="cb91-993"><a href="#cb91-993" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-994"><a href="#cb91-994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-995"><a href="#cb91-995" aria-hidden="true" tabindex="-1"></a>The model is fitted on a sample of <span class="in">`r nobs(u)`</span> observations, but <span class="in">`slopes`</span> return a data frame of $<span class="in">`r nobs(u)`</span> \times 5 = <span class="in">`r nrow(u_slps)`</span>$ because there is one line for each observation and each covariate. The lines are sorted by covariate first and then by observation, the index of the observation being stored in a column called <span class="in">`rowid`</span>. To get the marginal effects for the second observation, we can use:</span>
<span id="cb91-996"><a href="#cb91-996" aria-hidden="true" tabindex="-1"></a>\idxfun{as<span class="sc">\_</span>tibble}{tibble}\idxfun{filter}{dplyr}\idxfun{select}{dplyr}</span>
<span id="cb91-997"><a href="#cb91-997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-1000"><a href="#cb91-1000" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-1001"><a href="#cb91-1001" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: general_msummary_oneobs</span></span>
<span id="cb91-1002"><a href="#cb91-1002" aria-hidden="true" tabindex="-1"></a>u_slps <span class="sc">%&gt;%</span> <span class="fu">filter</span>(rowid <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> as_tibble <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)</span>
<span id="cb91-1003"><a href="#cb91-1003" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-1004"><a href="#cb91-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-1005"><a href="#cb91-1005" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- !!! expliquer tidy --&gt;</span></span>
<span id="cb91-1006"><a href="#cb91-1006" aria-hidden="true" tabindex="-1"></a>The term of marginal effects is actually relevant only for numerical variables. The <span class="in">`contrast`</span> column indicates the kind of effect that is computed. It is <span class="in">`dY/dX`</span> (a derivative) for the two numerical covariates <span class="in">`lprobcubm`</span> and <span class="in">`score`</span>. For factors, the term is a contrast, i.e., the difference between one level (<span class="in">`sonoma`</span> and <span class="in">`napavaley`</span> for <span class="in">`reg`</span>) and the reference level (<span class="in">`Other`</span>). This is also the case for the dummy variable <span class="in">`vid`</span>, for which the effect is the difference of prediction for <span class="in">`vid`</span> equal to 1 and 0.^<span class="co">[</span><span class="ot">Actually in a linear model, this difference is equal to the derivative, see @sec-integer_covariate.</span><span class="co">]</span></span>
<span id="cb91-1007"><a href="#cb91-1007" aria-hidden="true" tabindex="-1"></a>The <span class="in">`variables`</span> argument can be used to compute the marginal effects only for a subset of covariate:</span>
<span id="cb91-1008"><a href="#cb91-1008" aria-hidden="true" tabindex="-1"></a>\idxfun{slopes}{marginaleffects}\idxfun{as<span class="sc">\_</span>tibble}{tibble}\idxfun{filter}{dplyr}\idxfun{select}{dplyr}</span>
<span id="cb91-1009"><a href="#cb91-1009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-1012"><a href="#cb91-1012" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-1013"><a href="#cb91-1013" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: hide</span></span>
<span id="cb91-1014"><a href="#cb91-1014" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: slopes_subset_covariates</span></span>
<span id="cb91-1015"><a href="#cb91-1015" aria-hidden="true" tabindex="-1"></a>u <span class="sc">%&gt;%</span> <span class="fu">slopes</span>(<span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"score"</span>, <span class="st">"reg"</span>)) <span class="sc">%&gt;%</span> as_tibble <span class="sc">%&gt;%</span> </span>
<span id="cb91-1016"><a href="#cb91-1016" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(rowid <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)</span>
<span id="cb91-1017"><a href="#cb91-1017" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-1018"><a href="#cb91-1018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-1019"><a href="#cb91-1019" aria-hidden="true" tabindex="-1"></a>As previously, we can compute the average marginal effect using <span class="in">`avg_slopes`</span>:</span>
<span id="cb91-1020"><a href="#cb91-1020" aria-hidden="true" tabindex="-1"></a>\idxfun{avg<span class="sc">\_</span>slopes}{marginaleffects}\idxfun{as<span class="sc">\_</span>tibble}{tibble}</span>
<span id="cb91-1021"><a href="#cb91-1021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-1024"><a href="#cb91-1024" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-1025"><a href="#cb91-1025" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: avg_slopes_subset</span></span>
<span id="cb91-1026"><a href="#cb91-1026" aria-hidden="true" tabindex="-1"></a>u <span class="sc">%&gt;%</span> avg_slopes <span class="sc">%&gt;%</span> as_tibble</span>
<span id="cb91-1027"><a href="#cb91-1027" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-1028"><a href="#cb91-1028" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-1029"><a href="#cb91-1029" aria-hidden="true" tabindex="-1"></a>Moreover, the **AME** can be computed for the different modalities of a factor, using the <span class="in">`by`</span> argument:</span>
<span id="cb91-1030"><a href="#cb91-1030" aria-hidden="true" tabindex="-1"></a>\idxfun{avg<span class="sc">\_</span>slopes}{marginaleffects}\idxfun{as<span class="sc">\_</span>tibble}{tibble}\idxfun{select}{dplyr}</span>
<span id="cb91-1031"><a href="#cb91-1031" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">general</span><span class="co">]</span>{marginal effects!average marginal effects}</span>
<span id="cb91-1032"><a href="#cb91-1032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-1035"><a href="#cb91-1035" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-1036"><a href="#cb91-1036" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: avg_slopes_by</span></span>
<span id="cb91-1037"><a href="#cb91-1037" aria-hidden="true" tabindex="-1"></a>u <span class="sc">%&gt;%</span> <span class="fu">avg_slopes</span>(<span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"score"</span>, <span class="st">"lprodcubm"</span>), </span>
<span id="cb91-1038"><a href="#cb91-1038" aria-hidden="true" tabindex="-1"></a>                 <span class="at">by =</span> <span class="st">"reg"</span>) <span class="sc">%&gt;%</span> as_tibble <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)</span>
<span id="cb91-1039"><a href="#cb91-1039" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-1040"><a href="#cb91-1040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-1041"><a href="#cb91-1041" aria-hidden="true" tabindex="-1"></a>The marginal effects can also be computed for hypothetical observations, using the <span class="in">`newdata`</span> argument, which should be a data frame containing one or several hypothetical observations. Such data frames can be easily computed using the <span class="in">`datagrid`</span> function; it has a <span class="in">`model`</span> argument and by default returns a one-line data frame containing the mean for the numerical variables and the mode for categorical variables:</span>
<span id="cb91-1042"><a href="#cb91-1042" aria-hidden="true" tabindex="-1"></a>\idxfun{datagrid}{marginaleffects}</span>
<span id="cb91-1043"><a href="#cb91-1043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-1046"><a href="#cb91-1046" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-1047"><a href="#cb91-1047" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: datagrid</span></span>
<span id="cb91-1048"><a href="#cb91-1048" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb91-1049"><a href="#cb91-1049" aria-hidden="true" tabindex="-1"></a><span class="fu">datagrid</span>(<span class="at">model =</span> u)</span>
<span id="cb91-1050"><a href="#cb91-1050" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-1051"><a href="#cb91-1051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-1052"><a href="#cb91-1052" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">general</span><span class="co">]</span>{marginal effects!at the mean}</span>
<span id="cb91-1053"><a href="#cb91-1053" aria-hidden="true" tabindex="-1"></a>and can be used to compute the marginal effects at the mean:</span>
<span id="cb91-1054"><a href="#cb91-1054" aria-hidden="true" tabindex="-1"></a>\idxfun{slopes}{marginaleffects}\idxfun{as<span class="sc">\_</span>tibble}{tibble}\idxfun{datagrid}{marginaleffects}</span>
<span id="cb91-1055"><a href="#cb91-1055" aria-hidden="true" tabindex="-1"></a>\idxfun{select}{dplyr}\index<span class="co">[</span><span class="ot">general</span><span class="co">]</span>{marginal effects!average marginal effects}</span>
<span id="cb91-1056"><a href="#cb91-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-1059"><a href="#cb91-1059" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-1060"><a href="#cb91-1060" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: datagrid_mae</span></span>
<span id="cb91-1061"><a href="#cb91-1061" aria-hidden="true" tabindex="-1"></a>u <span class="sc">%&gt;%</span> <span class="fu">slopes</span>(<span class="at">newdata =</span> <span class="fu">datagrid</span>()) <span class="sc">%&gt;%</span> as_tibble <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)</span>
<span id="cb91-1062"><a href="#cb91-1062" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-1063"><a href="#cb91-1063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-1064"><a href="#cb91-1064" aria-hidden="true" tabindex="-1"></a><span class="in">`datagrid`</span> can also include arguments whose names are the names of some covariates and their values are some values of the covariate. If, for example, two values are provided for the first covariate and three values for the second covariates, six observations are generated, obtained by taking all the combinations of the two covariates:</span>
<span id="cb91-1065"><a href="#cb91-1065" aria-hidden="true" tabindex="-1"></a>\idxfun{datagrid}{marginaleffects}</span>
<span id="cb91-1066"><a href="#cb91-1066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-1069"><a href="#cb91-1069" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-1070"><a href="#cb91-1070" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: datagrid_manual</span></span>
<span id="cb91-1071"><a href="#cb91-1071" aria-hidden="true" tabindex="-1"></a><span class="fu">datagrid</span>(<span class="at">model =</span> u, <span class="at">score =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">50</span>, <span class="dv">100</span>), <span class="at">vyd =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb91-1072"><a href="#cb91-1072" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-1073"><a href="#cb91-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-1074"><a href="#cb91-1074" aria-hidden="true" tabindex="-1"></a>Note that for unspecified covariates the mean / mode are introduced for numerical / categorical variables. </span>
<span id="cb91-1075"><a href="#cb91-1075" aria-hidden="true" tabindex="-1"></a>We've just presented a few features of the **marginaleffects** package. Detailed documentation can be found at <span class="co">[</span><span class="ot">https://marginaleffects.com/</span><span class="co">](https://marginaleffects.com/)</span>.</span>
<span id="cb91-1076"><a href="#cb91-1076" aria-hidden="true" tabindex="-1"></a>\idxdata<span class="co">[</span><span class="ot">)</span><span class="co">]</span>{wine}{micsr.data}</span>
<span id="cb91-1077"><a href="#cb91-1077" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">general</span><span class="co">]</span>{marginal effects|)}</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>